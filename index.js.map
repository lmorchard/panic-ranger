{"version":3,"file":null,"sources":["../src/lib/core.js","../src/lib/Vector2D.js","../node_modules/memory-stats/memory-stats.js","../src/plugins/viewportPixi.js","../src/lib/QuadTree.js","../src/index.js","../node_modules/stats-js/build/stats.min.js","../src/plugins/drawStats.js","../src/plugins/memoryStats.js","../node_modules/dat-gui/vendor/dat.gui.js","../node_modules/dat-gui/vendor/dat.color.js","../node_modules/dat-gui/index.js","../src/plugins/datGui.js","../src/plugins/name.js","../src/plugins/health.js","../src/plugins/position.js","../src/plugins/motion.js","../src/plugins/thruster.js","../src/plugins/seeker.js","../src/plugins/collision.js","../src/plugins/bounce.js","../src/plugins/playerInputSteering.js"],"sourcesContent":["/* global PIXI */\n\nconst TARGET_FPS = 60;\nconst TARGET_DURATION = 1000 / TARGET_FPS;\r\n\r\nconst requestAnimationFrame =\r\n  window.requestAnimationFrame ||\r\n  window.webkitRequestAnimationFrame ||\r\n  window.mozRequestAnimationFrame ||\r\n  window.oRequestAnimationFrame ||\r\n  window.msRequestAnimationFrame ||\r\n  function (fn) { setTimeout(fn, (1000/60)); };\r\n\r\n// Commonly used temp variables, pre-declared early.\r\nlet entityId, system, systemName, systemAttrs, systemCls, componentName,\r\n    timeNow, timeDelta, componentAttrs, matches, idx, item, handler;\r\n\r\nexport const Messages = {\r\n  ENTITY_INSERT: 'entity_insert',\r\n  ENTITY_DESTROY: 'entity_destroy'\r\n};\r\n\r\nexport class World {\r\n  constructor(options) {\r\n    options = options || {};\r\n\r\n    this.isRunning = false;\r\n    this.isPaused = false;\r\n    this.debug = false;\r\n\r\n    this.systems = {};\r\n    if (options.systems) {\r\n      this.addSystems(options.systems);\r\n    }\r\n\r\n    this.store = {};\r\n\r\n    this.subscribers = {};\r\n\r\n    this.tickDuration = TARGET_DURATION;\r\n    this.maxTickDelta = TARGET_DURATION * 5;\r\n    this.tickAccumulator = 0;\r\n\r\n    this.lastTickTime = 0;\r\n    this.lastDrawTime = 0;\r\n\r\n    this.boundTickLoop = () => this.tickLoop();\r\n    this.boundDrawLoop = (timestamp) => this.drawLoop(timestamp);\r\n\r\n    this.reset();\r\n  }\r\n\r\n  start() {\r\n    if (this.isRunning) { return; }\r\n    this.isRunning = true;\r\n\r\n    for (const systemName in this.systems) {\r\n      this.systems[systemName].initialize();\r\n    }\r\n\r\n    // Game logic separated from display rendering\r\n    // See also: http://www.chandlerprall.com/2012/06/requestanimationframe-is-not-your-logics-friend/\r\n    this.lastTickTime = Date.now();\r\n    this.lastDrawTime = 0;\r\n\r\n    setTimeout(this.boundTickLoop, this.tickDuration);\r\n    requestAnimationFrame(this.boundDrawLoop);\r\n\r\n    return this;\r\n  }\r\n\r\n  stop() {\r\n    this.isRunning = false;\r\n    return this;\r\n  }\r\n\r\n  pause() {\r\n    this.isPaused = true;\r\n    return this;\r\n  }\r\n\r\n  resume() {\r\n    this.isPaused = false;\r\n    return this;\r\n  }\r\n\r\n  reset() {\r\n    this.store = {};\r\n    this.lastEntityId = 0;\r\n  }\r\n\r\n  // TODO: Use a better pubsub library here. But, pubsub-js seemed to perform\r\n  // badly in a game loop.\r\n\r\n  subscribe(msg, handler) {\r\n    if (!this.subscribers[msg]) {\r\n      this.subscribers[msg] = [];\r\n    }\r\n    this.subscribers[msg].push(handler);\r\n    return this;\r\n  }\r\n\r\n  unsubscribe(/* msg, handler */) {\r\n    // TODO\r\n    return this;\r\n  }\r\n\r\n  publish(msg, data) {\r\n    if (!this.subscribers[msg]) { return; }\r\n    for (idx = 0, handler; handler = this.subscribers[msg][idx]; idx++) {\r\n      handler(msg, data);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  addSystems(systemsData) {\r\n    for (systemName in systemsData) {\r\n      systemAttrs = systemsData[systemName];\r\n      systemCls = getSystem(systemName);\r\n      system = new systemCls(systemAttrs);\r\n      system.setWorld(this);\r\n      this.systems[systemName] = system;\r\n    }\r\n  }\r\n\r\n  getSystem(systemName) {\r\n    return this.systems[systemName];\r\n  }\r\n\r\n  tick(timeDeltaMS) {\r\n    timeDelta = timeDeltaMS / 1000;\r\n    for (systemName in this.systems) {\r\n      this.systems[systemName].updateStart(timeDelta);\r\n    }\r\n    for (systemName in this.systems) {\r\n      this.systems[systemName].update(timeDelta);\r\n    }\r\n    for (systemName in this.systems) {\r\n      this.systems[systemName].updateEnd(timeDelta);\r\n    }\r\n  }\r\n\r\n  tickLoop() {\r\n    timeNow = Date.now();\r\n    timeDelta = Math.min(timeNow - this.lastTickTime, this.maxTickDelta);\r\n    this.lastTickTime = timeNow;\r\n\r\n    if (!this.isPaused) {\r\n      // Fixed-step game logic loop\r\n      // see: http://gafferongames.com/game-physics/fix-your-timestep/\r\n      this.tickAccumulator += timeDelta;\r\n      while (this.tickAccumulator > this.tickDuration) {\r\n        this.tick(this.tickDuration);\r\n        this.tickAccumulator -= this.tickDuration;\r\n      }\r\n    }\r\n\r\n    if (this.isRunning) {\r\n      setTimeout(this.boundTickLoop, this.tickDuration);\r\n    }\r\n  }\r\n\r\n  draw(timeDeltaMS) {\r\n    timeDelta = timeDeltaMS / 1000;\r\n    for (systemName in this.systems) {\r\n      this.systems[systemName].drawStart(timeDelta);\r\n    }\r\n    for (systemName in this.systems) {\r\n      this.systems[systemName].draw(timeDelta);\r\n    }\r\n    for (systemName in this.systems) {\r\n      this.systems[systemName].drawEnd(timeDelta);\r\n    }\r\n  }\r\n\r\n  drawLoop(timestamp) {\r\n    if (!this.lastDrawTime) { this.lastDrawTime = timestamp; }\r\n    timeDelta = timestamp - this.lastDrawTime;\r\n    this.lastDrawTime = timestamp;\r\n\r\n    if (!this.isPaused) {\r\n      this.draw(timeDelta);\r\n    }\r\n\r\n    if (this.isRunning) {\r\n      requestAnimationFrame(this.boundDrawLoop);\r\n    }\r\n  }\r\n\r\n  generateEntityId() {\r\n    return ++(this.lastEntityId);\r\n  }\r\n\r\n  insert(...items) {\r\n    const out = [];\r\n    for (idx = 0; item = items[idx]; idx++) {\r\n      entityId = this.generateEntityId();\r\n      for (componentName in item) {\r\n        componentAttrs = item[componentName];\r\n        this.addComponent(entityId, componentName, componentAttrs);\r\n      }\r\n      if (this.world) this.world.publish(Messages.ENTITY_INSERT, entityId);\r\n      out.push(entityId);\r\n    }\r\n    return out.length > 1 ? out : out[0];\r\n  }\r\n\r\n  destroy(entityId) {\r\n    if (this.world) this.world.publish(Messages.ENTITY_DESTROY, entityId);\r\n    for (componentName in this.store) {\r\n      this.removeComponent(entityId, componentName);\r\n    }\r\n  }\r\n\r\n  addComponent(entityId, componentName, componentAttrs) {\r\n    const componentManager = getComponent(componentName);\r\n    const component = componentManager.create(componentAttrs);\r\n    if (!this.store[componentName]) {\r\n      this.store[componentName] = {};\r\n    }\r\n    this.store[componentName][entityId] = component;\r\n  }\r\n\r\n  removeComponent(entityId, componentName) {\r\n    if (entityId in this.store[componentName]) {\r\n      delete this.store[componentName][entityId];\r\n    }\r\n  }\r\n\r\n  hasComponent(entityId, componentName) {\r\n    return (componentName in this.store) &&\r\n           (entityId in this.store[componentName]);\r\n  }\r\n\r\n  get(componentName, entityId) {\r\n    if (!this.store[componentName]) {\r\n      return null;\r\n    } else if (!entityId) {\r\n      return this.store[componentName];\r\n    } else {\r\n      return this.store[componentName][entityId];\r\n    }\r\n  }\r\n\r\n\r\n}\r\n\r\nexport class Component {\r\n\r\n  static defaults() {\r\n    return {};\r\n  }\r\n\r\n  static create(attrs) {\r\n    return {...this.defaults(), ...(attrs || {})};\n  }\r\n\r\n}\r\n\r\nexport class System {\r\n\r\n  constructor(options) {\r\n    this.options = {...this.defaultOptions(), ...(options || {})};\n    this.debug = this.options.debug || false;\r\n  }\r\n\r\n  defaultOptions() {\r\n    return {};\r\n  }\r\n\r\n  setWorld(world) {\r\n    this.world = world;\r\n  }\r\n\r\n  matchComponent() { return ''; }\r\n\r\n  initialize() { }\r\n\r\n  getMatchingComponents() {\r\n    return this.world.get(this.matchComponent());\r\n  }\r\n\r\n  updateStart(/* timeDelta */) { }\r\n\r\n  update(timeDelta) {\r\n    matches = this.getMatchingComponents();\r\n    for (entityId in matches) {\r\n      this.updateComponent(timeDelta, entityId, matches[entityId]);\r\n    }\r\n  }\r\n\r\n  updateComponent(/* timeDelta, entityId, component */) { }\r\n\r\n  updateEnd(/* timeDelta */) { }\r\n\r\n  drawStart(/* timeDelta */) { }\r\n\r\n  draw(/* timeDelta */) { }\n\n  getDebugGraphics() {\n    if (!this.world.debug) {\n      if (this.gDebug) { this.gDebug.visible = false; }\n      return;\n    }\n    if (!this.viewportSystem) {\n      this.viewportSystem = this.world.getSystem(this.options.viewportSystemName || 'ViewportPixi');\n      this.gDebug = new PIXI.Graphics();\n      this.viewportSystem.stage.addChild(this.gDebug);\n      this.gDebug.position.x = 0;\n      this.gDebug.position.y = 0;\n    }\n    this.gDebug.clear();\n    this.gDebug.visible = true;\n    return this.gDebug;\n  }\n\r\n  drawEnd(/* timeDelta */) { }\r\n\r\n}\r\n\r\nconst componentRegistry = {};\r\n\r\nexport function registerComponent(componentName, componentManager) {\r\n  componentRegistry[componentName] = componentManager;\r\n}\r\n\r\nexport function getComponent(componentName) {\r\n  return componentRegistry[componentName];\r\n}\r\n\r\nconst systemRegistry = {};\r\n\r\nexport function registerSystem(systemName, system) {\r\n  systemRegistry[systemName] = system;\r\n}\r\n\r\nexport function getSystem(systemName) {\r\n  return systemRegistry[systemName];\r\n}\r\n","/*\r\n  Originally by Vitalii [Nayjest] Stepanenko <gmail@vitaliy.in>\r\n  Tweaky & fixes by Les Orchard <me@lmorchard.com>\r\n*/\r\n\r\nexport default function Vector2D(x, y) {\r\n  this.x = x || 0;\r\n  this.y = y || 0;\r\n}\r\n\r\nVector2D.cloneFrom = function(object) {\r\n  return new Vector2D(object.x, object.y);\r\n};\r\n\r\nVector2D.fromArray = function(array) {\r\n  return new Vector2D(array[0], array[1]);\r\n};\r\n\r\nVector2D.zero = new Vector2D(0, 0);\r\n\r\nVector2D.prototype.add = function(vector) {\r\n  this.x += vector.x;\r\n  this.y += vector.y;\r\n  return this;\r\n};\r\n\r\nVector2D.prototype.addScalar = function(val) {\r\n  this.x += val;\r\n  this.y += val;\r\n  return this;\r\n};\r\n\r\nVector2D.prototype.eq = function(vector) {\r\n  return vector.x === this.x && vector.y === this.y;\r\n};\r\n\r\nVector2D.prototype.subtract = function(vector) {\r\n  this.x -= vector.x;\r\n  this.y -= vector.y;\r\n  return this;\r\n};\r\n\r\nVector2D.prototype.clone = function() {\r\n  return new Vector2D(this.x, this.y);\r\n};\r\n\r\nVector2D.prototype.set = function(vector) {\r\n  this.x = vector.x;\r\n  this.y = vector.y;\r\n  return this;\r\n};\r\n\r\nVector2D.prototype.setValues = function(_at_x, _at_y) {\r\n  this.x = _at_x;\r\n  this.y = _at_y;\r\n  return this;\r\n};\r\n\r\nVector2D.prototype.dist = function(vector) {\r\n  return Math.sqrt((vector.x - this.x) * (vector.x - this.x) + (vector.y - this.y) * (vector.y - this.y));\r\n};\r\n\r\nVector2D.prototype.normalise = function() {\r\n  return this.normalize();\r\n};\r\n\r\nVector2D.prototype.normalize = function() {\r\n  if (!this.isZero()) {\n    const m = this.magnitude();\n    this.x /= m;\r\n    this.y /= m;\r\n  }\r\n  return this;\r\n};\r\n\r\nVector2D.prototype.isZero = function() {\r\n  return this.x === 0 && this.y === 0;\r\n};\r\n\r\nVector2D.prototype.reverse = function() {\r\n  this.x = -this.x;\r\n  this.y = -this.y;\r\n  return this;\r\n};\r\n\r\nVector2D.prototype.magnitude = function() {\r\n  return Math.sqrt(this.x * this.x + this.y * this.y);\r\n};\r\n\r\nVector2D.prototype.toArray = function() {\r\n  return [this.x, this.y];\r\n};\r\n\r\nVector2D.prototype.angle = function() {\r\n  return Math.atan2(this.y, this.x);\r\n};\r\n\r\nVector2D.prototype.rotate = function(angle) {\r\n  const cos = Math.cos(angle);\n  const sin = Math.sin(angle);\n  return this.setValues(this.x * cos - this.y * sin, this.x * sin + this.y * cos);\r\n};\r\n\r\nVector2D.prototype.angleTo = function(vector) {\r\n  return Math.atan2(vector.y - this.y, vector.x - this.x);\r\n};\r\n\r\nVector2D.prototype.rotateAround = function(point, angle) {\r\n  return this.subtract(point).rotate(angle).add(point);\r\n};\r\n\r\nVector2D.prototype.multiplyScalar = function(val) {\r\n  this.x *= val;\r\n  this.y *= val;\r\n  return this;\r\n};\r\n\r\nVector2D.prototype.multiply = function(vector) {\r\n  this.x *= vector.x;\r\n  this.y *= vector.y;\r\n  return this;\r\n};\r\n\r\nVector2D.prototype.divide = function(vector) {\r\n  this.x /= vector.x;\r\n  this.y /= vector.y;\r\n  return this;\r\n};\r\n\r\nVector2D.prototype.divideScalar = function(val) {\r\n  this.x /= val;\r\n  this.y /= val;\r\n  return this;\r\n};\r\n\r\nVector2D.prototype.round = function() {\r\n  this.x = Math.round(this.x);\r\n  this.y = Math.round(this.y);\r\n  return this;\r\n};\r\n\r\nVector2D.prototype.dot = function(vector) {\r\n  return (this.x * vector.x) + (this.y * vector.y);\r\n};\r\n","/**\n * @author mrdoob / http://mrdoob.com/\n * @author jetienne / http://jetienne.com/\n * @author paulirish / http://paulirish.com/\n */\nfunction MemoryStats(){\n\n\tvar msMin\t= 100;\n\tvar msMax\t= 0;\n\n\tvar container\t= document.createElement( 'div' );\n\tcontainer.id\t= 'stats';\n\tcontainer.style.cssText = 'width:80px;opacity:0.9;cursor:pointer';\n\n\tvar msDiv\t= document.createElement( 'div' );\n\tmsDiv.id\t= 'ms';\n\tmsDiv.style.cssText = 'padding:0 0 3px 3px;text-align:left;background-color:#020;';\n\tcontainer.appendChild( msDiv );\n\n\tvar msText\t= document.createElement( 'div' );\n\tmsText.id\t= 'msText';\n\tmsText.style.cssText = 'color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px';\n\tmsText.innerHTML= 'Memory';\n\tmsDiv.appendChild( msText );\n\n\tvar msGraph\t= document.createElement( 'div' );\n\tmsGraph.id\t= 'msGraph';\n\tmsGraph.style.cssText = 'position:relative;width:74px;height:30px;background-color:#0f0';\n\tmsDiv.appendChild( msGraph );\n\n\twhile ( msGraph.children.length < 74 ) {\n\n\t\tvar bar = document.createElement( 'span' );\n\t\tbar.style.cssText = 'width:1px;height:30px;float:left;background-color:#131';\n\t\tmsGraph.appendChild( bar );\n\n\t}\n\n\tvar updateGraph = function ( dom, height, color ) {\n\n\t\tvar child = dom.appendChild( dom.firstChild );\n\t\tchild.style.height = height + 'px';\n\t\tif( color ) child.style.backgroundColor = color;\n\n\t}\n\n\t// polyfill usedJSHeapSize\n\tif (window.performance && !performance.memory){\n\t\tperformance.memory = { usedJSHeapSize : 0 };\n\t}\n\n\t// support of the API?\n\tif( performance.memory.totalJSHeapSize === 0 ){\n\t\tconsole.warn('totalJSHeapSize === 0... performance.memory is only available in Chrome .')\n\t}\n\n\t// TODO, add a sanity check to see if values are bucketed.\n\t// If so, reminde user to adopt the --enable-precise-memory-info flag.\n\t// open -a \"/Applications/Google Chrome.app\" --args --enable-precise-memory-info\n\n\tvar lastTime\t= Date.now();\n\tvar lastUsedHeap= performance.memory.usedJSHeapSize;\n\treturn {\n\t\tdomElement: container,\n\n\t\tupdate: function () {\n\n\t\t\t// refresh only 30time per second\n\t\t\tif( Date.now() - lastTime < 1000/30 )\treturn;\n\t\t\tlastTime\t= Date.now()\n\n\t\t\tvar delta\t= performance.memory.usedJSHeapSize - lastUsedHeap;\n\t\t\tlastUsedHeap\t= performance.memory.usedJSHeapSize;\n\t\t\tvar color\t= delta < 0 ? '#830' : '#131';\n\n\t\t\tvar ms\t= performance.memory.usedJSHeapSize;\n\t\t\tmsMin\t= Math.min( msMin, ms );\n\t\t\tmsMax\t= Math.max( msMax, ms );\n\t\t\tmsText.textContent = \"Mem: \" + bytesToSize(ms, 2);\n\n\t\t\tvar normValue\t= ms / (30*1024*1024);\n\t\t\tvar height\t= (1-(normValue% 1)) * 30;\n\t\t\tupdateGraph( msGraph, height, color);\n\n\t\t\tfunction bytesToSize( bytes, nFractDigit ){\n\t\t\t\tvar sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n\t\t\t\tif (bytes == 0) return 'n/a';\n\t\t\t\tnFractDigit\t= nFractDigit !== undefined ? nFractDigit : 0;\n\t\t\t\tvar precision\t= Math.pow(10, nFractDigit);\n\t\t\t\tvar i \t\t= Math.floor(Math.log(bytes) / Math.log(1024));\n\t\t\t\treturn Math.round(bytes*precision / Math.pow(1024, i))/precision + ' ' + sizes[i];\n\t\t\t};\n\t\t}\n\n\t}\n\n};\n\nmodule.exports = MemoryStats;\n","/* global PIXI */\nimport * as Core from '../lib/core';\n\nconst PI2 = Math.PI * 2;\n\n// See also: http://phrogz.net/JS/wheeldelta.html\nconst wheelDistance = function(evt){\n  if (!evt) evt = event;\n  const w=evt.wheelDelta, d=evt.detail;\n  if (d){\n    if (w) return w/d/40*d>0?1:-1; // Opera\n    else return -d/3;              // Firefox;         TODO: do not /3 for OS X\n  } else return w/120;             // IE/Safari/Chrome TODO: /3 for Chrome OS X\n};\n\nexport class ViewportPixi extends Core.System {\n\n  defaultOptions() {\n    return {\n      lineWidth: 2.5,\n      zoom: 1.0,\n      zoomMin: 0.1,\n      zoomMax: 10.0,\n      zoomWheelFactor: 0.05,\n      gridEnabled: true,\n      gridSize: 250,\n      gridColor: 0x222222,\n      followEnabled: true,\n      followName: null,\n      followEntityId: null\n    };\n  }\n\n  initialize() {\n    this.container = document.querySelector(this.options.container);\n    this.renderer = PIXI.autoDetectRenderer(\n      this.container.offsetWidth,\n      this.container.offsetHeight,\n      { antialias: true }\n    );\n    this.renderer.autoResize = true;\n    this.canvas = this.renderer.view;\n    this.container.appendChild(this.canvas);\n    this.stage = new PIXI.Container();\n\n    //this.filter = new PIXI.filters.FXAAFilter();\n    //this.filter.blur = 1;\n    //this.stage.filters = [ this.filter ];\n\n    this.backdrop = new PIXI.Graphics();\n    this.stage.addChild(this.backdrop);\n\n    this.graphics = {};\n\n    const events = {\n      'resize': (ev) => { this.updateMetrics(ev); },\n      'orientationchange': (ev) => { this.updateMetrics(ev); },\n      'mousedown': (ev) => { this.onMouseDown(ev); },\n      'mousemove': (ev) => { this.onMouseMove(ev); },\n      'mouseup': (ev) => { this.onMouseUp(ev); }\n    };\n\n    for (const name in events) {\n      this.canvas.addEventListener(name, events[name], false);\n    }\n\n    // See also: http://phrogz.net/JS/wheeldelta.html\n    const boundOnMouseWheel = (ev) => this.onMouseWheel(ev);\n    if (window.addEventListener){\n      window.addEventListener('mousewheel', boundOnMouseWheel, false); // Chrome/Safari/Opera\n      window.addEventListener('DOMMouseScroll', boundOnMouseWheel, false); // Firefox\n    } else if (window.attachEvent){\n      window.attachEvent('onmousewheel', boundOnMouseWheel); // IE\n    }\n\n    this.followEnabled = this.options.followEnabled;\n    this.zoom = this.options.zoom;\n    this.followEntityId = this.options.followEntityId;\n    this.gridEnabled = this.options.gridEnabled;\n    this.lineWidth = this.options.lineWidth;\n\n    this.cursorRawX = 0;\n    this.cursorRawY = 0;\n\n    this.cursorChanged = false;\n    this.cursorPosition = { x: 0, y: 0 };\n\n    this.cameraX = 0;\n    this.cameraY = 0;\n\n    this.debugDummySprite = { size: 100 };\n\n    this.updateMetrics();\n  }\n\n  onMouseWheel(ev) {\n    this.zoom += wheelDistance(ev) * this.options.zoomWheelFactor;\n    if (this.zoom < this.options.zoomMin) {\n      this.zoom = this.options.zoomMin;\n    }\n    if (this.zoom > this.options.zoomMax) {\n      this.zoom = this.options.zoomMax;\n    }\n  }\n\n  // TODO: Use a symbol for 'mouse{Down,Move,Up}' message?\n\n  onMouseDown(ev) {\n    this.setCursor(ev.clientX, ev.clientY);\n    this.world.publish('mouseDown', this.cursorPosition);\n  }\n\n  onMouseMove(ev) {\n    this.setCursor(ev.clientX, ev.clientY);\n    this.world.publish('mouseMove', this.cursorPosition);\n  }\n\n  onMouseUp(ev) {\n    this.setCursor(ev.clientX, ev.clientY);\n    this.world.publish('mouseUp', this.cursorPosition);\n  }\n\n  setCursor(x, y) {\n    const width = this.container.offsetWidth;\n    const height = this.container.offsetHeight;\n\n    this.cursorRawX = x;\n    this.cursorRawY = y;\n\n    const newX = ((x - (width / 2)) / this.zoom) + this.cameraX;\n    const newY = ((y - (height / 2)) / this.zoom) + this.cameraY;\n\n    this.cursorChanged = false;\n    if (newX !== this.cursorPosition.x || newY !== this.cursorPosition.y) {\n      this.cursorChanged = true;\n      this.cursorPosition.x = newX;\n      this.cursorPosition.y = newY;\n    }\n\n    return this.cursorPosition;\n  }\n\n  updateMetrics() {\n    const width = this.container.offsetWidth;\n    const height = this.container.offsetHeight;\n\n    this.visibleWidth = width / this.zoom;\n    this.visibleHeight = height / this.zoom;\n\n    this.visibleLeft = (0 - this.visibleWidth / 2) + this.cameraX;\n    this.visibleTop = (0 - this.visibleHeight / 2) + this.cameraY;\n    this.visibleRight = this.visibleLeft + this.visibleWidth;\n    this.visibleBottom = this.visibleTop + this.visibleHeight;\n  }\n\n  update(/*timeDelta*/) {\n    this.updateMetrics();\n\n    this.setCursor(this.cursorRawX, this.cursorRawY);\n    // FIXME: Should be able to skip doing this unless\n    // this.cursorChanged === true, but for some reason that's not working\n    this.world.publish('mouseMove', this.cursorPosition);\n\n    const sprites = this.world.get('Sprite');\n\n    const toRemove = Object.keys(this.graphics).filter(key => !(key in sprites));\n    toRemove.forEach(entityId => {\n      this.stage.removeChild(this.graphics[entityId]);\n      delete this.graphics[entityId];\n    });\n\n    const toAdd = Object.keys(sprites).filter(key => !(key in this.graphics));\n    toAdd.forEach(entityId => {\n      this.stage.addChild(this.graphics[entityId] = new PIXI.Graphics());\n    });\n  }\n\n  draw(timeDelta) {\n    this.followEntity();\n    this.drawBackdrop(timeDelta);\n\n    for (const entityId in this.graphics) {\n      this.drawSprite(this.graphics[entityId], entityId, timeDelta);\n    }\n\n    this.stage.setTransform(\n      (this.container.offsetWidth / 2) - (this.cameraX * this.zoom),\n      (this.container.offsetHeight / 2) - (this.cameraY * this.zoom),\n      this.zoom,\n      this.zoom\n    );\n\n    this.renderer.resize(\n      this.container.offsetWidth,\n      this.container.offsetHeight\n    );\n\n    this.renderer.render(this.stage);\n  }\n\n  drawSprite(ctx, entityId, timeDelta) {\n    const sprite = this.world.get('Sprite', entityId);\n    const position = this.world.get('Position', entityId);\n\n    let spriteFn = getSprite(sprite.name);\n    if (!spriteFn) { spriteFn = getSprite('default'); }\n\n    ctx.position.x = Math.floor(position.x);\n    ctx.position.y = Math.floor(position.y);\n    ctx.rotation = position.rotation + (Math.PI / 2);\n    ctx.scale.x = ctx.scale.y = sprite.size / 100;\n    ctx.lineStyle(this.lineWidth / (sprite.size / 100), 0xFFFFFF);\n    spriteFn(ctx, sprite, entityId, timeDelta);\n\n    sprite.drawn = true;\n    return ctx;\n  }\n\n  followEntity() {\n    if (!this.followEnabled) {\n      this.cameraX = this.cameraY = 0;\n      return;\n    }\n    if (this.options.followName && !this.followEntityId) {\n      // Look up named entity, if necessary.\n      this.followEntityId = Core.getComponent('Name')\n        .findEntityByName(this.world, this.options.followName);\n    }\n    if (this.followEntityId) {\n      // Adjust the viewport center offset to the entity position\n      const position = this.world.get('Position', this.followEntityId);\n      if (position) {\n        this.cameraX = position.x;\n        this.cameraY = position.y;\n        this.setCursor(this.cursorRawX, this.cursorRawY);\n      }\n    }\n  }\n\n  drawBackdrop(/* timeDelta */) {\n    const ctx = this.backdrop;\n\n    if (!this.gridEnabled) {\n      ctx.visible = false;\n      return;\n    }\n\n    const gridSize = this.options.gridSize;\n    const gridOffsetX = this.visibleLeft % gridSize;\n    const gridOffsetY = this.visibleTop % gridSize;\n\n    ctx.visible = true;\n    ctx.clear();\n    ctx.lineStyle(1, this.options.gridColor);\n    ctx.position.x = this.visibleLeft;\n    ctx.position.y = this.visibleTop;\n\n    for (let x = -gridOffsetX; x < this.visibleWidth; x += gridSize) {\n      ctx.moveTo(x, 0);\n      ctx.lineTo(x, this.visibleHeight + gridSize);\n    }\n\n    for (let y = -gridOffsetY; y < this.visibleHeight; y += gridSize) {\n      ctx.moveTo(0, y);\n      ctx.lineTo(this.visibleWidth + gridSize, y);\n    }\n  }\n\n}\n\nCore.registerSystem('ViewportPixi', ViewportPixi);\n\nexport class CanvasSprite extends Core.Component {\n  static defaults() {\n    return {\n      name: null,\n      color: '#fff',\n      size: 100,\n      width: null,\n      height: null,\n      drawn: false\n    };\n  }\n  static create(attrs) {\n    const c = super.create(attrs);\n    if (!c.width) { c.width = c.size; }\n    if (!c.height) { c.height = c.size; }\n    return c;\n  }\n}\n\nCore.registerComponent('Sprite', CanvasSprite);\n\nconst spriteRegistry = {};\nexport function registerSprite(name, sprite) {\n  spriteRegistry[name] = sprite;\n}\nexport function getSprite(name) {\n  return spriteRegistry[name];\n}\n\nregisterSprite('default', (ctx, sprite/*, entityId*/) => {\n  if (sprite.drawn) { return; }\n\n  ctx.arc(0, 0, 50, 0, PI2);\n  ctx.moveTo(0, 0);\n  ctx.lineTo(0, -50);\n  ctx.moveTo(0, 0);\n});\n\nregisterSprite('sun', (ctx, sprite/*, entityId*/) => {\n  if (sprite.drawn) { return; }\n\n  ctx.arc(0, 0, 50, 0, PI2, true);\n});\n\nregisterSprite('enemyscout', (ctx, sprite/*, entityId*/) => {\n  if (sprite.drawn) { return; }\n\n  ctx.moveTo(0, -50);\n  ctx.lineTo(-45, 50);\n  ctx.lineTo(-12.5, 12.5);\n  ctx.lineTo(0, 25);\n  ctx.lineTo(12.5, 12.5);\n  ctx.lineTo(45, 50);\n  ctx.lineTo(0, -50);\n  ctx.moveTo(0, -50);\n});\n\nregisterSprite('enemywing', (g, sprite/*, entityId*/) => {\n  if (sprite.drawn) { return; }\n\n  g.lineColor = 0x228822;\n\n  g.moveTo(-50, 0);\n  g.lineTo(-37.5, -37.5);\n  g.lineTo(0, 50);\n  g.lineTo(37.5, -37.5);\n  g.lineTo(50, 0);\n  g.lineTo(37.5, 50);\n  g.lineTo(25, 50);\n  g.lineTo(0, 0);\n  g.lineTo(-25, 50);\n  g.lineTo(-37.5, 50);\n  g.lineTo(-50, 0);\n});\n\nregisterSprite('hero', (g, sprite/*, entityId*/) => {\n  if (sprite.drawn) { return; }\n\n  g.moveTo(-50, 0);\n  g.lineTo(-37.5, -37.5);\n  g.lineTo(0, -50);\n  g.lineTo(37.5, -37.5);\n  g.lineTo(50, 0);\n  g.lineTo(37.5, 50);\n  g.lineTo(25, 50);\n  g.lineTo(12.5, 12.5);\n  g.lineTo(5, 25);\n  g.lineTo(-5, 25);\n  g.lineTo(-12.5, 12.5);\n  g.lineTo(-25, 50);\n  g.lineTo(-37.5, 50);\n  g.lineTo(-50, 0);\n});\n\nregisterSprite('asteroid', (ctx, sprite/*, entityId*/) => {\n  if (sprite.drawn) { return; }\n\n  const NUM_POINTS = 10 + Math.floor(8 * Math.random());\n  const MAX_RADIUS = 50;\n  const MIN_RADIUS = 35;\n  const ROTATION = PI2 / NUM_POINTS;\n\n  let idx;\n  const points = [];\n\n  for (idx = 0; idx < NUM_POINTS; idx++) {\n    const rot = idx * ROTATION;\n    const dist = (Math.random() * (MAX_RADIUS - MIN_RADIUS)) + MIN_RADIUS;\n    points.push(dist * Math.cos(rot));\n    points.push(dist * Math.sin(rot));\n  }\n  points.push(points[0]);\n  points.push(points[1]);\n\n  ctx.drawPolygon(points);\n});\n\nregisterSprite('mine', (g, sprite/*, entityId*/) => {\n  if (sprite.drawn && Math.random() > 0.1) { return; }\n\n  if (!sprite.drawn) {\n    let NUM_POINTS = 10 + Math.floor(10 * Math.random());\n    if (NUM_POINTS % 2 !== 0) { NUM_POINTS++; }\n\n    const MAX_RADIUS = 60;\n    const MIN_RADIUS = 10;\n    sprite.legs = [];\n    let even = false;\n    for (let idx = 0; idx < NUM_POINTS; idx++) {\n      const dist = even ? 10 : (Math.random() * (MAX_RADIUS - MIN_RADIUS)) + MIN_RADIUS;\n      sprite.legs.push(dist);\n      even = !even;\n    }\n  }\n\n  const points = [];\n  const ROTATION = PI2 / sprite.legs.length;\n  sprite.legs.forEach((dist, idx) => {\n    const shakeDist = dist * (0.9 + 0.5 * Math.random());\n    const rot = idx * ROTATION;\n    points.push(shakeDist * Math.cos(rot));\n    points.push(shakeDist * Math.sin(rot));\n  });\n  points.push(points[0]);\n  points.push(points[1]);\n\n  g.clear();\n  g.lineStyle(2.5 / (sprite.size / 100), 0xFF2222);\n  g.drawPolygon(points);\n});\n","/**\n * @author       Timo Hausmann\n * @author       Richard Davey <rich@photonstorm.com>\n * @copyright    2014 Photon Storm Ltd.\n * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}\n */\n\n/**\n * A QuadTree implementation. The original code was a conversion of the Java code posted to GameDevTuts.\n * However I've tweaked it massively to add node indexing, removed lots of temp. var creation and significantly increased performance as a result.\n * Original version at https://github.com/timohausmann/quadtree-js/\n *\n * @class QuadTree\n * @constructor\n * @param {number} x - The top left coordinate of the quadtree.\n * @param {number} y - The top left coordinate of the quadtree.\n * @param {number} width - The width of the quadtree in pixels.\n * @param {number} height - The height of the quadtree in pixels.\n * @param {number} [maxObjects=10] - The maximum number of objects per node.\n * @param {number} [maxLevels=4] - The maximum number of levels to iterate to.\n * @param {number} [level=0] - Which level is this?\n */\nexport default function QuadTree(left, top, width, height, maxObjects, maxLevels, level, root) {\n\n  /**\n   * @property {number} maxObjects - The maximum number of objects per node.\n   * @default\n   */\n  this.maxObjects = 10;\n\n  /**\n   * @property {number} maxLevels - The maximum number of levels to break down to.\n   * @default\n   */\n  this.maxLevels = 4;\n\n  /**\n   * @property {number} level - The current level.\n   */\n  this.level = 0;\n\n  /**\n   * @property {object} bounds - Object that contains the quadtree bounds.\n   */\n  this.bounds = {};\n\n  /**\n   * @property {array} objects - Array of quadtree children.\n   */\n  this.objects = [];\n\n  /**\n   * @property {array} nodes - Array of associated child nodes.\n   */\n  this.nodes = [];\n\n  /**\n   * @property {array} _empty - Internal empty array.\n   * @private\n   */\n  this._empty = [];\n\n  this.root = root || this;\n  this.entityMap = {};\n\n  this.reset(left, top, width, height, maxObjects, maxLevels, level);\n\n};\n\nQuadTree.prototype = {\n\n  /**\n   * Resets the QuadTree.\n   *\n   * @method QuadTree#reset\n   * @param {number} x - The top left coordinate of the quadtree.\n   * @param {number} y - The top left coordinate of the quadtree.\n   * @param {number} width - The width of the quadtree in pixels.\n   * @param {number} height - The height of the quadtree in pixels.\n   * @param {number} [maxObjects=10] - The maximum number of objects per node.\n   * @param {number} [maxLevels=4] - The maximum number of levels to iterate to.\n   * @param {number} [level=0] - Which level is this?\n   */\n  reset: function (left, top, width, height, maxObjects, maxLevels, level) {\n\n    this.maxObjects = maxObjects || 10;\n    this.maxLevels = maxLevels || 4;\n    this.level = level || 0;\n\n    this.bounds = {\n      width: width,\n      height: height,\n      subWidth: Math.floor(width / 2),\n      subHeight: Math.floor(height / 2),\n      left: Math.round(left),\n      top: Math.round(top),\n      midX: Math.round(left + width / 2),\n      midY: Math.round(top + height / 2),\n      right: Math.round(left + width),\n      bottom: Math.round(top + height)\n    };\n\n    this.objects.length = 0;\n    this.nodes.length = 0;\n\n  },\n\n  /**\n   * Split the node into 4 subnodes\n   *\n   * @method QuadTree#split\n   */\n  split: function () {\n\n    //  top right node\n    this.nodes[0] = new QuadTree(\n      this.bounds.left + this.bounds.subWidth,\n      this.bounds.top,\n      this.bounds.subWidth, this.bounds.subHeight,\n      this.maxObjects, this.maxLevels, (this.level + 1), this.root\n    );\n\n    //  top left node\n    this.nodes[1] = new QuadTree(\n      this.bounds.left,\n      this.bounds.top,\n      this.bounds.subWidth, this.bounds.subHeight,\n      this.maxObjects, this.maxLevels, (this.level + 1), this.root\n    );\n\n    //  bottom left node\n    this.nodes[2] = new QuadTree(\n      this.bounds.left,\n      this.bounds.top + this.bounds.subHeight,\n      this.bounds.subWidth, this.bounds.subHeight,\n      this.maxObjects, this.maxLevels, (this.level + 1), this.root\n    );\n\n    //  bottom right node\n    this.nodes[3] = new QuadTree(\n      this.bounds.left + this.bounds.subWidth,\n      this.bounds.top + this.bounds.subHeight,\n      this.bounds.subWidth, this.bounds.subHeight,\n      this.maxObjects, this.maxLevels, (this.level + 1), this.root\n    );\n\n  },\n\n  /**\n   * Insert the object into the node. If the node exceeds the capacity, it will split and add all objects to their corresponding subnodes.\n   *\n   * @method QuadTree#insert\n   * @param {Phaser.Physics.Arcade.Body|object} body - The Body object to insert into the quadtree. Can be any object so long as it exposes x, y, right and bottom properties.\n   */\n  insert: function (body) {\n\n    var i = 0;\n    var index;\n\n    //  if we have subnodes ...\n    if (this.nodes[0] != null) {\n      index = this.getIndex(body);\n      if (index !== -1) {\n        this.nodes[index].insert(body);\n        return;\n      }\n    }\n\n    // Check if we already have this item in the quadtree structure.\n    var oldNode = this.root.entityMap[body.entityId];\n    if (oldNode === this) {\n      // If we have the item, and it's this current sub-tree, then just bail.\n      return;\n    }\n    if (oldNode) {\n      // If the item is known, but in another sub-tree, then delete it from there.\n      var objectIndex = oldNode.objects.indexOf(body);\n      if (objectIndex !== -1) {\n        oldNode.objects.splice(objectIndex, 1);\n      }\n    }\n\n    /*\n    // TODO: Need the opposite of split() to consolidate subtrees when they\n    // lose items.\n\n    this.root.entityMap[body.entityId] = this;\n    */\n\n    this.objects.push(body);\n\n    if (this.objects.length > this.maxObjects && this.level < this.maxLevels) {\n      //  Split if we don't already have subnodes\n      if (this.nodes[0] == null) {\n        this.split();\n      }\n      //  Add objects to subnodes\n      while (i < this.objects.length) {\n        index = this.getIndex(this.objects[i]);\n        if (index !== -1) {\n          //  this is expensive - see what we can do about it\n          this.nodes[index].insert(this.objects.splice(i, 1)[0]);\n        } else {\n          i++;\n        }\n      }\n    }\n\n  },\n\n  /**\n   * Determine which node the object belongs to.\n   *\n   * @method QuadTree#getIndex\n   * @param {Phaser.Rectangle|object} rect - The bounds in which to check.\n   * @return {number} index - Index of the subnode (0-3), or -1 if rect cannot completely fit within a subnode and is part of the parent node.\n   */\n  getIndex: function (rect) {\n    if (rect.left < this.bounds.midX && rect.right < this.bounds.midX) {\n      if (rect.top < this.bounds.midY && rect.bottom < this.bounds.midY) {\n        //  rect fits within the top-left quadrant of this quadtree\n        return 1;\n      } else if (rect.top > this.bounds.midY) {\n        //  rect fits within the bottom-left quadrant of this quadtree\n        return 2;\n      }\n    } else if (rect.left > this.bounds.midX) {\n      //  rect can completely fit within the right quadrants\n      if (rect.top < this.bounds.midY && rect.bottom < this.bounds.midY) {\n        //  rect fits within the top-right quadrant of this quadtree\n        return 0;\n      } else if (rect.top > this.bounds.midY) {\n        //  rect fits within the bottom-right quadrant of this quadtree\n        return 3;\n      }\n    }\n    // rect doesn't fit, i.e. it straddles the internal quadrants\n    return -1;\n  },\n\n  /**\n   * Iterate through all objects that could collide with the given Sprite or Rectangle.\n   *\n   * @method QuadTree#retrieve\n   * @param {Phaser.Sprite|Phaser.Rectangle} source - The source object to check the QuadTree against. Either a Sprite or Rectangle.\n   */\n  iterate: function (source, iteratorFn, optionalParam) {\n    var index = this.getIndex(source);\n\n    for (var i = 0; i < this.objects.length; i++) {\n      iteratorFn(this.objects[i], optionalParam);\n    }\n\n    if (this.nodes[0]) {\n      //  If rect fits into a subnode ..\n      if (index !== -1) {\n        this.nodes[index].iterate(source, iteratorFn, optionalParam);\n      } else {\n        //  If rect does not fit into a subnode, check it against all subnodes (unrolled for speed)\n        this.nodes[0].iterate(source, iteratorFn, optionalParam);\n        this.nodes[1].iterate(source, iteratorFn, optionalParam);\n        this.nodes[2].iterate(source, iteratorFn, optionalParam);\n        this.nodes[3].iterate(source, iteratorFn, optionalParam);\n      }\n    }\n  },\n\n  /**\n   * Clear the quadtree.\n   * @method QuadTree#clear\n   */\n  clear: function () {\n    this.objects.length = 0;\n    var i = this.nodes.length;\n    while (i--) {\n      this.nodes[i].clear();\n      this.nodes.splice(i, 1);\n    }\n    this.nodes.length = 0;\n  }\n\n};\n\n/**\n * Javascript QuadTree\n * @version 1.0\n *\n * @version 1.3, March 11th 2014\n * @author Richard Davey\n * The original code was a conversion of the Java code posted to GameDevTuts. However I've tweaked\n * it massively to add node indexing, removed lots of temp. var creation and significantly\n * increased performance as a result.\n *\n * Original version at https://github.com/timohausmann/quadtree-js/\n */\n\n/**\n * @copyright Â© 2012 Timo Hausmann\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * \"Software\"), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE\n * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\n * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n","import * as Core from './lib/core';\n\nimport Vector2D from './lib/Vector2D';\n\nimport './plugins/drawStats';\nimport './plugins/memoryStats';\nimport './plugins/datGui';\nimport './plugins/viewportPixi';\nimport './plugins/name';\nimport './plugins/health';\nimport './plugins/position';\nimport './plugins/motion';\nimport './plugins/thruster';\nimport './plugins/seeker';\nimport './plugins/collision';\nimport './plugins/bounce';\nimport './plugins/playerInputSteering';\n\nconst debug = true;\n\nconst world = window.world = new Core.World({\n  systems: {\n    ViewportPixi: {\n      debug: debug,\n      container: '#game',\n      canvas: '#viewport',\n      followName: 'hero1',\n      zoom: 0.5\n    },\n    DrawStats: {},\n    MemoryStats: {},\n    DatGui: {},\n    PlayerInputSteering: {},\n    Motion: {},\n    Thruster: {},\n    Seeker: {},\n    Collision: {},\n    Bounce: {}\n  }\n});\n\nworld.insert({\n  Name: { name: 'hero1'},\n  Sprite: { name: 'hero', color: '#00f' },\n  Collidable: {},\n  Bounce: { mass: 7000 },\n  Position: { x: 0, y: 0 },\n  Motion: {},\n  Thruster: { deltaV: 1200, maxV: 650, active: false },\n  PlayerInputSteering: { radPerSec: Math.PI }\n});\n\nfunction spawnAsteroid(x, y, width, height, dx, dy, dr, mass, health) {\n  world.insert({\n    Sprite: { name: 'mine', size: width},\n    Health: { max: health },\n    Collidable: {},\n    Bounce: { mass: mass },\n    Position: { x: x, y: y },\n    Motion: { dx: dx, dy: dy, drotation: dr },\n    Thruster: { deltaV: 600 + Math.random() * 100, maxV: 300 + Math.random() * 200 },\n    Seeker: { targetName: 'hero1', radPerSec: 0.5 + Math.random() * 0.2 }\n  });\n}\n\nfunction spawnField(centerX, centerY, radius=300,\n    MAX_ASTEROIDS=150, MAX_TRIES=5, MIN_SIZE=100, MAX_SIZE=300, MAX_GRAV=10) {\n\n  const vCenter = new Vector2D(centerY, centerX);\n  const vSpawn = new Vector2D(0, 0);\n  const vGrav = new Vector2D(0, 0);\n  const inField = [];\n\n  for (let idx = 0; idx < MAX_ASTEROIDS; idx++) {\n    for (let c = 0; c < MAX_TRIES; c++) {\n\n      const size = ((MAX_SIZE - MIN_SIZE) * Math.random()) + MIN_SIZE;\n      const rot = (Math.PI*4) * Math.random();\n      vSpawn.setValues(vCenter.x, vCenter.y - (((radius - 1) * Math.random()) + 1));\n      vSpawn.rotateAround(vCenter, rot);\n\n      let isClear = true;\n      for (let fldIdx = 0; fldIdx < inField.length; fldIdx++) {\n        const item = inField[fldIdx];\n        if (Math.abs(vSpawn.x - item.x) * 2 >= (size + item.width) * 1.025) { continue; }\n        if (Math.abs(vSpawn.y - item.y) * 2 >= (size + item.height) * 1.025) { continue; }\n        isClear = false;\n        break;\n      }\n      if (!isClear) { continue; }\n\n      inField.push({ x: vSpawn.x, y: vSpawn.y, width: size, height: size });\n\n      vGrav.setValues(0, Math.random() * MAX_GRAV);\n      vGrav.rotate(rot);\n\n      spawnAsteroid(\n        vSpawn.x, vSpawn.y,\n        size, size,\n        vGrav.x, vGrav.y,\n        (Math.PI * 2) * Math.random(),\n        4 * size * size,\n        4 * size * size\n      );\n\n    }\n  }\n}\n\nconst pos = 1000;\nconst size = 600;\nconst num = 200;\n\nspawnField(-pos, -pos, size, num);\nspawnField(pos, pos, size, num);\nspawnField(pos, -pos, size, num);\nspawnField(-pos, pos, size, num);\n\nworld.start();\n\nconst vpSystem = world.getSystem('ViewportPixi');\nconst guiSystem = world.getSystem('DatGui');\nconst gui = guiSystem.gui;\n\ngui.add(world, 'isPaused');\ngui.add(world, 'debug');\ngui.add(vpSystem, 'zoom', vpSystem.options.zoomMin, vpSystem.options.zoomMax).listen();\ngui.add(vpSystem, 'lineWidth', 1.0, 4.0).step(0.5).listen();\n\nconst names = [ 'gridEnabled', 'followEnabled', 'cameraX', 'cameraY' ];\nnames.forEach(function (name) {\n  gui.add(vpSystem, name).listen();\n});\n\nconst cp = vpSystem.cursorPosition;\ngui.add(cp, 'x').listen();\ngui.add(cp, 'y').listen();\n","// stats.js - http://github.com/mrdoob/stats.js\nvar Stats=function(){var l=Date.now(),m=l,g=0,n=Infinity,o=0,h=0,p=Infinity,q=0,r=0,s=0,f=document.createElement(\"div\");f.id=\"stats\";f.addEventListener(\"mousedown\",function(b){b.preventDefault();t(++s%2)},!1);f.style.cssText=\"width:80px;opacity:0.9;cursor:pointer\";var a=document.createElement(\"div\");a.id=\"fps\";a.style.cssText=\"padding:0 0 3px 3px;text-align:left;background-color:#002\";f.appendChild(a);var i=document.createElement(\"div\");i.id=\"fpsText\";i.style.cssText=\"color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px\";\ni.innerHTML=\"FPS\";a.appendChild(i);var c=document.createElement(\"div\");c.id=\"fpsGraph\";c.style.cssText=\"position:relative;width:74px;height:30px;background-color:#0ff\";for(a.appendChild(c);74>c.children.length;){var j=document.createElement(\"span\");j.style.cssText=\"width:1px;height:30px;float:left;background-color:#113\";c.appendChild(j)}var d=document.createElement(\"div\");d.id=\"ms\";d.style.cssText=\"padding:0 0 3px 3px;text-align:left;background-color:#020;display:none\";f.appendChild(d);var k=document.createElement(\"div\");\nk.id=\"msText\";k.style.cssText=\"color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px\";k.innerHTML=\"MS\";d.appendChild(k);var e=document.createElement(\"div\");e.id=\"msGraph\";e.style.cssText=\"position:relative;width:74px;height:30px;background-color:#0f0\";for(d.appendChild(e);74>e.children.length;)j=document.createElement(\"span\"),j.style.cssText=\"width:1px;height:30px;float:left;background-color:#131\",e.appendChild(j);var t=function(b){s=b;switch(s){case 0:a.style.display=\n\"block\";d.style.display=\"none\";break;case 1:a.style.display=\"none\",d.style.display=\"block\"}};return{REVISION:12,domElement:f,setMode:t,begin:function(){l=Date.now()},end:function(){var b=Date.now();g=b-l;n=Math.min(n,g);o=Math.max(o,g);k.textContent=g+\" MS (\"+n+\"-\"+o+\")\";var a=Math.min(30,30-30*(g/200));e.appendChild(e.firstChild).style.height=a+\"px\";r++;b>m+1E3&&(h=Math.round(1E3*r/(b-m)),p=Math.min(p,h),q=Math.max(q,h),i.textContent=h+\" FPS (\"+p+\"-\"+q+\")\",a=Math.min(30,30-30*(h/100)),c.appendChild(c.firstChild).style.height=\na+\"px\",m=b,r=0);return b},update:function(){l=this.end()}}};\"object\"===typeof module&&(module.exports=Stats);\n","import * as Core from '../lib/core';\r\n\r\nimport Stats from 'stats-js';\r\n\r\nexport class DrawStats extends Core.System {\r\n\r\n  initialize() {\r\n\r\n    this.drawStats = new Stats();\r\n    this.drawStats.setMode(0);\r\n    this.drawStats.domElement.style.position = 'absolute';\r\n    this.drawStats.domElement.style.left = '0px';\r\n    this.drawStats.domElement.style.top = '0px';\r\n    document.body.appendChild(this.drawStats.domElement);\r\n\r\n    this.tickStats = new Stats();\r\n    this.tickStats.setMode(0);\r\n    this.tickStats.domElement.style.position = 'absolute';\r\n    this.tickStats.domElement.style.left = '0px';\r\n    this.tickStats.domElement.style.top = '55px';\r\n    document.body.appendChild(this.tickStats.domElement);\r\n\r\n  }\r\n\r\n  updateStart() { this.tickStats.begin(); }\r\n\r\n  updateEnd() { this.tickStats.end(); }\r\n\r\n  drawStart() { this.drawStats.begin(); }\r\n\r\n  drawEnd() { this.drawStats.end(); }\r\n\r\n}\r\nCore.registerSystem('DrawStats', DrawStats);\r\n","import * as Core from '../lib/core';\r\n\r\nimport MemoryStats from 'memory-stats';\r\n\r\nexport class MemoryStatsSystem extends Core.System {\r\n\r\n  initialize() {\r\n    this.stats = new MemoryStats();\r\n    this.stats.domElement.style.position = 'fixed';\r\n    this.stats.domElement.style.left = '85px';\r\n    this.stats.domElement.style.top = '0px';\r\n    document.body.appendChild(this.stats.domElement);\r\n  }\r\n\r\n  draw() { this.stats.update(); }\r\n\r\n}\r\nCore.registerSystem('MemoryStats', MemoryStatsSystem);\r\n","/**\n * dat-gui JavaScript Controller Library\n * http://code.google.com/p/dat-gui\n *\n * Copyright 2011 Data Arts Team, Google Creative Lab\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n */\n\n/** @namespace */\nvar dat = module.exports = dat || {};\n\n/** @namespace */\ndat.gui = dat.gui || {};\n\n/** @namespace */\ndat.utils = dat.utils || {};\n\n/** @namespace */\ndat.controllers = dat.controllers || {};\n\n/** @namespace */\ndat.dom = dat.dom || {};\n\n/** @namespace */\ndat.color = dat.color || {};\n\ndat.utils.css = (function () {\n  return {\n    load: function (url, doc) {\n      doc = doc || document;\n      var link = doc.createElement('link');\n      link.type = 'text/css';\n      link.rel = 'stylesheet';\n      link.href = url;\n      doc.getElementsByTagName('head')[0].appendChild(link);\n    },\n    inject: function(css, doc) {\n      doc = doc || document;\n      var injected = document.createElement('style');\n      injected.type = 'text/css';\n      injected.innerHTML = css;\n      doc.getElementsByTagName('head')[0].appendChild(injected);\n    }\n  }\n})();\n\n\ndat.utils.common = (function () {\n  \n  var ARR_EACH = Array.prototype.forEach;\n  var ARR_SLICE = Array.prototype.slice;\n\n  /**\n   * Band-aid methods for things that should be a lot easier in JavaScript.\n   * Implementation and structure inspired by underscore.js\n   * http://documentcloud.github.com/underscore/\n   */\n\n  return { \n    \n    BREAK: {},\n  \n    extend: function(target) {\n      \n      this.each(ARR_SLICE.call(arguments, 1), function(obj) {\n        \n        for (var key in obj)\n          if (!this.isUndefined(obj[key])) \n            target[key] = obj[key];\n        \n      }, this);\n      \n      return target;\n      \n    },\n    \n    defaults: function(target) {\n      \n      this.each(ARR_SLICE.call(arguments, 1), function(obj) {\n        \n        for (var key in obj)\n          if (this.isUndefined(target[key])) \n            target[key] = obj[key];\n        \n      }, this);\n      \n      return target;\n    \n    },\n    \n    compose: function() {\n      var toCall = ARR_SLICE.call(arguments);\n            return function() {\n              var args = ARR_SLICE.call(arguments);\n              for (var i = toCall.length -1; i >= 0; i--) {\n                args = [toCall[i].apply(this, args)];\n              }\n              return args[0];\n            }\n    },\n    \n    each: function(obj, itr, scope) {\n\n      \n      if (ARR_EACH && obj.forEach === ARR_EACH) { \n        \n        obj.forEach(itr, scope);\n        \n      } else if (obj.length === obj.length + 0) { // Is number but not NaN\n        \n        for (var key = 0, l = obj.length; key < l; key++)\n          if (key in obj && itr.call(scope, obj[key], key) === this.BREAK) \n            return;\n            \n      } else {\n\n        for (var key in obj) \n          if (itr.call(scope, obj[key], key) === this.BREAK)\n            return;\n            \n      }\n            \n    },\n    \n    defer: function(fnc) {\n      setTimeout(fnc, 0);\n    },\n    \n    toArray: function(obj) {\n      if (obj.toArray) return obj.toArray();\n      return ARR_SLICE.call(obj);\n    },\n\n    isUndefined: function(obj) {\n      return obj === undefined;\n    },\n    \n    isNull: function(obj) {\n      return obj === null;\n    },\n    \n    isNaN: function(obj) {\n      return obj !== obj;\n    },\n    \n    isArray: Array.isArray || function(obj) {\n      return obj.constructor === Array;\n    },\n    \n    isObject: function(obj) {\n      return obj === Object(obj);\n    },\n    \n    isNumber: function(obj) {\n      return obj === obj+0;\n    },\n    \n    isString: function(obj) {\n      return obj === obj+'';\n    },\n    \n    isBoolean: function(obj) {\n      return obj === false || obj === true;\n    },\n    \n    isFunction: function(obj) {\n      return Object.prototype.toString.call(obj) === '[object Function]';\n    }\n  \n  };\n    \n})();\n\n\ndat.controllers.Controller = (function (common) {\n\n  /**\n   * @class An \"abstract\" class that represents a given property of an object.\n   *\n   * @param {Object} object The object to be manipulated\n   * @param {string} property The name of the property to be manipulated\n   *\n   * @member dat.controllers\n   */\n  var Controller = function(object, property) {\n\n    this.initialValue = object[property];\n\n    /**\n     * Those who extend this class will put their DOM elements in here.\n     * @type {DOMElement}\n     */\n    this.domElement = document.createElement('div');\n\n    /**\n     * The object to manipulate\n     * @type {Object}\n     */\n    this.object = object;\n\n    /**\n     * The name of the property to manipulate\n     * @type {String}\n     */\n    this.property = property;\n\n    /**\n     * The function to be called on change.\n     * @type {Function}\n     * @ignore\n     */\n    this.__onChange = undefined;\n\n    /**\n     * The function to be called on finishing change.\n     * @type {Function}\n     * @ignore\n     */\n    this.__onFinishChange = undefined;\n\n  };\n\n  common.extend(\n\n      Controller.prototype,\n\n      /** @lends dat.controllers.Controller.prototype */\n      {\n\n        /**\n         * Specify that a function fire every time someone changes the value with\n         * this Controller.\n         *\n         * @param {Function} fnc This function will be called whenever the value\n         * is modified via this Controller.\n         * @returns {dat.controllers.Controller} this\n         */\n        onChange: function(fnc) {\n          this.__onChange = fnc;\n          return this;\n        },\n\n        /**\n         * Specify that a function fire every time someone \"finishes\" changing\n         * the value wih this Controller. Useful for values that change\n         * incrementally like numbers or strings.\n         *\n         * @param {Function} fnc This function will be called whenever\n         * someone \"finishes\" changing the value via this Controller.\n         * @returns {dat.controllers.Controller} this\n         */\n        onFinishChange: function(fnc) {\n          this.__onFinishChange = fnc;\n          return this;\n        },\n\n        /**\n         * Change the value of <code>object[property]</code>\n         *\n         * @param {Object} newValue The new value of <code>object[property]</code>\n         */\n        setValue: function(newValue) {\n          this.object[this.property] = newValue;\n          if (this.__onChange) {\n            this.__onChange.call(this, newValue);\n          }\n          this.updateDisplay();\n          return this;\n        },\n\n        /**\n         * Gets the value of <code>object[property]</code>\n         *\n         * @returns {Object} The current value of <code>object[property]</code>\n         */\n        getValue: function() {\n          return this.object[this.property];\n        },\n\n        /**\n         * Refreshes the visual display of a Controller in order to keep sync\n         * with the object's current value.\n         * @returns {dat.controllers.Controller} this\n         */\n        updateDisplay: function() {\n          return this;\n        },\n\n        /**\n         * @returns {Boolean} true if the value has deviated from initialValue\n         */\n        isModified: function() {\n          return this.initialValue !== this.getValue()\n        }\n\n      }\n\n  );\n\n  return Controller;\n\n\n})(dat.utils.common);\n\n\ndat.dom.dom = (function (common) {\n\n  var EVENT_MAP = {\n    'HTMLEvents': ['change'],\n    'MouseEvents': ['click','mousemove','mousedown','mouseup', 'mouseover'],\n    'KeyboardEvents': ['keydown']\n  };\n\n  var EVENT_MAP_INV = {};\n  common.each(EVENT_MAP, function(v, k) {\n    common.each(v, function(e) {\n      EVENT_MAP_INV[e] = k;\n    });\n  });\n\n  var CSS_VALUE_PIXELS = /(\\d+(\\.\\d+)?)px/;\n\n  function cssValueToPixels(val) {\n\n    if (val === '0' || common.isUndefined(val)) return 0;\n\n    var match = val.match(CSS_VALUE_PIXELS);\n\n    if (!common.isNull(match)) {\n      return parseFloat(match[1]);\n    }\n\n    // TODO ...ems? %?\n\n    return 0;\n\n  }\n\n  /**\n   * @namespace\n   * @member dat.dom\n   */\n  var dom = {\n\n    /**\n     * \n     * @param elem\n     * @param selectable\n     */\n    makeSelectable: function(elem, selectable) {\n\n      if (elem === undefined || elem.style === undefined) return;\n\n      elem.onselectstart = selectable ? function() {\n        return false;\n      } : function() {\n      };\n\n      elem.style.MozUserSelect = selectable ? 'auto' : 'none';\n      elem.style.KhtmlUserSelect = selectable ? 'auto' : 'none';\n      elem.unselectable = selectable ? 'on' : 'off';\n\n    },\n\n    /**\n     *\n     * @param elem\n     * @param horizontal\n     * @param vertical\n     */\n    makeFullscreen: function(elem, horizontal, vertical) {\n\n      if (common.isUndefined(horizontal)) horizontal = true;\n      if (common.isUndefined(vertical)) vertical = true;\n\n      elem.style.position = 'absolute';\n\n      if (horizontal) {\n        elem.style.left = 0;\n        elem.style.right = 0;\n      }\n      if (vertical) {\n        elem.style.top = 0;\n        elem.style.bottom = 0;\n      }\n\n    },\n\n    /**\n     *\n     * @param elem\n     * @param eventType\n     * @param params\n     */\n    fakeEvent: function(elem, eventType, params, aux) {\n      params = params || {};\n      var className = EVENT_MAP_INV[eventType];\n      if (!className) {\n        throw new Error('Event type ' + eventType + ' not supported.');\n      }\n      var evt = document.createEvent(className);\n      switch (className) {\n        case 'MouseEvents':\n          var clientX = params.x || params.clientX || 0;\n          var clientY = params.y || params.clientY || 0;\n          evt.initMouseEvent(eventType, params.bubbles || false,\n              params.cancelable || true, window, params.clickCount || 1,\n              0, //screen X\n              0, //screen Y\n              clientX, //client X\n              clientY, //client Y\n              false, false, false, false, 0, null);\n          break;\n        case 'KeyboardEvents':\n          var init = evt.initKeyboardEvent || evt.initKeyEvent; // webkit || moz\n          common.defaults(params, {\n            cancelable: true,\n            ctrlKey: false,\n            altKey: false,\n            shiftKey: false,\n            metaKey: false,\n            keyCode: undefined,\n            charCode: undefined\n          });\n          init(eventType, params.bubbles || false,\n              params.cancelable, window,\n              params.ctrlKey, params.altKey,\n              params.shiftKey, params.metaKey,\n              params.keyCode, params.charCode);\n          break;\n        default:\n          evt.initEvent(eventType, params.bubbles || false,\n              params.cancelable || true);\n          break;\n      }\n      common.defaults(evt, aux);\n      elem.dispatchEvent(evt);\n    },\n\n    /**\n     *\n     * @param elem\n     * @param event\n     * @param func\n     * @param bool\n     */\n    bind: function(elem, event, func, bool) {\n      bool = bool || false;\n      if (elem.addEventListener)\n        elem.addEventListener(event, func, bool);\n      else if (elem.attachEvent)\n        elem.attachEvent('on' + event, func);\n      return dom;\n    },\n\n    /**\n     *\n     * @param elem\n     * @param event\n     * @param func\n     * @param bool\n     */\n    unbind: function(elem, event, func, bool) {\n      bool = bool || false;\n      if (elem.removeEventListener)\n        elem.removeEventListener(event, func, bool);\n      else if (elem.detachEvent)\n        elem.detachEvent('on' + event, func);\n      return dom;\n    },\n\n    /**\n     *\n     * @param elem\n     * @param className\n     */\n    addClass: function(elem, className) {\n      if (elem.className === undefined) {\n        elem.className = className;\n      } else if (elem.className !== className) {\n        var classes = elem.className.split(/ +/);\n        if (classes.indexOf(className) == -1) {\n          classes.push(className);\n          elem.className = classes.join(' ').replace(/^\\s+/, '').replace(/\\s+$/, '');\n        }\n      }\n      return dom;\n    },\n\n    /**\n     *\n     * @param elem\n     * @param className\n     */\n    removeClass: function(elem, className) {\n      if (className) {\n        if (elem.className === undefined) {\n          // elem.className = className;\n        } else if (elem.className === className) {\n          elem.removeAttribute('class');\n        } else {\n          var classes = elem.className.split(/ +/);\n          var index = classes.indexOf(className);\n          if (index != -1) {\n            classes.splice(index, 1);\n            elem.className = classes.join(' ');\n          }\n        }\n      } else {\n        elem.className = undefined;\n      }\n      return dom;\n    },\n\n    hasClass: function(elem, className) {\n      return new RegExp('(?:^|\\\\s+)' + className + '(?:\\\\s+|$)').test(elem.className) || false;\n    },\n\n    /**\n     *\n     * @param elem\n     */\n    getWidth: function(elem) {\n\n      var style = getComputedStyle(elem);\n\n      return cssValueToPixels(style['border-left-width']) +\n          cssValueToPixels(style['border-right-width']) +\n          cssValueToPixels(style['padding-left']) +\n          cssValueToPixels(style['padding-right']) +\n          cssValueToPixels(style['width']);\n    },\n\n    /**\n     *\n     * @param elem\n     */\n    getHeight: function(elem) {\n\n      var style = getComputedStyle(elem);\n\n      return cssValueToPixels(style['border-top-width']) +\n          cssValueToPixels(style['border-bottom-width']) +\n          cssValueToPixels(style['padding-top']) +\n          cssValueToPixels(style['padding-bottom']) +\n          cssValueToPixels(style['height']);\n    },\n\n    /**\n     *\n     * @param elem\n     */\n    getOffset: function(elem) {\n      var offset = {left: 0, top:0};\n      if (elem.offsetParent) {\n        do {\n          offset.left += elem.offsetLeft;\n          offset.top += elem.offsetTop;\n        } while (elem = elem.offsetParent);\n      }\n      return offset;\n    },\n\n    // http://stackoverflow.com/posts/2684561/revisions\n    /**\n     * \n     * @param elem\n     */\n    isActive: function(elem) {\n      return elem === document.activeElement && ( elem.type || elem.href );\n    }\n\n  };\n\n  return dom;\n\n})(dat.utils.common);\n\n\ndat.controllers.OptionController = (function (Controller, dom, common) {\n\n  /**\n   * @class Provides a select input to alter the property of an object, using a\n   * list of accepted values.\n   *\n   * @extends dat.controllers.Controller\n   *\n   * @param {Object} object The object to be manipulated\n   * @param {string} property The name of the property to be manipulated\n   * @param {Object|string[]} options A map of labels to acceptable values, or\n   * a list of acceptable string values.\n   *\n   * @member dat.controllers\n   */\n  var OptionController = function(object, property, options) {\n\n    OptionController.superclass.call(this, object, property);\n\n    var _this = this;\n\n    /**\n     * The drop down menu\n     * @ignore\n     */\n    this.__select = document.createElement('select');\n\n    if (common.isArray(options)) {\n      var map = {};\n      common.each(options, function(element) {\n        map[element] = element;\n      });\n      options = map;\n    }\n\n    common.each(options, function(value, key) {\n\n      var opt = document.createElement('option');\n      opt.innerHTML = key;\n      opt.setAttribute('value', value);\n      _this.__select.appendChild(opt);\n\n    });\n\n    // Acknowledge original value\n    this.updateDisplay();\n\n    dom.bind(this.__select, 'change', function() {\n      var desiredValue = this.options[this.selectedIndex].value;\n      _this.setValue(desiredValue);\n    });\n\n    this.domElement.appendChild(this.__select);\n\n  };\n\n  OptionController.superclass = Controller;\n\n  common.extend(\n\n      OptionController.prototype,\n      Controller.prototype,\n\n      {\n\n        setValue: function(v) {\n          var toReturn = OptionController.superclass.prototype.setValue.call(this, v);\n          if (this.__onFinishChange) {\n            this.__onFinishChange.call(this, this.getValue());\n          }\n          return toReturn;\n        },\n\n        updateDisplay: function() {\n          this.__select.value = this.getValue();\n          return OptionController.superclass.prototype.updateDisplay.call(this);\n        }\n\n      }\n\n  );\n\n  return OptionController;\n\n})(dat.controllers.Controller,\ndat.dom.dom,\ndat.utils.common);\n\n\ndat.controllers.NumberController = (function (Controller, common) {\n\n  /**\n   * @class Represents a given property of an object that is a number.\n   *\n   * @extends dat.controllers.Controller\n   *\n   * @param {Object} object The object to be manipulated\n   * @param {string} property The name of the property to be manipulated\n   * @param {Object} [params] Optional parameters\n   * @param {Number} [params.min] Minimum allowed value\n   * @param {Number} [params.max] Maximum allowed value\n   * @param {Number} [params.step] Increment by which to change value\n   *\n   * @member dat.controllers\n   */\n  var NumberController = function(object, property, params) {\n\n    NumberController.superclass.call(this, object, property);\n\n    params = params || {};\n\n    this.__min = params.min;\n    this.__max = params.max;\n    this.__step = params.step;\n\n    if (common.isUndefined(this.__step)) {\n\n      if (this.initialValue == 0) {\n        this.__impliedStep = 1; // What are we, psychics?\n      } else {\n        // Hey Doug, check this out.\n        this.__impliedStep = Math.pow(10, Math.floor(Math.log(this.initialValue)/Math.LN10))/10;\n      }\n\n    } else {\n\n      this.__impliedStep = this.__step;\n\n    }\n\n    this.__precision = numDecimals(this.__impliedStep);\n\n\n  };\n\n  NumberController.superclass = Controller;\n\n  common.extend(\n\n      NumberController.prototype,\n      Controller.prototype,\n\n      /** @lends dat.controllers.NumberController.prototype */\n      {\n\n        setValue: function(v) {\n\n          if (this.__min !== undefined && v < this.__min) {\n            v = this.__min;\n          } else if (this.__max !== undefined && v > this.__max) {\n            v = this.__max;\n          }\n\n          if (this.__step !== undefined && v % this.__step != 0) {\n            v = Math.round(v / this.__step) * this.__step;\n          }\n\n          return NumberController.superclass.prototype.setValue.call(this, v);\n\n        },\n\n        /**\n         * Specify a minimum value for <code>object[property]</code>.\n         *\n         * @param {Number} minValue The minimum value for\n         * <code>object[property]</code>\n         * @returns {dat.controllers.NumberController} this\n         */\n        min: function(v) {\n          this.__min = v;\n          return this;\n        },\n\n        /**\n         * Specify a maximum value for <code>object[property]</code>.\n         *\n         * @param {Number} maxValue The maximum value for\n         * <code>object[property]</code>\n         * @returns {dat.controllers.NumberController} this\n         */\n        max: function(v) {\n          this.__max = v;\n          return this;\n        },\n\n        /**\n         * Specify a step value that dat.controllers.NumberController\n         * increments by.\n         *\n         * @param {Number} stepValue The step value for\n         * dat.controllers.NumberController\n         * @default if minimum and maximum specified increment is 1% of the\n         * difference otherwise stepValue is 1\n         * @returns {dat.controllers.NumberController} this\n         */\n        step: function(v) {\n          this.__step = v;\n          return this;\n        }\n\n      }\n\n  );\n\n  function numDecimals(x) {\n    x = x.toString();\n    if (x.indexOf('.') > -1) {\n      return x.length - x.indexOf('.') - 1;\n    } else {\n      return 0;\n    }\n  }\n\n  return NumberController;\n\n})(dat.controllers.Controller,\ndat.utils.common);\n\n\ndat.controllers.NumberControllerBox = (function (NumberController, dom, common) {\n\n  /**\n   * @class Represents a given property of an object that is a number and\n   * provides an input element with which to manipulate it.\n   *\n   * @extends dat.controllers.Controller\n   * @extends dat.controllers.NumberController\n   *\n   * @param {Object} object The object to be manipulated\n   * @param {string} property The name of the property to be manipulated\n   * @param {Object} [params] Optional parameters\n   * @param {Number} [params.min] Minimum allowed value\n   * @param {Number} [params.max] Maximum allowed value\n   * @param {Number} [params.step] Increment by which to change value\n   *\n   * @member dat.controllers\n   */\n  var NumberControllerBox = function(object, property, params) {\n\n    this.__truncationSuspended = false;\n\n    NumberControllerBox.superclass.call(this, object, property, params);\n\n    var _this = this;\n\n    /**\n     * {Number} Previous mouse y position\n     * @ignore\n     */\n    var prev_y;\n\n    this.__input = document.createElement('input');\n    this.__input.setAttribute('type', 'text');\n\n    // Makes it so manually specified values are not truncated.\n\n    dom.bind(this.__input, 'change', onChange);\n    dom.bind(this.__input, 'blur', onBlur);\n    dom.bind(this.__input, 'mousedown', onMouseDown);\n    dom.bind(this.__input, 'keydown', function(e) {\n\n      // When pressing entire, you can be as precise as you want.\n      if (e.keyCode === 13) {\n        _this.__truncationSuspended = true;\n        this.blur();\n        _this.__truncationSuspended = false;\n      }\n\n    });\n\n    function onChange() {\n      var attempted = parseFloat(_this.__input.value);\n      if (!common.isNaN(attempted)) _this.setValue(attempted);\n    }\n\n    function onBlur() {\n      onChange();\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n\n    function onMouseDown(e) {\n      dom.bind(window, 'mousemove', onMouseDrag);\n      dom.bind(window, 'mouseup', onMouseUp);\n      prev_y = e.clientY;\n    }\n\n    function onMouseDrag(e) {\n\n      var diff = prev_y - e.clientY;\n      _this.setValue(_this.getValue() + diff * _this.__impliedStep);\n\n      prev_y = e.clientY;\n\n    }\n\n    function onMouseUp() {\n      dom.unbind(window, 'mousemove', onMouseDrag);\n      dom.unbind(window, 'mouseup', onMouseUp);\n    }\n\n    this.updateDisplay();\n\n    this.domElement.appendChild(this.__input);\n\n  };\n\n  NumberControllerBox.superclass = NumberController;\n\n  common.extend(\n\n      NumberControllerBox.prototype,\n      NumberController.prototype,\n\n      {\n\n        updateDisplay: function() {\n\n          this.__input.value = this.__truncationSuspended ? this.getValue() : roundToDecimal(this.getValue(), this.__precision);\n          return NumberControllerBox.superclass.prototype.updateDisplay.call(this);\n        }\n\n      }\n\n  );\n\n  function roundToDecimal(value, decimals) {\n    var tenTo = Math.pow(10, decimals);\n    return Math.round(value * tenTo) / tenTo;\n  }\n\n  return NumberControllerBox;\n\n})(dat.controllers.NumberController,\ndat.dom.dom,\ndat.utils.common);\n\n\ndat.controllers.NumberControllerSlider = (function (NumberController, dom, css, common, styleSheet) {\n\n  /**\n   * @class Represents a given property of an object that is a number, contains\n   * a minimum and maximum, and provides a slider element with which to\n   * manipulate it. It should be noted that the slider element is made up of\n   * <code>&lt;div&gt;</code> tags, <strong>not</strong> the html5\n   * <code>&lt;slider&gt;</code> element.\n   *\n   * @extends dat.controllers.Controller\n   * @extends dat.controllers.NumberController\n   * \n   * @param {Object} object The object to be manipulated\n   * @param {string} property The name of the property to be manipulated\n   * @param {Number} minValue Minimum allowed value\n   * @param {Number} maxValue Maximum allowed value\n   * @param {Number} stepValue Increment by which to change value\n   *\n   * @member dat.controllers\n   */\n  var NumberControllerSlider = function(object, property, min, max, step) {\n\n    NumberControllerSlider.superclass.call(this, object, property, { min: min, max: max, step: step });\n\n    var _this = this;\n\n    this.__background = document.createElement('div');\n    this.__foreground = document.createElement('div');\n    \n\n\n    dom.bind(this.__background, 'mousedown', onMouseDown);\n    \n    dom.addClass(this.__background, 'slider');\n    dom.addClass(this.__foreground, 'slider-fg');\n\n    function onMouseDown(e) {\n\n      dom.bind(window, 'mousemove', onMouseDrag);\n      dom.bind(window, 'mouseup', onMouseUp);\n\n      onMouseDrag(e);\n    }\n\n    function onMouseDrag(e) {\n\n      e.preventDefault();\n\n      var offset = dom.getOffset(_this.__background);\n      var width = dom.getWidth(_this.__background);\n      \n      _this.setValue(\n        map(e.clientX, offset.left, offset.left + width, _this.__min, _this.__max)\n      );\n\n      return false;\n\n    }\n\n    function onMouseUp() {\n      dom.unbind(window, 'mousemove', onMouseDrag);\n      dom.unbind(window, 'mouseup', onMouseUp);\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n\n    this.updateDisplay();\n\n    this.__background.appendChild(this.__foreground);\n    this.domElement.appendChild(this.__background);\n\n  };\n\n  NumberControllerSlider.superclass = NumberController;\n\n  /**\n   * Injects default stylesheet for slider elements.\n   */\n  NumberControllerSlider.useDefaultStyles = function() {\n    css.inject(styleSheet);\n  };\n\n  common.extend(\n\n      NumberControllerSlider.prototype,\n      NumberController.prototype,\n\n      {\n\n        updateDisplay: function() {\n          var pct = (this.getValue() - this.__min)/(this.__max - this.__min);\n          this.__foreground.style.width = pct*100+'%';\n          return NumberControllerSlider.superclass.prototype.updateDisplay.call(this);\n        }\n\n      }\n\n\n\n  );\n\n  function map(v, i1, i2, o1, o2) {\n    return o1 + (o2 - o1) * ((v - i1) / (i2 - i1));\n  }\n\n  return NumberControllerSlider;\n  \n})(dat.controllers.NumberController,\ndat.dom.dom,\ndat.utils.css,\ndat.utils.common,\n\".slider {\\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\\n  height: 1em;\\n  border-radius: 1em;\\n  background-color: #eee;\\n  padding: 0 0.5em;\\n  overflow: hidden;\\n}\\n\\n.slider-fg {\\n  padding: 1px 0 2px 0;\\n  background-color: #aaa;\\n  height: 1em;\\n  margin-left: -0.5em;\\n  padding-right: 0.5em;\\n  border-radius: 1em 0 0 1em;\\n}\\n\\n.slider-fg:after {\\n  display: inline-block;\\n  border-radius: 1em;\\n  background-color: #fff;\\n  border:  1px solid #aaa;\\n  content: '';\\n  float: right;\\n  margin-right: -1em;\\n  margin-top: -1px;\\n  height: 0.9em;\\n  width: 0.9em;\\n}\");\n\n\ndat.controllers.FunctionController = (function (Controller, dom, common) {\n\n  /**\n   * @class Provides a GUI interface to fire a specified method, a property of an object.\n   *\n   * @extends dat.controllers.Controller\n   *\n   * @param {Object} object The object to be manipulated\n   * @param {string} property The name of the property to be manipulated\n   *\n   * @member dat.controllers\n   */\n  var FunctionController = function(object, property, text) {\n\n    FunctionController.superclass.call(this, object, property);\n\n    var _this = this;\n\n    this.__button = document.createElement('div');\n    this.__button.innerHTML = text === undefined ? 'Fire' : text;\n    dom.bind(this.__button, 'click', function(e) {\n      e.preventDefault();\n      _this.fire();\n      return false;\n    });\n\n    dom.addClass(this.__button, 'button');\n\n    this.domElement.appendChild(this.__button);\n\n\n  };\n\n  FunctionController.superclass = Controller;\n\n  common.extend(\n\n      FunctionController.prototype,\n      Controller.prototype,\n      {\n        \n        fire: function() {\n          if (this.__onChange) {\n            this.__onChange.call(this);\n          }\n          if (this.__onFinishChange) {\n            this.__onFinishChange.call(this, this.getValue());\n          }\n          this.getValue().call(this.object);\n        }\n      }\n\n  );\n\n  return FunctionController;\n\n})(dat.controllers.Controller,\ndat.dom.dom,\ndat.utils.common);\n\n\ndat.controllers.BooleanController = (function (Controller, dom, common) {\n\n  /**\n   * @class Provides a checkbox input to alter the boolean property of an object.\n   * @extends dat.controllers.Controller\n   *\n   * @param {Object} object The object to be manipulated\n   * @param {string} property The name of the property to be manipulated\n   *\n   * @member dat.controllers\n   */\n  var BooleanController = function(object, property) {\n\n    BooleanController.superclass.call(this, object, property);\n\n    var _this = this;\n    this.__prev = this.getValue();\n\n    this.__checkbox = document.createElement('input');\n    this.__checkbox.setAttribute('type', 'checkbox');\n\n\n    dom.bind(this.__checkbox, 'change', onChange, false);\n\n    this.domElement.appendChild(this.__checkbox);\n\n    // Match original value\n    this.updateDisplay();\n\n    function onChange() {\n      _this.setValue(!_this.__prev);\n    }\n\n  };\n\n  BooleanController.superclass = Controller;\n\n  common.extend(\n\n      BooleanController.prototype,\n      Controller.prototype,\n\n      {\n\n        setValue: function(v) {\n          var toReturn = BooleanController.superclass.prototype.setValue.call(this, v);\n          if (this.__onFinishChange) {\n            this.__onFinishChange.call(this, this.getValue());\n          }\n          this.__prev = this.getValue();\n          return toReturn;\n        },\n\n        updateDisplay: function() {\n          \n          if (this.getValue() === true) {\n            this.__checkbox.setAttribute('checked', 'checked');\n            this.__checkbox.checked = true;    \n          } else {\n              this.__checkbox.checked = false;\n          }\n\n          return BooleanController.superclass.prototype.updateDisplay.call(this);\n\n        }\n\n\n      }\n\n  );\n\n  return BooleanController;\n\n})(dat.controllers.Controller,\ndat.dom.dom,\ndat.utils.common);\n\n\ndat.color.toString = (function (common) {\n\n  return function(color) {\n\n    if (color.a == 1 || common.isUndefined(color.a)) {\n\n      var s = color.hex.toString(16);\n      while (s.length < 6) {\n        s = '0' + s;\n      }\n\n      return '#' + s;\n\n    } else {\n\n      return 'rgba(' + Math.round(color.r) + ',' + Math.round(color.g) + ',' + Math.round(color.b) + ',' + color.a + ')';\n\n    }\n\n  }\n\n})(dat.utils.common);\n\n\ndat.color.interpret = (function (toString, common) {\n\n  var result, toReturn;\n\n  var interpret = function() {\n\n    toReturn = false;\n\n    var original = arguments.length > 1 ? common.toArray(arguments) : arguments[0];\n\n    common.each(INTERPRETATIONS, function(family) {\n\n      if (family.litmus(original)) {\n\n        common.each(family.conversions, function(conversion, conversionName) {\n\n          result = conversion.read(original);\n\n          if (toReturn === false && result !== false) {\n            toReturn = result;\n            result.conversionName = conversionName;\n            result.conversion = conversion;\n            return common.BREAK;\n\n          }\n\n        });\n\n        return common.BREAK;\n\n      }\n\n    });\n\n    return toReturn;\n\n  };\n\n  var INTERPRETATIONS = [\n\n    // Strings\n    {\n\n      litmus: common.isString,\n\n      conversions: {\n\n        THREE_CHAR_HEX: {\n\n          read: function(original) {\n\n            var test = original.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);\n            if (test === null) return false;\n\n            return {\n              space: 'HEX',\n              hex: parseInt(\n                  '0x' +\n                      test[1].toString() + test[1].toString() +\n                      test[2].toString() + test[2].toString() +\n                      test[3].toString() + test[3].toString())\n            };\n\n          },\n\n          write: toString\n\n        },\n\n        SIX_CHAR_HEX: {\n\n          read: function(original) {\n\n            var test = original.match(/^#([A-F0-9]{6})$/i);\n            if (test === null) return false;\n\n            return {\n              space: 'HEX',\n              hex: parseInt('0x' + test[1].toString())\n            };\n\n          },\n\n          write: toString\n\n        },\n\n        CSS_RGB: {\n\n          read: function(original) {\n\n            var test = original.match(/^rgb\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\)/);\n            if (test === null) return false;\n\n            return {\n              space: 'RGB',\n              r: parseFloat(test[1]),\n              g: parseFloat(test[2]),\n              b: parseFloat(test[3])\n            };\n\n          },\n\n          write: toString\n\n        },\n\n        CSS_RGBA: {\n\n          read: function(original) {\n\n            var test = original.match(/^rgba\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\,\\s*(.+)\\s*\\)/);\n            if (test === null) return false;\n\n            return {\n              space: 'RGB',\n              r: parseFloat(test[1]),\n              g: parseFloat(test[2]),\n              b: parseFloat(test[3]),\n              a: parseFloat(test[4])\n            };\n\n          },\n\n          write: toString\n\n        }\n\n      }\n\n    },\n\n    // Numbers\n    {\n\n      litmus: common.isNumber,\n\n      conversions: {\n\n        HEX: {\n          read: function(original) {\n            return {\n              space: 'HEX',\n              hex: original,\n              conversionName: 'HEX'\n            }\n          },\n\n          write: function(color) {\n            return color.hex;\n          }\n        }\n\n      }\n\n    },\n\n    // Arrays\n    {\n\n      litmus: common.isArray,\n\n      conversions: {\n\n        RGB_ARRAY: {\n          read: function(original) {\n            if (original.length != 3) return false;\n            return {\n              space: 'RGB',\n              r: original[0],\n              g: original[1],\n              b: original[2]\n            };\n          },\n\n          write: function(color) {\n            return [color.r, color.g, color.b];\n          }\n\n        },\n\n        RGBA_ARRAY: {\n          read: function(original) {\n            if (original.length != 4) return false;\n            return {\n              space: 'RGB',\n              r: original[0],\n              g: original[1],\n              b: original[2],\n              a: original[3]\n            };\n          },\n\n          write: function(color) {\n            return [color.r, color.g, color.b, color.a];\n          }\n\n        }\n\n      }\n\n    },\n\n    // Objects\n    {\n\n      litmus: common.isObject,\n\n      conversions: {\n\n        RGBA_OBJ: {\n          read: function(original) {\n            if (common.isNumber(original.r) &&\n                common.isNumber(original.g) &&\n                common.isNumber(original.b) &&\n                common.isNumber(original.a)) {\n              return {\n                space: 'RGB',\n                r: original.r,\n                g: original.g,\n                b: original.b,\n                a: original.a\n              }\n            }\n            return false;\n          },\n\n          write: function(color) {\n            return {\n              r: color.r,\n              g: color.g,\n              b: color.b,\n              a: color.a\n            }\n          }\n        },\n\n        RGB_OBJ: {\n          read: function(original) {\n            if (common.isNumber(original.r) &&\n                common.isNumber(original.g) &&\n                common.isNumber(original.b)) {\n              return {\n                space: 'RGB',\n                r: original.r,\n                g: original.g,\n                b: original.b\n              }\n            }\n            return false;\n          },\n\n          write: function(color) {\n            return {\n              r: color.r,\n              g: color.g,\n              b: color.b\n            }\n          }\n        },\n\n        HSVA_OBJ: {\n          read: function(original) {\n            if (common.isNumber(original.h) &&\n                common.isNumber(original.s) &&\n                common.isNumber(original.v) &&\n                common.isNumber(original.a)) {\n              return {\n                space: 'HSV',\n                h: original.h,\n                s: original.s,\n                v: original.v,\n                a: original.a\n              }\n            }\n            return false;\n          },\n\n          write: function(color) {\n            return {\n              h: color.h,\n              s: color.s,\n              v: color.v,\n              a: color.a\n            }\n          }\n        },\n\n        HSV_OBJ: {\n          read: function(original) {\n            if (common.isNumber(original.h) &&\n                common.isNumber(original.s) &&\n                common.isNumber(original.v)) {\n              return {\n                space: 'HSV',\n                h: original.h,\n                s: original.s,\n                v: original.v\n              }\n            }\n            return false;\n          },\n\n          write: function(color) {\n            return {\n              h: color.h,\n              s: color.s,\n              v: color.v\n            }\n          }\n\n        }\n\n      }\n\n    }\n\n\n  ];\n\n  return interpret;\n\n\n})(dat.color.toString,\ndat.utils.common);\n\n\ndat.GUI = dat.gui.GUI = (function (css, saveDialogueContents, styleSheet, controllerFactory, Controller, BooleanController, FunctionController, NumberControllerBox, NumberControllerSlider, OptionController, ColorController, requestAnimationFrame, CenteredDiv, dom, common) {\n\n  css.inject(styleSheet);\n\n  /** Outer-most className for GUI's */\n  var CSS_NAMESPACE = 'dg';\n\n  var HIDE_KEY_CODE = 72;\n\n  /** The only value shared between the JS and SCSS. Use caution. */\n  var CLOSE_BUTTON_HEIGHT = 20;\n\n  var DEFAULT_DEFAULT_PRESET_NAME = 'Default';\n\n  var SUPPORTS_LOCAL_STORAGE = (function() {\n    try {\n      return 'localStorage' in window && window['localStorage'] !== null;\n    } catch (e) {\n      return false;\n    }\n  })();\n\n  var SAVE_DIALOGUE;\n\n  /** Have we yet to create an autoPlace GUI? */\n  var auto_place_virgin = true;\n\n  /** Fixed position div that auto place GUI's go inside */\n  var auto_place_container;\n\n  /** Are we hiding the GUI's ? */\n  var hide = false;\n\n  /** GUI's which should be hidden */\n  var hideable_guis = [];\n\n  /**\n   * A lightweight controller library for JavaScript. It allows you to easily\n   * manipulate variables and fire functions on the fly.\n   * @class\n   *\n   * @member dat.gui\n   *\n   * @param {Object} [params]\n   * @param {String} [params.name] The name of this GUI.\n   * @param {Object} [params.load] JSON object representing the saved state of\n   * this GUI.\n   * @param {Boolean} [params.auto=true]\n   * @param {dat.gui.GUI} [params.parent] The GUI I'm nested in.\n   * @param {Boolean} [params.closed] If true, starts closed\n   */\n  var GUI = function(params) {\n\n    var _this = this;\n\n    /**\n     * Outermost DOM Element\n     * @type DOMElement\n     */\n    this.domElement = document.createElement('div');\n    this.__ul = document.createElement('ul');\n    this.domElement.appendChild(this.__ul);\n\n    dom.addClass(this.domElement, CSS_NAMESPACE);\n\n    /**\n     * Nested GUI's by name\n     * @ignore\n     */\n    this.__folders = {};\n\n    this.__controllers = [];\n\n    /**\n     * List of objects I'm remembering for save, only used in top level GUI\n     * @ignore\n     */\n    this.__rememberedObjects = [];\n\n    /**\n     * Maps the index of remembered objects to a map of controllers, only used\n     * in top level GUI.\n     *\n     * @private\n     * @ignore\n     *\n     * @example\n     * [\n     *  {\n     *    propertyName: Controller,\n     *    anotherPropertyName: Controller\n     *  },\n     *  {\n     *    propertyName: Controller\n     *  }\n     * ]\n     */\n    this.__rememberedObjectIndecesToControllers = [];\n\n    this.__listening = [];\n\n    params = params || {};\n\n    // Default parameters\n    params = common.defaults(params, {\n      autoPlace: true,\n      width: GUI.DEFAULT_WIDTH\n    });\n\n    params = common.defaults(params, {\n      resizable: params.autoPlace,\n      hideable: params.autoPlace\n    });\n\n\n    if (!common.isUndefined(params.load)) {\n\n      // Explicit preset\n      if (params.preset) params.load.preset = params.preset;\n\n    } else {\n\n      params.load = { preset: DEFAULT_DEFAULT_PRESET_NAME };\n\n    }\n\n    if (common.isUndefined(params.parent) && params.hideable) {\n      hideable_guis.push(this);\n    }\n\n    // Only root level GUI's are resizable.\n    params.resizable = common.isUndefined(params.parent) && params.resizable;\n\n\n    if (params.autoPlace && common.isUndefined(params.scrollable)) {\n      params.scrollable = true;\n    }\n//    params.scrollable = common.isUndefined(params.parent) && params.scrollable === true;\n\n    // Not part of params because I don't want people passing this in via\n    // constructor. Should be a 'remembered' value.\n    var use_local_storage =\n        SUPPORTS_LOCAL_STORAGE &&\n            localStorage.getItem(getLocalStorageHash(this, 'isLocal')) === 'true';\n\n    Object.defineProperties(this,\n\n        /** @lends dat.gui.GUI.prototype */\n        {\n\n          /**\n           * The parent <code>GUI</code>\n           * @type dat.gui.GUI\n           */\n          parent: {\n            get: function() {\n              return params.parent;\n            }\n          },\n\n          scrollable: {\n            get: function() {\n              return params.scrollable;\n            }\n          },\n\n          /**\n           * Handles <code>GUI</code>'s element placement for you\n           * @type Boolean\n           */\n          autoPlace: {\n            get: function() {\n              return params.autoPlace;\n            }\n          },\n\n          /**\n           * The identifier for a set of saved values\n           * @type String\n           */\n          preset: {\n\n            get: function() {\n              if (_this.parent) {\n                return _this.getRoot().preset;\n              } else {\n                return params.load.preset;\n              }\n            },\n\n            set: function(v) {\n              if (_this.parent) {\n                _this.getRoot().preset = v;\n              } else {\n                params.load.preset = v;\n              }\n              setPresetSelectIndex(this);\n              _this.revert();\n            }\n\n          },\n\n          /**\n           * The width of <code>GUI</code> element\n           * @type Number\n           */\n          width: {\n            get: function() {\n              return params.width;\n            },\n            set: function(v) {\n              params.width = v;\n              setWidth(_this, v);\n            }\n          },\n\n          /**\n           * The name of <code>GUI</code>. Used for folders. i.e\n           * a folder's name\n           * @type String\n           */\n          name: {\n            get: function() {\n              return params.name;\n            },\n            set: function(v) {\n              // TODO Check for collisions among sibling folders\n              params.name = v;\n              if (title_row_name) {\n                title_row_name.innerHTML = params.name;\n              }\n            }\n          },\n\n          /**\n           * Whether the <code>GUI</code> is collapsed or not\n           * @type Boolean\n           */\n          closed: {\n            get: function() {\n              return params.closed;\n            },\n            set: function(v) {\n              params.closed = v;\n              if (params.closed) {\n                dom.addClass(_this.__ul, GUI.CLASS_CLOSED);\n              } else {\n                dom.removeClass(_this.__ul, GUI.CLASS_CLOSED);\n              }\n              // For browsers that aren't going to respect the CSS transition,\n              // Lets just check our height against the window height right off\n              // the bat.\n              this.onResize();\n\n              if (_this.__closeButton) {\n                _this.__closeButton.innerHTML = v ? GUI.TEXT_OPEN : GUI.TEXT_CLOSED;\n              }\n            }\n          },\n\n          /**\n           * Contains all presets\n           * @type Object\n           */\n          load: {\n            get: function() {\n              return params.load;\n            }\n          },\n\n          /**\n           * Determines whether or not to use <a href=\"https://developer.mozilla.org/en/DOM/Storage#localStorage\">localStorage</a> as the means for\n           * <code>remember</code>ing\n           * @type Boolean\n           */\n          useLocalStorage: {\n\n            get: function() {\n              return use_local_storage;\n            },\n            set: function(bool) {\n              if (SUPPORTS_LOCAL_STORAGE) {\n                use_local_storage = bool;\n                if (bool) {\n                  dom.bind(window, 'unload', saveToLocalStorage);\n                } else {\n                  dom.unbind(window, 'unload', saveToLocalStorage);\n                }\n                localStorage.setItem(getLocalStorageHash(_this, 'isLocal'), bool);\n              }\n            }\n\n          }\n\n        });\n\n    // Are we a root level GUI?\n    if (common.isUndefined(params.parent)) {\n\n      params.closed = false;\n\n      dom.addClass(this.domElement, GUI.CLASS_MAIN);\n      dom.makeSelectable(this.domElement, false);\n\n      // Are we supposed to be loading locally?\n      if (SUPPORTS_LOCAL_STORAGE) {\n\n        if (use_local_storage) {\n\n          _this.useLocalStorage = true;\n\n          var saved_gui = localStorage.getItem(getLocalStorageHash(this, 'gui'));\n\n          if (saved_gui) {\n            params.load = JSON.parse(saved_gui);\n          }\n\n        }\n\n      }\n\n      this.__closeButton = document.createElement('div');\n      this.__closeButton.innerHTML = GUI.TEXT_CLOSED;\n      dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_BUTTON);\n      this.domElement.appendChild(this.__closeButton);\n\n      dom.bind(this.__closeButton, 'click', function() {\n\n        _this.closed = !_this.closed;\n\n\n      });\n\n\n      // Oh, you're a nested GUI!\n    } else {\n\n      if (params.closed === undefined) {\n        params.closed = true;\n      }\n\n      var title_row_name = document.createTextNode(params.name);\n      dom.addClass(title_row_name, 'controller-name');\n\n      var title_row = addRow(_this, title_row_name);\n\n      var on_click_title = function(e) {\n        e.preventDefault();\n        _this.closed = !_this.closed;\n        return false;\n      };\n\n      dom.addClass(this.__ul, GUI.CLASS_CLOSED);\n\n      dom.addClass(title_row, 'title');\n      dom.bind(title_row, 'click', on_click_title);\n\n      if (!params.closed) {\n        this.closed = false;\n      }\n\n    }\n\n    if (params.autoPlace) {\n\n      if (common.isUndefined(params.parent)) {\n\n        if (auto_place_virgin) {\n          auto_place_container = document.createElement('div');\n          dom.addClass(auto_place_container, CSS_NAMESPACE);\n          dom.addClass(auto_place_container, GUI.CLASS_AUTO_PLACE_CONTAINER);\n          document.body.appendChild(auto_place_container);\n          auto_place_virgin = false;\n        }\n\n        // Put it in the dom for you.\n        auto_place_container.appendChild(this.domElement);\n\n        // Apply the auto styles\n        dom.addClass(this.domElement, GUI.CLASS_AUTO_PLACE);\n\n      }\n\n\n      // Make it not elastic.\n      if (!this.parent) setWidth(_this, params.width);\n\n    }\n\n    dom.bind(window, 'resize', function() { _this.onResize() });\n    dom.bind(this.__ul, 'webkitTransitionEnd', function() { _this.onResize(); });\n    dom.bind(this.__ul, 'transitionend', function() { _this.onResize() });\n    dom.bind(this.__ul, 'oTransitionEnd', function() { _this.onResize() });\n    this.onResize();\n\n\n    if (params.resizable) {\n      addResizeHandle(this);\n    }\n\n    function saveToLocalStorage() {\n      localStorage.setItem(getLocalStorageHash(_this, 'gui'), JSON.stringify(_this.getSaveObject()));\n    }\n\n    var root = _this.getRoot();\n    function resetWidth() {\n        var root = _this.getRoot();\n        root.width += 1;\n        common.defer(function() {\n          root.width -= 1;\n        });\n      }\n\n      if (!params.parent) {\n        resetWidth();\n      }\n\n  };\n\n  GUI.toggleHide = function() {\n\n    hide = !hide;\n    common.each(hideable_guis, function(gui) {\n      gui.domElement.style.zIndex = hide ? -999 : 999;\n      gui.domElement.style.opacity = hide ? 0 : 1;\n    });\n  };\n\n  GUI.CLASS_AUTO_PLACE = 'a';\n  GUI.CLASS_AUTO_PLACE_CONTAINER = 'ac';\n  GUI.CLASS_MAIN = 'main';\n  GUI.CLASS_CONTROLLER_ROW = 'cr';\n  GUI.CLASS_TOO_TALL = 'taller-than-window';\n  GUI.CLASS_CLOSED = 'closed';\n  GUI.CLASS_CLOSE_BUTTON = 'close-button';\n  GUI.CLASS_DRAG = 'drag';\n\n  GUI.DEFAULT_WIDTH = 245;\n  GUI.TEXT_CLOSED = 'Close Controls';\n  GUI.TEXT_OPEN = 'Open Controls';\n\n  dom.bind(window, 'keydown', function(e) {\n\n    if (document.activeElement.type !== 'text' &&\n        (e.which === HIDE_KEY_CODE || e.keyCode == HIDE_KEY_CODE)) {\n      GUI.toggleHide();\n    }\n\n  }, false);\n\n  common.extend(\n\n      GUI.prototype,\n\n      /** @lends dat.gui.GUI */\n      {\n\n        /**\n         * @param object\n         * @param property\n         * @returns {dat.controllers.Controller} The new controller that was added.\n         * @instance\n         */\n        add: function(object, property) {\n\n          return add(\n              this,\n              object,\n              property,\n              {\n                factoryArgs: Array.prototype.slice.call(arguments, 2)\n              }\n          );\n\n        },\n\n        /**\n         * @param object\n         * @param property\n         * @returns {dat.controllers.ColorController} The new controller that was added.\n         * @instance\n         */\n        addColor: function(object, property) {\n\n          return add(\n              this,\n              object,\n              property,\n              {\n                color: true\n              }\n          );\n\n        },\n\n        /**\n         * @param controller\n         * @instance\n         */\n        remove: function(controller) {\n\n          // TODO listening?\n          this.__ul.removeChild(controller.__li);\n          this.__controllers.slice(this.__controllers.indexOf(controller), 1);\n          var _this = this;\n          common.defer(function() {\n            _this.onResize();\n          });\n\n        },\n\n        destroy: function() {\n\n          if (this.autoPlace) {\n            auto_place_container.removeChild(this.domElement);\n          }\n\n        },\n\n        /**\n         * @param name\n         * @returns {dat.gui.GUI} The new folder.\n         * @throws {Error} if this GUI already has a folder by the specified\n         * name\n         * @instance\n         */\n        addFolder: function(name) {\n\n          // We have to prevent collisions on names in order to have a key\n          // by which to remember saved values\n          if (this.__folders[name] !== undefined) {\n            throw new Error('You already have a folder in this GUI by the' +\n                ' name \"' + name + '\"');\n          }\n\n          var new_gui_params = { name: name, parent: this };\n\n          // We need to pass down the autoPlace trait so that we can\n          // attach event listeners to open/close folder actions to\n          // ensure that a scrollbar appears if the window is too short.\n          new_gui_params.autoPlace = this.autoPlace;\n\n          // Do we have saved appearance data for this folder?\n\n          if (this.load && // Anything loaded?\n              this.load.folders && // Was my parent a dead-end?\n              this.load.folders[name]) { // Did daddy remember me?\n\n            // Start me closed if I was closed\n            new_gui_params.closed = this.load.folders[name].closed;\n\n            // Pass down the loaded data\n            new_gui_params.load = this.load.folders[name];\n\n          }\n\n          var gui = new GUI(new_gui_params);\n          this.__folders[name] = gui;\n\n          var li = addRow(this, gui.domElement);\n          dom.addClass(li, 'folder');\n          return gui;\n\n        },\n\n        open: function() {\n          this.closed = false;\n        },\n\n        close: function() {\n          this.closed = true;\n        },\n\n        onResize: function() {\n\n          var root = this.getRoot();\n\n          if (root.scrollable) {\n\n            var top = dom.getOffset(root.__ul).top;\n            var h = 0;\n\n            common.each(root.__ul.childNodes, function(node) {\n              if (! (root.autoPlace && node === root.__save_row))\n                h += dom.getHeight(node);\n            });\n\n            if (window.innerHeight - top - CLOSE_BUTTON_HEIGHT < h) {\n              dom.addClass(root.domElement, GUI.CLASS_TOO_TALL);\n              root.__ul.style.height = window.innerHeight - top - CLOSE_BUTTON_HEIGHT + 'px';\n            } else {\n              dom.removeClass(root.domElement, GUI.CLASS_TOO_TALL);\n              root.__ul.style.height = 'auto';\n            }\n\n          }\n\n          if (root.__resize_handle) {\n            common.defer(function() {\n              root.__resize_handle.style.height = root.__ul.offsetHeight + 'px';\n            });\n          }\n\n          if (root.__closeButton) {\n            root.__closeButton.style.width = root.width + 'px';\n          }\n\n        },\n\n        /**\n         * Mark objects for saving. The order of these objects cannot change as\n         * the GUI grows. When remembering new objects, append them to the end\n         * of the list.\n         *\n         * @param {Object...} objects\n         * @throws {Error} if not called on a top level GUI.\n         * @instance\n         */\n        remember: function() {\n\n          if (common.isUndefined(SAVE_DIALOGUE)) {\n            SAVE_DIALOGUE = new CenteredDiv();\n            SAVE_DIALOGUE.domElement.innerHTML = saveDialogueContents;\n          }\n\n          if (this.parent) {\n            throw new Error(\"You can only call remember on a top level GUI.\");\n          }\n\n          var _this = this;\n\n          common.each(Array.prototype.slice.call(arguments), function(object) {\n            if (_this.__rememberedObjects.length == 0) {\n              addSaveMenu(_this);\n            }\n            if (_this.__rememberedObjects.indexOf(object) == -1) {\n              _this.__rememberedObjects.push(object);\n            }\n          });\n\n          if (this.autoPlace) {\n            // Set save row width\n            setWidth(this, this.width);\n          }\n\n        },\n\n        /**\n         * @returns {dat.gui.GUI} the topmost parent GUI of a nested GUI.\n         * @instance\n         */\n        getRoot: function() {\n          var gui = this;\n          while (gui.parent) {\n            gui = gui.parent;\n          }\n          return gui;\n        },\n\n        /**\n         * @returns {Object} a JSON object representing the current state of\n         * this GUI as well as its remembered properties.\n         * @instance\n         */\n        getSaveObject: function() {\n\n          var toReturn = this.load;\n\n          toReturn.closed = this.closed;\n\n          // Am I remembering any values?\n          if (this.__rememberedObjects.length > 0) {\n\n            toReturn.preset = this.preset;\n\n            if (!toReturn.remembered) {\n              toReturn.remembered = {};\n            }\n\n            toReturn.remembered[this.preset] = getCurrentPreset(this);\n\n          }\n\n          toReturn.folders = {};\n          common.each(this.__folders, function(element, key) {\n            toReturn.folders[key] = element.getSaveObject();\n          });\n\n          return toReturn;\n\n        },\n\n        save: function() {\n\n          if (!this.load.remembered) {\n            this.load.remembered = {};\n          }\n\n          this.load.remembered[this.preset] = getCurrentPreset(this);\n          markPresetModified(this, false);\n\n        },\n\n        saveAs: function(presetName) {\n\n          if (!this.load.remembered) {\n\n            // Retain default values upon first save\n            this.load.remembered = {};\n            this.load.remembered[DEFAULT_DEFAULT_PRESET_NAME] = getCurrentPreset(this, true);\n\n          }\n\n          this.load.remembered[presetName] = getCurrentPreset(this);\n          this.preset = presetName;\n          addPresetOption(this, presetName, true);\n\n        },\n\n        revert: function(gui) {\n\n          common.each(this.__controllers, function(controller) {\n            // Make revert work on Default.\n            if (!this.getRoot().load.remembered) {\n              controller.setValue(controller.initialValue);\n            } else {\n              recallSavedValue(gui || this.getRoot(), controller);\n            }\n          }, this);\n\n          common.each(this.__folders, function(folder) {\n            folder.revert(folder);\n          });\n\n          if (!gui) {\n            markPresetModified(this.getRoot(), false);\n          }\n\n\n        },\n\n        listen: function(controller) {\n\n          var init = this.__listening.length == 0;\n          this.__listening.push(controller);\n          if (init) updateDisplays(this.__listening);\n\n        }\n\n      }\n\n  );\n\n  function add(gui, object, property, params) {\n\n    if (object[property] === undefined) {\n      throw new Error(\"Object \" + object + \" has no property \\\"\" + property + \"\\\"\");\n    }\n\n    var controller;\n\n    if (params.color) {\n\n      controller = new ColorController(object, property);\n\n    } else {\n\n      var factoryArgs = [object,property].concat(params.factoryArgs);\n      controller = controllerFactory.apply(gui, factoryArgs);\n\n    }\n\n    if (params.before instanceof Controller) {\n      params.before = params.before.__li;\n    }\n\n    recallSavedValue(gui, controller);\n\n    dom.addClass(controller.domElement, 'c');\n\n    var name = document.createElement('span');\n    dom.addClass(name, 'property-name');\n    name.innerHTML = controller.property;\n\n    var container = document.createElement('div');\n    container.appendChild(name);\n    container.appendChild(controller.domElement);\n\n    var li = addRow(gui, container, params.before);\n\n    dom.addClass(li, GUI.CLASS_CONTROLLER_ROW);\n    dom.addClass(li, typeof controller.getValue());\n\n    augmentController(gui, li, controller);\n\n    gui.__controllers.push(controller);\n\n    return controller;\n\n  }\n\n  /**\n   * Add a row to the end of the GUI or before another row.\n   *\n   * @param gui\n   * @param [dom] If specified, inserts the dom content in the new row\n   * @param [liBefore] If specified, places the new row before another row\n   */\n  function addRow(gui, dom, liBefore) {\n    var li = document.createElement('li');\n    if (dom) li.appendChild(dom);\n    if (liBefore) {\n      gui.__ul.insertBefore(li, params.before);\n    } else {\n      gui.__ul.appendChild(li);\n    }\n    gui.onResize();\n    return li;\n  }\n\n  function augmentController(gui, li, controller) {\n\n    controller.__li = li;\n    controller.__gui = gui;\n\n    common.extend(controller, {\n\n      options: function(options) {\n\n        if (arguments.length > 1) {\n          controller.remove();\n\n          return add(\n              gui,\n              controller.object,\n              controller.property,\n              {\n                before: controller.__li.nextElementSibling,\n                factoryArgs: [common.toArray(arguments)]\n              }\n          );\n\n        }\n\n        if (common.isArray(options) || common.isObject(options)) {\n          controller.remove();\n\n          return add(\n              gui,\n              controller.object,\n              controller.property,\n              {\n                before: controller.__li.nextElementSibling,\n                factoryArgs: [options]\n              }\n          );\n\n        }\n\n      },\n\n      name: function(v) {\n        controller.__li.firstElementChild.firstElementChild.innerHTML = v;\n        return controller;\n      },\n\n      listen: function() {\n        controller.__gui.listen(controller);\n        return controller;\n      },\n\n      remove: function() {\n        controller.__gui.remove(controller);\n        return controller;\n      }\n\n    });\n\n    // All sliders should be accompanied by a box.\n    if (controller instanceof NumberControllerSlider) {\n\n      var box = new NumberControllerBox(controller.object, controller.property,\n          { min: controller.__min, max: controller.__max, step: controller.__step });\n\n      common.each(['updateDisplay', 'onChange', 'onFinishChange'], function(method) {\n        var pc = controller[method];\n        var pb = box[method];\n        controller[method] = box[method] = function() {\n          var args = Array.prototype.slice.call(arguments);\n          pc.apply(controller, args);\n          return pb.apply(box, args);\n        }\n      });\n\n      dom.addClass(li, 'has-slider');\n      controller.domElement.insertBefore(box.domElement, controller.domElement.firstElementChild);\n\n    }\n    else if (controller instanceof NumberControllerBox) {\n\n      var r = function(returned) {\n\n        // Have we defined both boundaries?\n        if (common.isNumber(controller.__min) && common.isNumber(controller.__max)) {\n\n          // Well, then lets just replace this with a slider.\n          controller.remove();\n          return add(\n              gui,\n              controller.object,\n              controller.property,\n              {\n                before: controller.__li.nextElementSibling,\n                factoryArgs: [controller.__min, controller.__max, controller.__step]\n              });\n\n        }\n\n        return returned;\n\n      };\n\n      controller.min = common.compose(r, controller.min);\n      controller.max = common.compose(r, controller.max);\n\n    }\n    else if (controller instanceof BooleanController) {\n\n      dom.bind(li, 'click', function() {\n        dom.fakeEvent(controller.__checkbox, 'click');\n      });\n\n      dom.bind(controller.__checkbox, 'click', function(e) {\n        e.stopPropagation(); // Prevents double-toggle\n      })\n\n    }\n    else if (controller instanceof FunctionController) {\n\n      dom.bind(li, 'click', function() {\n        dom.fakeEvent(controller.__button, 'click');\n      });\n\n      dom.bind(li, 'mouseover', function() {\n        dom.addClass(controller.__button, 'hover');\n      });\n\n      dom.bind(li, 'mouseout', function() {\n        dom.removeClass(controller.__button, 'hover');\n      });\n\n    }\n    else if (controller instanceof ColorController) {\n\n      dom.addClass(li, 'color');\n      controller.updateDisplay = common.compose(function(r) {\n        li.style.borderLeftColor = controller.__color.toString();\n        return r;\n      }, controller.updateDisplay);\n\n      controller.updateDisplay();\n\n    }\n\n    controller.setValue = common.compose(function(r) {\n      if (gui.getRoot().__preset_select && controller.isModified()) {\n        markPresetModified(gui.getRoot(), true);\n      }\n      return r;\n    }, controller.setValue);\n\n  }\n\n  function recallSavedValue(gui, controller) {\n\n    // Find the topmost GUI, that's where remembered objects live.\n    var root = gui.getRoot();\n\n    // Does the object we're controlling match anything we've been told to\n    // remember?\n    var matched_index = root.__rememberedObjects.indexOf(controller.object);\n\n    // Why yes, it does!\n    if (matched_index != -1) {\n\n      // Let me fetch a map of controllers for thcommon.isObject.\n      var controller_map =\n          root.__rememberedObjectIndecesToControllers[matched_index];\n\n      // Ohp, I believe this is the first controller we've created for this\n      // object. Lets make the map fresh.\n      if (controller_map === undefined) {\n        controller_map = {};\n        root.__rememberedObjectIndecesToControllers[matched_index] =\n            controller_map;\n      }\n\n      // Keep track of this controller\n      controller_map[controller.property] = controller;\n\n      // Okay, now have we saved any values for this controller?\n      if (root.load && root.load.remembered) {\n\n        var preset_map = root.load.remembered;\n\n        // Which preset are we trying to load?\n        var preset;\n\n        if (preset_map[gui.preset]) {\n\n          preset = preset_map[gui.preset];\n\n        } else if (preset_map[DEFAULT_DEFAULT_PRESET_NAME]) {\n\n          // Uhh, you can have the default instead?\n          preset = preset_map[DEFAULT_DEFAULT_PRESET_NAME];\n\n        } else {\n\n          // Nada.\n\n          return;\n\n        }\n\n\n        // Did the loaded object remember thcommon.isObject?\n        if (preset[matched_index] &&\n\n          // Did we remember this particular property?\n            preset[matched_index][controller.property] !== undefined) {\n\n          // We did remember something for this guy ...\n          var value = preset[matched_index][controller.property];\n\n          // And that's what it is.\n          controller.initialValue = value;\n          controller.setValue(value);\n\n        }\n\n      }\n\n    }\n\n  }\n\n  function getLocalStorageHash(gui, key) {\n    // TODO how does this deal with multiple GUI's?\n    return document.location.href + '.' + key;\n\n  }\n\n  function addSaveMenu(gui) {\n\n    var div = gui.__save_row = document.createElement('li');\n\n    dom.addClass(gui.domElement, 'has-save');\n\n    gui.__ul.insertBefore(div, gui.__ul.firstChild);\n\n    dom.addClass(div, 'save-row');\n\n    var gears = document.createElement('span');\n    gears.innerHTML = '&nbsp;';\n    dom.addClass(gears, 'button gears');\n\n    // TODO replace with FunctionController\n    var button = document.createElement('span');\n    button.innerHTML = 'Save';\n    dom.addClass(button, 'button');\n    dom.addClass(button, 'save');\n\n    var button2 = document.createElement('span');\n    button2.innerHTML = 'New';\n    dom.addClass(button2, 'button');\n    dom.addClass(button2, 'save-as');\n\n    var button3 = document.createElement('span');\n    button3.innerHTML = 'Revert';\n    dom.addClass(button3, 'button');\n    dom.addClass(button3, 'revert');\n\n    var select = gui.__preset_select = document.createElement('select');\n\n    if (gui.load && gui.load.remembered) {\n\n      common.each(gui.load.remembered, function(value, key) {\n        addPresetOption(gui, key, key == gui.preset);\n      });\n\n    } else {\n      addPresetOption(gui, DEFAULT_DEFAULT_PRESET_NAME, false);\n    }\n\n    dom.bind(select, 'change', function() {\n\n\n      for (var index = 0; index < gui.__preset_select.length; index++) {\n        gui.__preset_select[index].innerHTML = gui.__preset_select[index].value;\n      }\n\n      gui.preset = this.value;\n\n    });\n\n    div.appendChild(select);\n    div.appendChild(gears);\n    div.appendChild(button);\n    div.appendChild(button2);\n    div.appendChild(button3);\n\n    if (SUPPORTS_LOCAL_STORAGE) {\n\n      var saveLocally = document.getElementById('dg-save-locally');\n      var explain = document.getElementById('dg-local-explain');\n\n      saveLocally.style.display = 'block';\n\n      var localStorageCheckBox = document.getElementById('dg-local-storage');\n\n      if (localStorage.getItem(getLocalStorageHash(gui, 'isLocal')) === 'true') {\n        localStorageCheckBox.setAttribute('checked', 'checked');\n      }\n\n      function showHideExplain() {\n        explain.style.display = gui.useLocalStorage ? 'block' : 'none';\n      }\n\n      showHideExplain();\n\n      // TODO: Use a boolean controller, fool!\n      dom.bind(localStorageCheckBox, 'change', function() {\n        gui.useLocalStorage = !gui.useLocalStorage;\n        showHideExplain();\n      });\n\n    }\n\n    var newConstructorTextArea = document.getElementById('dg-new-constructor');\n\n    dom.bind(newConstructorTextArea, 'keydown', function(e) {\n      if (e.metaKey && (e.which === 67 || e.keyCode == 67)) {\n        SAVE_DIALOGUE.hide();\n      }\n    });\n\n    dom.bind(gears, 'click', function() {\n      newConstructorTextArea.innerHTML = JSON.stringify(gui.getSaveObject(), undefined, 2);\n      SAVE_DIALOGUE.show();\n      newConstructorTextArea.focus();\n      newConstructorTextArea.select();\n    });\n\n    dom.bind(button, 'click', function() {\n      gui.save();\n    });\n\n    dom.bind(button2, 'click', function() {\n      var presetName = prompt('Enter a new preset name.');\n      if (presetName) gui.saveAs(presetName);\n    });\n\n    dom.bind(button3, 'click', function() {\n      gui.revert();\n    });\n\n//    div.appendChild(button2);\n\n  }\n\n  function addResizeHandle(gui) {\n\n    gui.__resize_handle = document.createElement('div');\n\n    common.extend(gui.__resize_handle.style, {\n\n      width: '6px',\n      marginLeft: '-3px',\n      height: '200px',\n      cursor: 'ew-resize',\n      position: 'absolute'\n//      border: '1px solid blue'\n\n    });\n\n    var pmouseX;\n\n    dom.bind(gui.__resize_handle, 'mousedown', dragStart);\n    dom.bind(gui.__closeButton, 'mousedown', dragStart);\n\n    gui.domElement.insertBefore(gui.__resize_handle, gui.domElement.firstElementChild);\n\n    function dragStart(e) {\n\n      e.preventDefault();\n\n      pmouseX = e.clientX;\n\n      dom.addClass(gui.__closeButton, GUI.CLASS_DRAG);\n      dom.bind(window, 'mousemove', drag);\n      dom.bind(window, 'mouseup', dragStop);\n\n      return false;\n\n    }\n\n    function drag(e) {\n\n      e.preventDefault();\n\n      gui.width += pmouseX - e.clientX;\n      gui.onResize();\n      pmouseX = e.clientX;\n\n      return false;\n\n    }\n\n    function dragStop() {\n\n      dom.removeClass(gui.__closeButton, GUI.CLASS_DRAG);\n      dom.unbind(window, 'mousemove', drag);\n      dom.unbind(window, 'mouseup', dragStop);\n\n    }\n\n  }\n\n  function setWidth(gui, w) {\n    gui.domElement.style.width = w + 'px';\n    // Auto placed save-rows are position fixed, so we have to\n    // set the width manually if we want it to bleed to the edge\n    if (gui.__save_row && gui.autoPlace) {\n      gui.__save_row.style.width = w + 'px';\n    }if (gui.__closeButton) {\n      gui.__closeButton.style.width = w + 'px';\n    }\n  }\n\n  function getCurrentPreset(gui, useInitialValues) {\n\n    var toReturn = {};\n\n    // For each object I'm remembering\n    common.each(gui.__rememberedObjects, function(val, index) {\n\n      var saved_values = {};\n\n      // The controllers I've made for thcommon.isObject by property\n      var controller_map =\n          gui.__rememberedObjectIndecesToControllers[index];\n\n      // Remember each value for each property\n      common.each(controller_map, function(controller, property) {\n        saved_values[property] = useInitialValues ? controller.initialValue : controller.getValue();\n      });\n\n      // Save the values for thcommon.isObject\n      toReturn[index] = saved_values;\n\n    });\n\n    return toReturn;\n\n  }\n\n  function addPresetOption(gui, name, setSelected) {\n    var opt = document.createElement('option');\n    opt.innerHTML = name;\n    opt.value = name;\n    gui.__preset_select.appendChild(opt);\n    if (setSelected) {\n      gui.__preset_select.selectedIndex = gui.__preset_select.length - 1;\n    }\n  }\n\n  function setPresetSelectIndex(gui) {\n    for (var index = 0; index < gui.__preset_select.length; index++) {\n      if (gui.__preset_select[index].value == gui.preset) {\n        gui.__preset_select.selectedIndex = index;\n      }\n    }\n  }\n\n  function markPresetModified(gui, modified) {\n    var opt = gui.__preset_select[gui.__preset_select.selectedIndex];\n//    console.log('mark', modified, opt);\n    if (modified) {\n      opt.innerHTML = opt.value + \"*\";\n    } else {\n      opt.innerHTML = opt.value;\n    }\n  }\n\n  function updateDisplays(controllerArray) {\n\n\n    if (controllerArray.length != 0) {\n\n      requestAnimationFrame(function() {\n        updateDisplays(controllerArray);\n      });\n\n    }\n\n    common.each(controllerArray, function(c) {\n      c.updateDisplay();\n    });\n\n  }\n\n  return GUI;\n\n})(dat.utils.css,\n\"<div id=\\\"dg-save\\\" class=\\\"dg dialogue\\\">\\n\\n  Here's the new load parameter for your <code>GUI</code>'s constructor:\\n\\n  <textarea id=\\\"dg-new-constructor\\\"></textarea>\\n\\n  <div id=\\\"dg-save-locally\\\">\\n\\n    <input id=\\\"dg-local-storage\\\" type=\\\"checkbox\\\"/> Automatically save\\n    values to <code>localStorage</code> on exit.\\n\\n    <div id=\\\"dg-local-explain\\\">The values saved to <code>localStorage</code> will\\n      override those passed to <code>dat.GUI</code>'s constructor. This makes it\\n      easier to work incrementally, but <code>localStorage</code> is fragile,\\n      and your friends may not see the same values you do.\\n      \\n    </div>\\n    \\n  </div>\\n\\n</div>\",\n\".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\\n\",\ndat.controllers.factory = (function (OptionController, NumberControllerBox, NumberControllerSlider, StringController, FunctionController, BooleanController, common) {\n\n      return function(object, property) {\n\n        var initialValue = object[property];\n\n        // Providing options?\n        if (common.isArray(arguments[2]) || common.isObject(arguments[2])) {\n          return new OptionController(object, property, arguments[2]);\n        }\n\n        // Providing a map?\n\n        if (common.isNumber(initialValue)) {\n\n          if (common.isNumber(arguments[2]) && common.isNumber(arguments[3])) {\n\n            // Has min and max.\n            return new NumberControllerSlider(object, property, arguments[2], arguments[3]);\n\n          } else {\n\n            return new NumberControllerBox(object, property, { min: arguments[2], max: arguments[3] });\n\n          }\n\n        }\n\n        if (common.isString(initialValue)) {\n          return new StringController(object, property);\n        }\n\n        if (common.isFunction(initialValue)) {\n          return new FunctionController(object, property, '');\n        }\n\n        if (common.isBoolean(initialValue)) {\n          return new BooleanController(object, property);\n        }\n\n      }\n\n    })(dat.controllers.OptionController,\ndat.controllers.NumberControllerBox,\ndat.controllers.NumberControllerSlider,\ndat.controllers.StringController = (function (Controller, dom, common) {\n\n  /**\n   * @class Provides a text input to alter the string property of an object.\n   *\n   * @extends dat.controllers.Controller\n   *\n   * @param {Object} object The object to be manipulated\n   * @param {string} property The name of the property to be manipulated\n   *\n   * @member dat.controllers\n   */\n  var StringController = function(object, property) {\n\n    StringController.superclass.call(this, object, property);\n\n    var _this = this;\n\n    this.__input = document.createElement('input');\n    this.__input.setAttribute('type', 'text');\n\n    dom.bind(this.__input, 'keyup', onChange);\n    dom.bind(this.__input, 'change', onChange);\n    dom.bind(this.__input, 'blur', onBlur);\n    dom.bind(this.__input, 'keydown', function(e) {\n      if (e.keyCode === 13) {\n        this.blur();\n      }\n    });\n    \n\n    function onChange() {\n      _this.setValue(_this.__input.value);\n    }\n\n    function onBlur() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n\n    this.updateDisplay();\n\n    this.domElement.appendChild(this.__input);\n\n  };\n\n  StringController.superclass = Controller;\n\n  common.extend(\n\n      StringController.prototype,\n      Controller.prototype,\n\n      {\n\n        updateDisplay: function() {\n          // Stops the caret from moving on account of:\n          // keyup -> setValue -> updateDisplay\n          if (!dom.isActive(this.__input)) {\n            this.__input.value = this.getValue();\n          }\n          return StringController.superclass.prototype.updateDisplay.call(this);\n        }\n\n      }\n\n  );\n\n  return StringController;\n\n})(dat.controllers.Controller,\ndat.dom.dom,\ndat.utils.common),\ndat.controllers.FunctionController,\ndat.controllers.BooleanController,\ndat.utils.common),\ndat.controllers.Controller,\ndat.controllers.BooleanController,\ndat.controllers.FunctionController,\ndat.controllers.NumberControllerBox,\ndat.controllers.NumberControllerSlider,\ndat.controllers.OptionController,\ndat.controllers.ColorController = (function (Controller, dom, Color, interpret, common) {\n\n  var ColorController = function(object, property) {\n\n    ColorController.superclass.call(this, object, property);\n\n    this.__color = new Color(this.getValue());\n    this.__temp = new Color(0);\n\n    var _this = this;\n\n    this.domElement = document.createElement('div');\n\n    dom.makeSelectable(this.domElement, false);\n\n    this.__selector = document.createElement('div');\n    this.__selector.className = 'selector';\n\n    this.__saturation_field = document.createElement('div');\n    this.__saturation_field.className = 'saturation-field';\n\n    this.__field_knob = document.createElement('div');\n    this.__field_knob.className = 'field-knob';\n    this.__field_knob_border = '2px solid ';\n\n    this.__hue_knob = document.createElement('div');\n    this.__hue_knob.className = 'hue-knob';\n\n    this.__hue_field = document.createElement('div');\n    this.__hue_field.className = 'hue-field';\n\n    this.__input = document.createElement('input');\n    this.__input.type = 'text';\n    this.__input_textShadow = '0 1px 1px ';\n\n    dom.bind(this.__input, 'keydown', function(e) {\n      if (e.keyCode === 13) { // on enter\n        onBlur.call(this);\n      }\n    });\n\n    dom.bind(this.__input, 'blur', onBlur);\n\n    dom.bind(this.__selector, 'mousedown', function(e) {\n\n      dom\n        .addClass(this, 'drag')\n        .bind(window, 'mouseup', function(e) {\n          dom.removeClass(_this.__selector, 'drag');\n        });\n\n    });\n\n    var value_field = document.createElement('div');\n\n    common.extend(this.__selector.style, {\n      width: '122px',\n      height: '102px',\n      padding: '3px',\n      backgroundColor: '#222',\n      boxShadow: '0px 1px 3px rgba(0,0,0,0.3)'\n    });\n\n    common.extend(this.__field_knob.style, {\n      position: 'absolute',\n      width: '12px',\n      height: '12px',\n      border: this.__field_knob_border + (this.__color.v < .5 ? '#fff' : '#000'),\n      boxShadow: '0px 1px 3px rgba(0,0,0,0.5)',\n      borderRadius: '12px',\n      zIndex: 1\n    });\n    \n    common.extend(this.__hue_knob.style, {\n      position: 'absolute',\n      width: '15px',\n      height: '2px',\n      borderRight: '4px solid #fff',\n      zIndex: 1\n    });\n\n    common.extend(this.__saturation_field.style, {\n      width: '100px',\n      height: '100px',\n      border: '1px solid #555',\n      marginRight: '3px',\n      display: 'inline-block',\n      cursor: 'pointer'\n    });\n\n    common.extend(value_field.style, {\n      width: '100%',\n      height: '100%',\n      background: 'none'\n    });\n    \n    linearGradient(value_field, 'top', 'rgba(0,0,0,0)', '#000');\n\n    common.extend(this.__hue_field.style, {\n      width: '15px',\n      height: '100px',\n      display: 'inline-block',\n      border: '1px solid #555',\n      cursor: 'ns-resize'\n    });\n\n    hueGradient(this.__hue_field);\n\n    common.extend(this.__input.style, {\n      outline: 'none',\n//      width: '120px',\n      textAlign: 'center',\n//      padding: '4px',\n//      marginBottom: '6px',\n      color: '#fff',\n      border: 0,\n      fontWeight: 'bold',\n      textShadow: this.__input_textShadow + 'rgba(0,0,0,0.7)'\n    });\n\n    dom.bind(this.__saturation_field, 'mousedown', fieldDown);\n    dom.bind(this.__field_knob, 'mousedown', fieldDown);\n\n    dom.bind(this.__hue_field, 'mousedown', function(e) {\n      setH(e);\n      dom.bind(window, 'mousemove', setH);\n      dom.bind(window, 'mouseup', unbindH);\n    });\n\n    function fieldDown(e) {\n      setSV(e);\n      // document.body.style.cursor = 'none';\n      dom.bind(window, 'mousemove', setSV);\n      dom.bind(window, 'mouseup', unbindSV);\n    }\n\n    function unbindSV() {\n      dom.unbind(window, 'mousemove', setSV);\n      dom.unbind(window, 'mouseup', unbindSV);\n      // document.body.style.cursor = 'default';\n    }\n\n    function onBlur() {\n      var i = interpret(this.value);\n      if (i !== false) {\n        _this.__color.__state = i;\n        _this.setValue(_this.__color.toOriginal());\n      } else {\n        this.value = _this.__color.toString();\n      }\n    }\n\n    function unbindH() {\n      dom.unbind(window, 'mousemove', setH);\n      dom.unbind(window, 'mouseup', unbindH);\n    }\n\n    this.__saturation_field.appendChild(value_field);\n    this.__selector.appendChild(this.__field_knob);\n    this.__selector.appendChild(this.__saturation_field);\n    this.__selector.appendChild(this.__hue_field);\n    this.__hue_field.appendChild(this.__hue_knob);\n\n    this.domElement.appendChild(this.__input);\n    this.domElement.appendChild(this.__selector);\n\n    this.updateDisplay();\n\n    function setSV(e) {\n\n      e.preventDefault();\n\n      var w = dom.getWidth(_this.__saturation_field);\n      var o = dom.getOffset(_this.__saturation_field);\n      var s = (e.clientX - o.left + document.body.scrollLeft) / w;\n      var v = 1 - (e.clientY - o.top + document.body.scrollTop) / w;\n\n      if (v > 1) v = 1;\n      else if (v < 0) v = 0;\n\n      if (s > 1) s = 1;\n      else if (s < 0) s = 0;\n\n      _this.__color.v = v;\n      _this.__color.s = s;\n\n      _this.setValue(_this.__color.toOriginal());\n\n\n      return false;\n\n    }\n\n    function setH(e) {\n\n      e.preventDefault();\n\n      var s = dom.getHeight(_this.__hue_field);\n      var o = dom.getOffset(_this.__hue_field);\n      var h = 1 - (e.clientY - o.top + document.body.scrollTop) / s;\n\n      if (h > 1) h = 1;\n      else if (h < 0) h = 0;\n\n      _this.__color.h = h * 360;\n\n      _this.setValue(_this.__color.toOriginal());\n\n      return false;\n\n    }\n\n  };\n\n  ColorController.superclass = Controller;\n\n  common.extend(\n\n      ColorController.prototype,\n      Controller.prototype,\n\n      {\n\n        updateDisplay: function() {\n\n          var i = interpret(this.getValue());\n\n          if (i !== false) {\n\n            var mismatch = false;\n\n            // Check for mismatch on the interpreted value.\n\n            common.each(Color.COMPONENTS, function(component) {\n              if (!common.isUndefined(i[component]) &&\n                  !common.isUndefined(this.__color.__state[component]) &&\n                  i[component] !== this.__color.__state[component]) {\n                mismatch = true;\n                return {}; // break\n              }\n            }, this);\n\n            // If nothing diverges, we keep our previous values\n            // for statefulness, otherwise we recalculate fresh\n            if (mismatch) {\n              common.extend(this.__color.__state, i);\n            }\n\n          }\n\n          common.extend(this.__temp.__state, this.__color.__state);\n\n          this.__temp.a = 1;\n\n          var flip = (this.__color.v < .5 || this.__color.s > .5) ? 255 : 0;\n          var _flip = 255 - flip;\n\n          common.extend(this.__field_knob.style, {\n            marginLeft: 100 * this.__color.s - 7 + 'px',\n            marginTop: 100 * (1 - this.__color.v) - 7 + 'px',\n            backgroundColor: this.__temp.toString(),\n            border: this.__field_knob_border + 'rgb(' + flip + ',' + flip + ',' + flip +')'\n          });\n\n          this.__hue_knob.style.marginTop = (1 - this.__color.h / 360) * 100 + 'px'\n\n          this.__temp.s = 1;\n          this.__temp.v = 1;\n\n          linearGradient(this.__saturation_field, 'left', '#fff', this.__temp.toString());\n\n          common.extend(this.__input.style, {\n            backgroundColor: this.__input.value = this.__color.toString(),\n            color: 'rgb(' + flip + ',' + flip + ',' + flip +')',\n            textShadow: this.__input_textShadow + 'rgba(' + _flip + ',' + _flip + ',' + _flip +',.7)'\n          });\n\n        }\n\n      }\n\n  );\n  \n  var vendors = ['-moz-','-o-','-webkit-','-ms-',''];\n  \n  function linearGradient(elem, x, a, b) {\n    elem.style.background = '';\n    common.each(vendors, function(vendor) {\n      elem.style.cssText += 'background: ' + vendor + 'linear-gradient('+x+', '+a+' 0%, ' + b + ' 100%); ';\n    });\n  }\n  \n  function hueGradient(elem) {\n    elem.style.background = '';\n    elem.style.cssText += 'background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);'\n    elem.style.cssText += 'background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);'\n    elem.style.cssText += 'background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);'\n    elem.style.cssText += 'background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);'\n    elem.style.cssText += 'background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);'\n  }\n\n\n  return ColorController;\n\n})(dat.controllers.Controller,\ndat.dom.dom,\ndat.color.Color = (function (interpret, math, toString, common) {\n\n  var Color = function() {\n\n    this.__state = interpret.apply(this, arguments);\n\n    if (this.__state === false) {\n      throw 'Failed to interpret color arguments';\n    }\n\n    this.__state.a = this.__state.a || 1;\n\n\n  };\n\n  Color.COMPONENTS = ['r','g','b','h','s','v','hex','a'];\n\n  common.extend(Color.prototype, {\n\n    toString: function() {\n      return toString(this);\n    },\n\n    toOriginal: function() {\n      return this.__state.conversion.write(this);\n    }\n\n  });\n\n  defineRGBComponent(Color.prototype, 'r', 2);\n  defineRGBComponent(Color.prototype, 'g', 1);\n  defineRGBComponent(Color.prototype, 'b', 0);\n\n  defineHSVComponent(Color.prototype, 'h');\n  defineHSVComponent(Color.prototype, 's');\n  defineHSVComponent(Color.prototype, 'v');\n\n  Object.defineProperty(Color.prototype, 'a', {\n\n    get: function() {\n      return this.__state.a;\n    },\n\n    set: function(v) {\n      this.__state.a = v;\n    }\n\n  });\n\n  Object.defineProperty(Color.prototype, 'hex', {\n\n    get: function() {\n\n      if (!this.__state.space !== 'HEX') {\n        this.__state.hex = math.rgb_to_hex(this.r, this.g, this.b);\n      }\n\n      return this.__state.hex;\n\n    },\n\n    set: function(v) {\n\n      this.__state.space = 'HEX';\n      this.__state.hex = v;\n\n    }\n\n  });\n\n  function defineRGBComponent(target, component, componentHexIndex) {\n\n    Object.defineProperty(target, component, {\n\n      get: function() {\n\n        if (this.__state.space === 'RGB') {\n          return this.__state[component];\n        }\n\n        recalculateRGB(this, component, componentHexIndex);\n\n        return this.__state[component];\n\n      },\n\n      set: function(v) {\n\n        if (this.__state.space !== 'RGB') {\n          recalculateRGB(this, component, componentHexIndex);\n          this.__state.space = 'RGB';\n        }\n\n        this.__state[component] = v;\n\n      }\n\n    });\n\n  }\n\n  function defineHSVComponent(target, component) {\n\n    Object.defineProperty(target, component, {\n\n      get: function() {\n\n        if (this.__state.space === 'HSV')\n          return this.__state[component];\n\n        recalculateHSV(this);\n\n        return this.__state[component];\n\n      },\n\n      set: function(v) {\n\n        if (this.__state.space !== 'HSV') {\n          recalculateHSV(this);\n          this.__state.space = 'HSV';\n        }\n\n        this.__state[component] = v;\n\n      }\n\n    });\n\n  }\n\n  function recalculateRGB(color, component, componentHexIndex) {\n\n    if (color.__state.space === 'HEX') {\n\n      color.__state[component] = math.component_from_hex(color.__state.hex, componentHexIndex);\n\n    } else if (color.__state.space === 'HSV') {\n\n      common.extend(color.__state, math.hsv_to_rgb(color.__state.h, color.__state.s, color.__state.v));\n\n    } else {\n\n      throw 'Corrupted color state';\n\n    }\n\n  }\n\n  function recalculateHSV(color) {\n\n    var result = math.rgb_to_hsv(color.r, color.g, color.b);\n\n    common.extend(color.__state,\n        {\n          s: result.s,\n          v: result.v\n        }\n    );\n\n    if (!common.isNaN(result.h)) {\n      color.__state.h = result.h;\n    } else if (common.isUndefined(color.__state.h)) {\n      color.__state.h = 0;\n    }\n\n  }\n\n  return Color;\n\n})(dat.color.interpret,\ndat.color.math = (function () {\n\n  var tmpComponent;\n\n  return {\n\n    hsv_to_rgb: function(h, s, v) {\n\n      var hi = Math.floor(h / 60) % 6;\n\n      var f = h / 60 - Math.floor(h / 60);\n      var p = v * (1.0 - s);\n      var q = v * (1.0 - (f * s));\n      var t = v * (1.0 - ((1.0 - f) * s));\n      var c = [\n        [v, t, p],\n        [q, v, p],\n        [p, v, t],\n        [p, q, v],\n        [t, p, v],\n        [v, p, q]\n      ][hi];\n\n      return {\n        r: c[0] * 255,\n        g: c[1] * 255,\n        b: c[2] * 255\n      };\n\n    },\n\n    rgb_to_hsv: function(r, g, b) {\n\n      var min = Math.min(r, g, b),\n          max = Math.max(r, g, b),\n          delta = max - min,\n          h, s;\n\n      if (max != 0) {\n        s = delta / max;\n      } else {\n        return {\n          h: NaN,\n          s: 0,\n          v: 0\n        };\n      }\n\n      if (r == max) {\n        h = (g - b) / delta;\n      } else if (g == max) {\n        h = 2 + (b - r) / delta;\n      } else {\n        h = 4 + (r - g) / delta;\n      }\n      h /= 6;\n      if (h < 0) {\n        h += 1;\n      }\n\n      return {\n        h: h * 360,\n        s: s,\n        v: max / 255\n      };\n    },\n\n    rgb_to_hex: function(r, g, b) {\n      var hex = this.hex_with_component(0, 2, r);\n      hex = this.hex_with_component(hex, 1, g);\n      hex = this.hex_with_component(hex, 0, b);\n      return hex;\n    },\n\n    component_from_hex: function(hex, componentIndex) {\n      return (hex >> (componentIndex * 8)) & 0xFF;\n    },\n\n    hex_with_component: function(hex, componentIndex, value) {\n      return value << (tmpComponent = componentIndex * 8) | (hex & ~ (0xFF << tmpComponent));\n    }\n\n  }\n\n})(),\ndat.color.toString,\ndat.utils.common),\ndat.color.interpret,\ndat.utils.common),\ndat.utils.requestAnimationFrame = (function () {\n\n  /**\n   * requirejs version of Paul Irish's RequestAnimationFrame\n   * http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n   */\n\n  return window.webkitRequestAnimationFrame ||\n      window.mozRequestAnimationFrame ||\n      window.oRequestAnimationFrame ||\n      window.msRequestAnimationFrame ||\n      function(callback, element) {\n\n        window.setTimeout(callback, 1000 / 60);\n\n      };\n})(),\ndat.dom.CenteredDiv = (function (dom, common) {\n\n\n  var CenteredDiv = function() {\n\n    this.backgroundElement = document.createElement('div');\n    common.extend(this.backgroundElement.style, {\n      backgroundColor: 'rgba(0,0,0,0.8)',\n      top: 0,\n      left: 0,\n      display: 'none',\n      zIndex: '1000',\n      opacity: 0,\n      WebkitTransition: 'opacity 0.2s linear'\n    });\n\n    dom.makeFullscreen(this.backgroundElement);\n    this.backgroundElement.style.position = 'fixed';\n\n    this.domElement = document.createElement('div');\n    common.extend(this.domElement.style, {\n      position: 'fixed',\n      display: 'none',\n      zIndex: '1001',\n      opacity: 0,\n      WebkitTransition: '-webkit-transform 0.2s ease-out, opacity 0.2s linear'\n    });\n\n\n    document.body.appendChild(this.backgroundElement);\n    document.body.appendChild(this.domElement);\n\n    var _this = this;\n    dom.bind(this.backgroundElement, 'click', function() {\n      _this.hide();\n    });\n\n\n  };\n\n  CenteredDiv.prototype.show = function() {\n\n    var _this = this;\n    \n\n\n    this.backgroundElement.style.display = 'block';\n\n    this.domElement.style.display = 'block';\n    this.domElement.style.opacity = 0;\n//    this.domElement.style.top = '52%';\n    this.domElement.style.webkitTransform = 'scale(1.1)';\n\n    this.layout();\n\n    common.defer(function() {\n      _this.backgroundElement.style.opacity = 1;\n      _this.domElement.style.opacity = 1;\n      _this.domElement.style.webkitTransform = 'scale(1)';\n    });\n\n  };\n\n  CenteredDiv.prototype.hide = function() {\n\n    var _this = this;\n\n    var hide = function() {\n\n      _this.domElement.style.display = 'none';\n      _this.backgroundElement.style.display = 'none';\n\n      dom.unbind(_this.domElement, 'webkitTransitionEnd', hide);\n      dom.unbind(_this.domElement, 'transitionend', hide);\n      dom.unbind(_this.domElement, 'oTransitionEnd', hide);\n\n    };\n\n    dom.bind(this.domElement, 'webkitTransitionEnd', hide);\n    dom.bind(this.domElement, 'transitionend', hide);\n    dom.bind(this.domElement, 'oTransitionEnd', hide);\n\n    this.backgroundElement.style.opacity = 0;\n//    this.domElement.style.top = '48%';\n    this.domElement.style.opacity = 0;\n    this.domElement.style.webkitTransform = 'scale(1.1)';\n\n  };\n\n  CenteredDiv.prototype.layout = function() {\n    this.domElement.style.left = window.innerWidth/2 - dom.getWidth(this.domElement) / 2 + 'px';\n    this.domElement.style.top = window.innerHeight/2 - dom.getHeight(this.domElement) / 2 + 'px';\n  };\n  \n  function lockScroll(e) {\n    console.log(e);\n  }\n\n  return CenteredDiv;\n\n})(dat.dom.dom,\ndat.utils.common),\ndat.dom.dom,\ndat.utils.common);","/**\n * dat-gui JavaScript Controller Library\n * http://code.google.com/p/dat-gui\n *\n * Copyright 2011 Data Arts Team, Google Creative Lab\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n */\n\n/** @namespace */\nvar dat = module.exports = dat || {};\n\n/** @namespace */\ndat.color = dat.color || {};\n\n/** @namespace */\ndat.utils = dat.utils || {};\n\ndat.utils.common = (function () {\n  \n  var ARR_EACH = Array.prototype.forEach;\n  var ARR_SLICE = Array.prototype.slice;\n\n  /**\n   * Band-aid methods for things that should be a lot easier in JavaScript.\n   * Implementation and structure inspired by underscore.js\n   * http://documentcloud.github.com/underscore/\n   */\n\n  return { \n    \n    BREAK: {},\n  \n    extend: function(target) {\n      \n      this.each(ARR_SLICE.call(arguments, 1), function(obj) {\n        \n        for (var key in obj)\n          if (!this.isUndefined(obj[key])) \n            target[key] = obj[key];\n        \n      }, this);\n      \n      return target;\n      \n    },\n    \n    defaults: function(target) {\n      \n      this.each(ARR_SLICE.call(arguments, 1), function(obj) {\n        \n        for (var key in obj)\n          if (this.isUndefined(target[key])) \n            target[key] = obj[key];\n        \n      }, this);\n      \n      return target;\n    \n    },\n    \n    compose: function() {\n      var toCall = ARR_SLICE.call(arguments);\n            return function() {\n              var args = ARR_SLICE.call(arguments);\n              for (var i = toCall.length -1; i >= 0; i--) {\n                args = [toCall[i].apply(this, args)];\n              }\n              return args[0];\n            }\n    },\n    \n    each: function(obj, itr, scope) {\n\n      \n      if (ARR_EACH && obj.forEach === ARR_EACH) { \n        \n        obj.forEach(itr, scope);\n        \n      } else if (obj.length === obj.length + 0) { // Is number but not NaN\n        \n        for (var key = 0, l = obj.length; key < l; key++)\n          if (key in obj && itr.call(scope, obj[key], key) === this.BREAK) \n            return;\n            \n      } else {\n\n        for (var key in obj) \n          if (itr.call(scope, obj[key], key) === this.BREAK)\n            return;\n            \n      }\n            \n    },\n    \n    defer: function(fnc) {\n      setTimeout(fnc, 0);\n    },\n    \n    toArray: function(obj) {\n      if (obj.toArray) return obj.toArray();\n      return ARR_SLICE.call(obj);\n    },\n\n    isUndefined: function(obj) {\n      return obj === undefined;\n    },\n    \n    isNull: function(obj) {\n      return obj === null;\n    },\n    \n    isNaN: function(obj) {\n      return obj !== obj;\n    },\n    \n    isArray: Array.isArray || function(obj) {\n      return obj.constructor === Array;\n    },\n    \n    isObject: function(obj) {\n      return obj === Object(obj);\n    },\n    \n    isNumber: function(obj) {\n      return obj === obj+0;\n    },\n    \n    isString: function(obj) {\n      return obj === obj+'';\n    },\n    \n    isBoolean: function(obj) {\n      return obj === false || obj === true;\n    },\n    \n    isFunction: function(obj) {\n      return Object.prototype.toString.call(obj) === '[object Function]';\n    }\n  \n  };\n    \n})();\n\n\ndat.color.toString = (function (common) {\n\n  return function(color) {\n\n    if (color.a == 1 || common.isUndefined(color.a)) {\n\n      var s = color.hex.toString(16);\n      while (s.length < 6) {\n        s = '0' + s;\n      }\n\n      return '#' + s;\n\n    } else {\n\n      return 'rgba(' + Math.round(color.r) + ',' + Math.round(color.g) + ',' + Math.round(color.b) + ',' + color.a + ')';\n\n    }\n\n  }\n\n})(dat.utils.common);\n\n\ndat.Color = dat.color.Color = (function (interpret, math, toString, common) {\n\n  var Color = function() {\n\n    this.__state = interpret.apply(this, arguments);\n\n    if (this.__state === false) {\n      throw 'Failed to interpret color arguments';\n    }\n\n    this.__state.a = this.__state.a || 1;\n\n\n  };\n\n  Color.COMPONENTS = ['r','g','b','h','s','v','hex','a'];\n\n  common.extend(Color.prototype, {\n\n    toString: function() {\n      return toString(this);\n    },\n\n    toOriginal: function() {\n      return this.__state.conversion.write(this);\n    }\n\n  });\n\n  defineRGBComponent(Color.prototype, 'r', 2);\n  defineRGBComponent(Color.prototype, 'g', 1);\n  defineRGBComponent(Color.prototype, 'b', 0);\n\n  defineHSVComponent(Color.prototype, 'h');\n  defineHSVComponent(Color.prototype, 's');\n  defineHSVComponent(Color.prototype, 'v');\n\n  Object.defineProperty(Color.prototype, 'a', {\n\n    get: function() {\n      return this.__state.a;\n    },\n\n    set: function(v) {\n      this.__state.a = v;\n    }\n\n  });\n\n  Object.defineProperty(Color.prototype, 'hex', {\n\n    get: function() {\n\n      if (!this.__state.space !== 'HEX') {\n        this.__state.hex = math.rgb_to_hex(this.r, this.g, this.b);\n      }\n\n      return this.__state.hex;\n\n    },\n\n    set: function(v) {\n\n      this.__state.space = 'HEX';\n      this.__state.hex = v;\n\n    }\n\n  });\n\n  function defineRGBComponent(target, component, componentHexIndex) {\n\n    Object.defineProperty(target, component, {\n\n      get: function() {\n\n        if (this.__state.space === 'RGB') {\n          return this.__state[component];\n        }\n\n        recalculateRGB(this, component, componentHexIndex);\n\n        return this.__state[component];\n\n      },\n\n      set: function(v) {\n\n        if (this.__state.space !== 'RGB') {\n          recalculateRGB(this, component, componentHexIndex);\n          this.__state.space = 'RGB';\n        }\n\n        this.__state[component] = v;\n\n      }\n\n    });\n\n  }\n\n  function defineHSVComponent(target, component) {\n\n    Object.defineProperty(target, component, {\n\n      get: function() {\n\n        if (this.__state.space === 'HSV')\n          return this.__state[component];\n\n        recalculateHSV(this);\n\n        return this.__state[component];\n\n      },\n\n      set: function(v) {\n\n        if (this.__state.space !== 'HSV') {\n          recalculateHSV(this);\n          this.__state.space = 'HSV';\n        }\n\n        this.__state[component] = v;\n\n      }\n\n    });\n\n  }\n\n  function recalculateRGB(color, component, componentHexIndex) {\n\n    if (color.__state.space === 'HEX') {\n\n      color.__state[component] = math.component_from_hex(color.__state.hex, componentHexIndex);\n\n    } else if (color.__state.space === 'HSV') {\n\n      common.extend(color.__state, math.hsv_to_rgb(color.__state.h, color.__state.s, color.__state.v));\n\n    } else {\n\n      throw 'Corrupted color state';\n\n    }\n\n  }\n\n  function recalculateHSV(color) {\n\n    var result = math.rgb_to_hsv(color.r, color.g, color.b);\n\n    common.extend(color.__state,\n        {\n          s: result.s,\n          v: result.v\n        }\n    );\n\n    if (!common.isNaN(result.h)) {\n      color.__state.h = result.h;\n    } else if (common.isUndefined(color.__state.h)) {\n      color.__state.h = 0;\n    }\n\n  }\n\n  return Color;\n\n})(dat.color.interpret = (function (toString, common) {\n\n  var result, toReturn;\n\n  var interpret = function() {\n\n    toReturn = false;\n\n    var original = arguments.length > 1 ? common.toArray(arguments) : arguments[0];\n\n    common.each(INTERPRETATIONS, function(family) {\n\n      if (family.litmus(original)) {\n\n        common.each(family.conversions, function(conversion, conversionName) {\n\n          result = conversion.read(original);\n\n          if (toReturn === false && result !== false) {\n            toReturn = result;\n            result.conversionName = conversionName;\n            result.conversion = conversion;\n            return common.BREAK;\n\n          }\n\n        });\n\n        return common.BREAK;\n\n      }\n\n    });\n\n    return toReturn;\n\n  };\n\n  var INTERPRETATIONS = [\n\n    // Strings\n    {\n\n      litmus: common.isString,\n\n      conversions: {\n\n        THREE_CHAR_HEX: {\n\n          read: function(original) {\n\n            var test = original.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);\n            if (test === null) return false;\n\n            return {\n              space: 'HEX',\n              hex: parseInt(\n                  '0x' +\n                      test[1].toString() + test[1].toString() +\n                      test[2].toString() + test[2].toString() +\n                      test[3].toString() + test[3].toString())\n            };\n\n          },\n\n          write: toString\n\n        },\n\n        SIX_CHAR_HEX: {\n\n          read: function(original) {\n\n            var test = original.match(/^#([A-F0-9]{6})$/i);\n            if (test === null) return false;\n\n            return {\n              space: 'HEX',\n              hex: parseInt('0x' + test[1].toString())\n            };\n\n          },\n\n          write: toString\n\n        },\n\n        CSS_RGB: {\n\n          read: function(original) {\n\n            var test = original.match(/^rgb\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\)/);\n            if (test === null) return false;\n\n            return {\n              space: 'RGB',\n              r: parseFloat(test[1]),\n              g: parseFloat(test[2]),\n              b: parseFloat(test[3])\n            };\n\n          },\n\n          write: toString\n\n        },\n\n        CSS_RGBA: {\n\n          read: function(original) {\n\n            var test = original.match(/^rgba\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\,\\s*(.+)\\s*\\)/);\n            if (test === null) return false;\n\n            return {\n              space: 'RGB',\n              r: parseFloat(test[1]),\n              g: parseFloat(test[2]),\n              b: parseFloat(test[3]),\n              a: parseFloat(test[4])\n            };\n\n          },\n\n          write: toString\n\n        }\n\n      }\n\n    },\n\n    // Numbers\n    {\n\n      litmus: common.isNumber,\n\n      conversions: {\n\n        HEX: {\n          read: function(original) {\n            return {\n              space: 'HEX',\n              hex: original,\n              conversionName: 'HEX'\n            }\n          },\n\n          write: function(color) {\n            return color.hex;\n          }\n        }\n\n      }\n\n    },\n\n    // Arrays\n    {\n\n      litmus: common.isArray,\n\n      conversions: {\n\n        RGB_ARRAY: {\n          read: function(original) {\n            if (original.length != 3) return false;\n            return {\n              space: 'RGB',\n              r: original[0],\n              g: original[1],\n              b: original[2]\n            };\n          },\n\n          write: function(color) {\n            return [color.r, color.g, color.b];\n          }\n\n        },\n\n        RGBA_ARRAY: {\n          read: function(original) {\n            if (original.length != 4) return false;\n            return {\n              space: 'RGB',\n              r: original[0],\n              g: original[1],\n              b: original[2],\n              a: original[3]\n            };\n          },\n\n          write: function(color) {\n            return [color.r, color.g, color.b, color.a];\n          }\n\n        }\n\n      }\n\n    },\n\n    // Objects\n    {\n\n      litmus: common.isObject,\n\n      conversions: {\n\n        RGBA_OBJ: {\n          read: function(original) {\n            if (common.isNumber(original.r) &&\n                common.isNumber(original.g) &&\n                common.isNumber(original.b) &&\n                common.isNumber(original.a)) {\n              return {\n                space: 'RGB',\n                r: original.r,\n                g: original.g,\n                b: original.b,\n                a: original.a\n              }\n            }\n            return false;\n          },\n\n          write: function(color) {\n            return {\n              r: color.r,\n              g: color.g,\n              b: color.b,\n              a: color.a\n            }\n          }\n        },\n\n        RGB_OBJ: {\n          read: function(original) {\n            if (common.isNumber(original.r) &&\n                common.isNumber(original.g) &&\n                common.isNumber(original.b)) {\n              return {\n                space: 'RGB',\n                r: original.r,\n                g: original.g,\n                b: original.b\n              }\n            }\n            return false;\n          },\n\n          write: function(color) {\n            return {\n              r: color.r,\n              g: color.g,\n              b: color.b\n            }\n          }\n        },\n\n        HSVA_OBJ: {\n          read: function(original) {\n            if (common.isNumber(original.h) &&\n                common.isNumber(original.s) &&\n                common.isNumber(original.v) &&\n                common.isNumber(original.a)) {\n              return {\n                space: 'HSV',\n                h: original.h,\n                s: original.s,\n                v: original.v,\n                a: original.a\n              }\n            }\n            return false;\n          },\n\n          write: function(color) {\n            return {\n              h: color.h,\n              s: color.s,\n              v: color.v,\n              a: color.a\n            }\n          }\n        },\n\n        HSV_OBJ: {\n          read: function(original) {\n            if (common.isNumber(original.h) &&\n                common.isNumber(original.s) &&\n                common.isNumber(original.v)) {\n              return {\n                space: 'HSV',\n                h: original.h,\n                s: original.s,\n                v: original.v\n              }\n            }\n            return false;\n          },\n\n          write: function(color) {\n            return {\n              h: color.h,\n              s: color.s,\n              v: color.v\n            }\n          }\n\n        }\n\n      }\n\n    }\n\n\n  ];\n\n  return interpret;\n\n\n})(dat.color.toString,\ndat.utils.common),\ndat.color.math = (function () {\n\n  var tmpComponent;\n\n  return {\n\n    hsv_to_rgb: function(h, s, v) {\n\n      var hi = Math.floor(h / 60) % 6;\n\n      var f = h / 60 - Math.floor(h / 60);\n      var p = v * (1.0 - s);\n      var q = v * (1.0 - (f * s));\n      var t = v * (1.0 - ((1.0 - f) * s));\n      var c = [\n        [v, t, p],\n        [q, v, p],\n        [p, v, t],\n        [p, q, v],\n        [t, p, v],\n        [v, p, q]\n      ][hi];\n\n      return {\n        r: c[0] * 255,\n        g: c[1] * 255,\n        b: c[2] * 255\n      };\n\n    },\n\n    rgb_to_hsv: function(r, g, b) {\n\n      var min = Math.min(r, g, b),\n          max = Math.max(r, g, b),\n          delta = max - min,\n          h, s;\n\n      if (max != 0) {\n        s = delta / max;\n      } else {\n        return {\n          h: NaN,\n          s: 0,\n          v: 0\n        };\n      }\n\n      if (r == max) {\n        h = (g - b) / delta;\n      } else if (g == max) {\n        h = 2 + (b - r) / delta;\n      } else {\n        h = 4 + (r - g) / delta;\n      }\n      h /= 6;\n      if (h < 0) {\n        h += 1;\n      }\n\n      return {\n        h: h * 360,\n        s: s,\n        v: max / 255\n      };\n    },\n\n    rgb_to_hex: function(r, g, b) {\n      var hex = this.hex_with_component(0, 2, r);\n      hex = this.hex_with_component(hex, 1, g);\n      hex = this.hex_with_component(hex, 0, b);\n      return hex;\n    },\n\n    component_from_hex: function(hex, componentIndex) {\n      return (hex >> (componentIndex * 8)) & 0xFF;\n    },\n\n    hex_with_component: function(hex, componentIndex, value) {\n      return value << (tmpComponent = componentIndex * 8) | (hex & ~ (0xFF << tmpComponent));\n    }\n\n  }\n\n})(),\ndat.color.toString,\ndat.utils.common);","module.exports = require('./vendor/dat.gui')\nmodule.exports.color = require('./vendor/dat.color')","import * as Core from '../lib/core';\r\n\r\nimport dat from 'dat-gui';\r\n\r\nexport class DatGui extends Core.System {\r\n\r\n  initialize() {\r\n    this.gui = new dat.GUI();\r\n  }\r\n\r\n}\r\nCore.registerSystem('DatGui', DatGui);\r\n","import * as Core from '../lib/core';\n\nexport class Name extends Core.Component {\n  static defaults() {\n    return { name: 'unnamed' };\n  }\n  static findEntityByName(world, name) {\n    const names = world.get('Name');\n    for (const nid in names) {\n      const nameComponent = names[nid];\n      if (nameComponent.name === name) {\n        return nid;\n      }\n    }\n  }\n}\n\nCore.registerComponent('Name', Name);\n","import * as Core from '../lib/core';\n\nexport class Health extends Core.Component {\n  static defaults() {\n    return { max: 1000, current: null, show_bar: true };\n  }\n  static create(attrs) {\n    const c = super.create(attrs);\n    c.current = c.max;\n    return c;\n  }\n}\n\nCore.registerComponent('Health', Health);\n","import { Component, System, registerComponent, registerSystem } from '../lib/core';\nimport QuadTree from '../lib/QuadTree';\n\nexport class Position extends Component {\n  static defaults() {\n    return { x: 0, y: 0, rotation: 0 };\n  }\n}\n\nregisterComponent('Position', Position);\n\nlet entityId, sprite, position, positions;\n\nexport class PositionSystem extends System {\n\n  defaultOptions() {\n    return {\n      quadtreeMaxAge: 2,\n      quadtreeObjectsPerNode: 5,\n      quadtreeMaxLevels: 5\n    };\n  }\n\n  matchComponent() { return 'Position'; }\n\n  initialize() {\n    this.bounds = {\n      left: 0, top: 0, right: 0, bottom: 0,\n      width: 0, height: 0\n    };\n    this.quadtree = new QuadTree(\n      -1000, -1000, 2000, 2000,\n      this.options.quadtreeObjectsPerNode,\n      this.options.quadtreeMaxLevels\n    );\n  }\n\n  update(timeDelta) {\n    this.updateBounds();\n    this.resetQuadtree(timeDelta);\n    super.update(timeDelta);\n  }\n\n  resetQuadtree() {\n    this.quadtree.reset(\n      this.bounds.left,\n      this.bounds.top,\n      this.bounds.width,\n      this.bounds.height,\n      this.options.quadtreeObjectsPerNode,\n      this.options.quadtreeMaxLevels\n    );\n  }\n\n  updateBounds() {\n    this.bounds.left = this.bounds.top = this.bounds.right = this.bounds.bottom = null;\n    positions = this.getMatchingComponents();\n    for (entityId in positions) {\n      position = positions[entityId];\n      if (this.bounds.left === null || position.left < this.bounds.left) { this.bounds.left = position.left; }\n      if (this.bounds.top === null || position.top < this.bounds.top) { this.bounds.top = position.top; }\n      if (this.bounds.right === null || position.right > this.bounds.right) { this.bounds.right = position.right; }\n      if (this.bounds.bottom === null || position.bottom > this.bounds.bottom) { this.bounds.bottom = position.bottom; }\n    }\n    this.bounds.width = this.bounds.right - this.bounds.left;\n    this.bounds.height = this.bounds.bottom - this.bounds.top;\n  }\n\n  updateComponent(timeDelta, entityId, position) {\n    sprite = this.world.get('Sprite', entityId);\n    if (!sprite) { return; }\n\n    const halfWidth = sprite.width / 2;\n    const halfHeight = sprite.height / 2;\n\n    position.entityId = entityId;\n    position.width = sprite.width;\n    position.height = sprite.height;\n    position.left = position.x - halfWidth;\n    position.top = position.y - halfHeight;\n    position.right = position.x + halfWidth;\n    position.bottom = position.y + halfHeight;\n\n    this.quadtree.insert(position);\n  }\n\n  draw(/* timeDelta */) {\n    const g = this.getDebugGraphics();\n    if (!g) { return; }\n\n    g.lineStyle(4, 0x882222);\n    positions = this.getMatchingComponents();\n    for (entityId in positions) {\n      position = positions[entityId];\n      sprite = this.world.get('Sprite', entityId);\n      g.drawCircle(position.x, position.y, sprite.width / 2);\n      g.moveTo(position.x - 20, position.y);\n      g.lineTo(position.x + 20, position.y);\n      g.moveTo(position.x, position.y - 20);\n      g.lineTo(position.x, position.y + 20);\n    }\n\n    g.lineStyle(4, 0x228822);\n    this.drawDebugQuadtreeNode(g, this.quadtree);\n\n    g.lineStyle(4, 0xffff33);\n    g.moveTo(-20, 0);\n    g.lineTo(20, 0);\n    g.moveTo(0, -20);\n    g.lineTo(0, 20);\n    g.moveTo(0, 0);\n    g.drawRect(\n      this.bounds.left,\n      this.bounds.top,\n      this.bounds.width,\n      this.bounds.height\n    );\n  }\n\n  drawDebugQuadtreeNode(g, root) {\n    if (!root) { return; }\n\n    g.lineStyle(4, 0x883388);\n    g.drawRect(root.bounds.left, root.bounds.top,\n               root.bounds.width, root.bounds.height);\n\n    g.lineStyle(4, 0x112222);\n    root.objects.forEach(body =>\n      g.drawRect(body.left, body.top, body.width, body.height));\n\n    this.drawDebugQuadtreeNode(g, root.nodes[0]);\n    this.drawDebugQuadtreeNode(g, root.nodes[1]);\n    this.drawDebugQuadtreeNode(g, root.nodes[2]);\n    this.drawDebugQuadtreeNode(g, root.nodes[3]);\n  }\n}\n\nregisterSystem('Position', PositionSystem);\n","import * as Core from '../lib/core';\n\nimport './position';\n\nconst PI2 = Math.PI * 2;\n\nexport class Motion extends Core.Component {\n  static defaults() {\n    return { dx: 0, dy: 0, drotation: 0 };\n  }\n}\nCore.registerComponent('Motion', Motion);\n\nexport class MotionSystem extends Core.System {\n  matchComponent() {\n    return 'Motion';\n  }\n  updateComponent(timeDelta, entityId, motion) {\n    const pos = this.world.get('Position', entityId);\n    pos.x += motion.dx * timeDelta;\n    pos.y += motion.dy * timeDelta;\n\n    // Update the rotation, ensuring a 0..2*Math.PI range.\n    pos.rotation = (pos.rotation + (motion.drotation * timeDelta)) % PI2;\n    if (pos.rotation < 0) {\n      pos.rotation += PI2;\n    }\n  }\n}\nCore.registerSystem('Motion', MotionSystem);\n","import * as Core from '../lib/core';\n\nimport './position';\nimport './motion';\n\nimport Vector2D from '../lib/Vector2D';\n\nexport class Thruster extends Core.Component {\n  static defaults() {\n    return {\n      active: true,\n      stop: false,\n      useBrakes: true,\n      deltaV: 0,\n      maxV: 0\n    };\n  }\n}\nCore.registerComponent('Thruster', Thruster);\n\nexport class ThrusterSystem extends Core.System {\n\n  matchComponent() { return 'Thruster'; }\n\n  initialize() {\n    this.vInertia = new Vector2D();\n    this.vThrust = new Vector2D();\n    this.vBrakes = new Vector2D();\n  }\n\n  updateComponent(timeDelta, entityId, thruster) {\n\n    if (!thruster.active) { return; }\n\n    const pos = this.world.get('Position', entityId);\n    const motion = this.world.get('Motion', entityId);\n    if (!pos || !motion) { return; }\n\n    // Inertia is current motion\n    this.vInertia.setValues(motion.dx, motion.dy);\n\n    // delta-v available for the current tick\n    const tickDeltaV = timeDelta * thruster.deltaV;\n\n    if (!thruster.stop) {\n      // Create thrust vector per rotation and add to inertia.\n      this.vThrust.setValues(tickDeltaV, 0);\n      this.vThrust.rotate(pos.rotation);\n      this.vInertia.add(this.vThrust);\n    }\n\n    if (thruster.useBrakes) {\n      // Try to enforce the max_v limit with braking thrust.\n      const maxV = thruster.stop ? 0 : thruster.maxV;\n      const currV = this.vInertia.magnitude();\n      const overV = currV - maxV;\n      if (overV > 0) {\n        // Braking delta-v is max thruster output or remaining overage,\n        // whichever is smallest. Braking vector opposes inertia.\n        const brakingDv = Math.min(tickDeltaV, overV);\n        this.vBrakes.setValues(this.vInertia.x, this.vInertia.y);\n        this.vBrakes.normalize();\n        this.vBrakes.multiplyScalar(0-brakingDv);\n        this.vInertia.add(this.vBrakes);\n      }\n      if (thruster.stop && currV === 0) {\n        thruster.active = false;\n      }\n    }\n\n    // Update inertia. Note that we've been careful only to make changes\n    // to inertia within the delta-v of the thruster. Other influences\n    // on inertia should be preserved.\n    motion.dx = this.vInertia.x;\n    motion.dy = this.vInertia.y;\n  }\n\n}\nCore.registerSystem('Thruster', ThrusterSystem);\n","import * as Core from '../lib/core';\n\nimport '../plugins/position';\nimport '../plugins/motion';\n\nimport Vector2D from '../lib/Vector2D';\n\nexport class Seeker extends Core.Component {\n  static defaults() {\n    return {\n      active: true,\n      targetName: null,\n      targetEntityId: null,\n      targetPosition: null,\n      acquisitionDelay: 0,\n      radPerSec: Math.PI\n    };\n  }\n}\n\nCore.registerComponent('Seeker', Seeker);\n\nexport class SeekerSystem extends Core.System {\n\n  matchComponent() { return 'Seeker'; }\n\n  initialize() {\n    this.vSeeker = new Vector2D();\n    this.vTarget = new Vector2D();\n  }\n\n  updateComponent(timeDelta, entityId, seeker) {\n\n    if (!seeker.active) { return; }\n\n    // Look up the orbited entity ID, if only name given.\n    if (seeker.targetName && !seeker.targetEntityId) {\n      seeker.targetEntityId = Core.getComponent('Name')\n        .findEntityByName(this.world, seeker.targetName);\n    }\n\n    // Process a delay before the seeker 'acquires' the target and\n    // starts steering. Makes missiles look interesting.\n    if (seeker.acquisitionDelay > 0) {\n      seeker.acquisitionDelay -= timeDelta;\n      return;\n    }\n\n    const position = this.world.get('Position', entityId);\n    const motion = this.world.get('Motion', entityId);\n    if (!position || !motion) { return; }\n\n    // Accept either a raw x/y coord or entity ID as target\n    let targetPosition = seeker.targetPosition;\n    if (!targetPosition) {\n      targetPosition = this.world.get('Position', seeker.targetEntityId);\n    }\n    if (!targetPosition) { return; }\n\n    // Set up the vectors for angle math...\n    this.vSeeker.setValues(position.x, position.y);\n    this.vTarget.setValues(targetPosition.x, targetPosition.y);\n\n    // Get the target angle, ensuring a 0..2*Math.PI range.\n    let targetAngle = this.vSeeker.angleTo(this.vTarget);\n    if (targetAngle < 0) {\n      targetAngle += (2 * Math.PI);\n    }\n\n    // Pick the direction from current to target angle\n    let direction = (targetAngle < position.rotation) ? -1 : 1;\n\n    // If the offset between the angles is more than half a circle, go\n    // the other way because it'll be shorter.\n    const offset = Math.abs(targetAngle - position.rotation);\n    if (offset > Math.PI) {\n      direction = 0 - direction;\n    }\n\n    // Work out the desired delta-rotation to steer toward target\n    const targetDr = direction * Math.min(seeker.radPerSec, offset / timeDelta);\n\n    // Calculate the delta-rotation impulse required to meet the goal,\n    // but constrain to the capability of the steering thrusters\n    let impulseDr = (targetDr - motion.drotation);\n    if (Math.abs(impulseDr) > seeker.radPerSec) {\n      if (impulseDr > 0) {\n        impulseDr = seeker.radPerSec;\n      } else if (impulseDr < 0) {\n        impulseDr = 0 - seeker.radPerSec;\n      }\n    }\n    motion.drotation += impulseDr;\n\n  }\n\n}\n\nCore.registerSystem('Seeker', SeekerSystem);\n","import * as Core from '../lib/core';\n\nexport class Collidable extends Core.Component {\n  static defaults() {\n    return {\n      inCollision: false,\n      inCollisionWith: {}\n    };\n  }\n}\n\nCore.registerComponent('Collidable', Collidable);\n\nlet match, matches, entityId, entityId2, position, aCollidable, bCollidable, dx, dy, radii;\n\nexport class CollisionSystem extends Core.System {\n\n  defaultOptions() {\n    return {\n      positionSystemName: 'Position'\n    };\n  }\n\n  matchComponent() { return 'Collidable'; }\n\n  initialize() {\n    this.positionSystem = this.world.getSystem(this.options.positionSystemName);\n    this.width = this.options.width;\n    this.height = this.options.height;\n    this.retrieveBounds = {};\n    this.checkCollisionBound = (neighbor, component) =>\n      this.checkCollision(neighbor, component);\n  }\n\n  update(/* timeDelta */) {\n    matches = this.getMatchingComponents();\n    for (entityId in matches) {\n      match = matches[entityId];\n      match.inCollision = false;\n      for (entityId2 in match.inCollisionWith) {\n        delete match.inCollisionWith[entityId2];\n      }\n    }\n    for (entityId in matches) {\n      position = this.world.get('Position', entityId);\n      if (position) {\n        this.positionSystem.quadtree.iterate(position, this.checkCollisionBound, position);\n      }\n    }\n  }\n\n  checkCollision(bPosition, aPosition) {\n    if (aPosition.entityId === bPosition.entityId) { return; }\n\n    aCollidable = this.world.get('Collidable', aPosition.entityId);\n    bCollidable = this.world.get('Collidable', bPosition.entityId);\n\n    if (!aCollidable || !bCollidable) { return; }\n\n    dx = aPosition.x - bPosition.x;\n    dy = aPosition.y - bPosition.y;\n\n    // TODO: Pluggable shape intersection detection here?\n\n    // Check collision circle via distance\n    radii = (aPosition.width + bPosition.width) / 2;\n    if (dx*dx + dy*dy > radii*radii) { return; }\n\n    aCollidable.inCollision = true;\n    aCollidable.inCollisionWith[bPosition.entityId] = 1;\n\n    bCollidable.inCollision = true;\n    bCollidable.inCollisionWith[aPosition.entityId] = 1;\n  }\n\n  draw(/* timeDelta */) {\n    const g = this.getDebugGraphics();\n    if (!g) { return; }\n\n    g.lineStyle(4, 0x999999);\n    const collidables = this.world.get('Collidable');\n    for (const entityId in collidables) {\n      const collidable = collidables[entityId];\n      const position = this.world.get('Position', entityId);\n\n      if (collidable.inCollision) {\n        g.drawCircle(position.x, position.y, 40);\n      }\n    }\n\n  }\n}\n\nCore.registerSystem('Collision', CollisionSystem);\n","import * as Core from '../lib/core';\n\nimport './position';\nimport './motion';\n\nimport Vector2D from '../lib/Vector2D';\n\nexport class BounceComponent extends Core.Component {\n  static defaults() {\n    return {\n      mass: 1000.0\n    };\n  }\n}\n\nCore.registerComponent('Bounce', BounceComponent);\n\nexport class BounceSystem extends Core.System {\n\n  matchComponent() { return 'Bounce'; }\n\n  initialize() {\n    this.dn = new Vector2D();\n    this.dt = new Vector2D();\n    this.mt = new Vector2D();\n    this.v1 = new Vector2D();\n    this.v2 = new Vector2D();\n    this.v1n = new Vector2D();\n    this.v1t = new Vector2D();\n    this.v2n = new Vector2D();\n    this.v2t = new Vector2D();\n  }\n\n  update(timeDelta) {\n    const entities = this.world;\n    const matches = this.getMatchingComponents();\n\n    const pairs = {};\n    for (const aEntityId in matches) {\n\n      // const bounce = matches[aEntityId];\n      const aCollidable = entities.get('Collidable', aEntityId);\n\n      for (const bEntityId in aCollidable.inCollisionWith) {\n        const pair = [aEntityId, bEntityId];\n        pair.sort();\n        pairs[pair.join(':')] = pair;\n      }\n\n      // TODO: Process world boundary edge bounce?\n\n    }\n\n    for (const key in pairs) {\n      const aEntityId = pairs[key][0];\n      const aBouncer = entities.get('Bounce', aEntityId);\n      if (!aBouncer) { continue; }\n\n      const bEntityId = pairs[key][1];\n      const bBouncer = entities.get('Bounce', bEntityId);\n      if (!bBouncer) { continue; }\n\n      this.resolveElasticCollision(timeDelta, aEntityId, aBouncer, bEntityId, bBouncer);\n    }\n\n  }\n\n  // See also:\n  // http://en.m.wikipedia.org/wiki/Elastic_collision\n  // http://en.m.wikipedia.org/wiki/Dot_product\n  // https://github.com/Edifear/volleyball/blob/master/collision.html\n  // https://github.com/DominikWidomski/Processing/blob/master/sketch_canvas_red_particles/particles.pde#L47\n  resolveElasticCollision(timeDelta, aEntityId, aBouncer, bEntityId, bBouncer) {\n\n    const entities = this.world;\n\n    const aPosition = entities.get('Position', aEntityId);\n    const aSprite = entities.get('Sprite', aEntityId);\n    const aMotion = entities.get('Motion', aEntityId);\n\n    const bPosition = entities.get('Position', bEntityId);\n    const bSprite = entities.get('Sprite', bEntityId);\n    const bMotion = entities.get('Motion', bEntityId);\n\n    // First, back both entities off to try to prevent sticking\n    /*\n    aPosition.x -= aMotion.dx * timeDelta;\n    aPosition.y -= aMotion.dy * timeDelta;\n    bPosition.x -= bMotion.dx * timeDelta;\n    bPosition.y -= bMotion.dy * timeDelta;\n    const radii, dx, dy;\n    while (true) {\n      aPosition.x -= aMotion.dx * timeDelta;\n      aPosition.y -= aMotion.dy * timeDelta;\n      bPosition.x -= bMotion.dx * timeDelta;\n      bPosition.y -= bMotion.dy * timeDelta;\n\n      radii = (aSprite.size + bSprite.size) / 2;\n      dx = aPosition.x - bPosition.x;\n      dy = aPosition.y - bPosition.y;\n      if (dx*dx + dy*dy > radii*radii) { break; }\n    }\n    */\n\n    // Vector between entities\n    this.dn.setValues(aPosition.x - bPosition.x, aPosition.y - bPosition.y);\n\n    // Distance between entities\n    const delta = this.dn.magnitude();\n\n    // Normal vector of the collision plane\n    this.dn.normalize();\n\n    // Tangential vector of the collision plane\n    this.dt.setValues(this.dn.y, -this.dn.x);\n\n    // HACK: avoid divide by zero\n    if (delta === 0) { bPosition.x += 0.01; }\n\n    // Get total mass for entities\n    const m1 = aBouncer.mass;\n    const m2 = bBouncer.mass;\n    const M = m1 + m2;\n\n    // Minimum translation vector to push entities apart\n    this.mt.setValues(\n      this.dn.x * (aSprite.width + bSprite.width - delta) * 1.1,\n      this.dn.y * (aSprite.height + bSprite.height - delta) * 1.1\n    );\n\n    // Velocity vectors of entities before collision\n    this.v1.setValues((aMotion) ? aMotion.dx : 0, (aMotion) ? aMotion.dy : 0);\n    this.v2.setValues((bMotion) ? bMotion.dx : 0, (bMotion) ? bMotion.dy : 0);\n\n    // split the velocity vector of the first entity into a normal\n    // and a tangential component in respect of the collision plane\n    this.v1n.setValues(\n      this.dn.x * this.v1.dot(this.dn),\n      this.dn.y * this.v1.dot(this.dn)\n    );\n    this.v1t.setValues(\n      this.dt.x * this.v1.dot(this.dt),\n      this.dt.y * this.v1.dot(this.dt)\n    );\n\n    // split the velocity vector of the second entity into a normal\n    // and a tangential component in respect of the collision plane\n    this.v2n.setValues(\n      this.dn.x * this.v2.dot(this.dn),\n      this.dn.y * this.v2.dot(this.dn)\n    );\n    this.v2t.setValues(\n      this.dt.x * this.v2.dot(this.dt),\n      this.dt.y * this.v2.dot(this.dt)\n    );\n\n    // calculate new velocity vectors of the entities, the tangential\n    // component stays the same, the normal component changes analog to\n    // the 1-Dimensional case\n\n    if (aMotion) {\n      const aFactor = (m1 - m2) / M * this.v1n.magnitude() +\n                    2 * m2 / M * this.v2n.magnitude();\n      aMotion.dx = this.v1t.x + this.dn.x * aFactor;\n      aMotion.dy = this.v1t.y + this.dn.y * aFactor;\n      // @processDamage(eid, bEntityId, v_motion, bouncer, m1)\n    }\n\n    if (bMotion) {\n      const bFactor = (m2 - m1) / M * this.v2n.magnitude() +\n                    2 * m1 / M * this.v1n.magnitude();\n      bMotion.dx = this.v2t.x - this.dn.x * bFactor;\n      bMotion.dy = this.v2t.y - this.dn.y * bFactor;\n      // @processDamage(eid, bEntityId, v_bMotion, c_bouncer, m2)\n    }\n\n  }\n\n}\n\nCore.registerSystem('Bounce', BounceSystem);\n","import { Component, System, registerComponent, registerSystem } from '../lib/core';\r\n\r\nexport class PlayerInputSteering extends Component {\r\n  static defaults() {\r\n    return {\r\n      active: true,\r\n      radPerSec: Math.PI * 2\r\n    };\r\n  }\r\n}\r\n\r\nregisterComponent('PlayerInputSteering', PlayerInputSteering);\r\n\r\nconst PI2 = Math.PI * 2;\r\n\r\nexport class PlayerInputSteeringSystem extends System {\r\n\r\n  defaultOptions() {\r\n    return {\r\n      gamepadDeadzone: 0.2\r\n    };\r\n  }\r\n\r\n  matchComponent() { return 'PlayerInputSteering'; }\r\n\r\n  initialize() {\r\n    this.gamepad = { active: false };\r\n    this.pointer = { active: false, x: 0, y: 0 };\r\n    this.keys = { active: false };\r\n    this.touch = { active: false, x: 0, y: 0 };\r\n\r\n    this.world\r\n      .subscribe('mouseDown', (msg, cursorPosition) =>\r\n        this.setPointer(true, cursorPosition))\r\n      .subscribe('mouseUp', (msg, cursorPosition) =>\r\n        this.setPointer(false, cursorPosition))\r\n      .subscribe('mouseMove', (msg, cursorPosition) =>\r\n        this.setPointer(this.pointer.active, cursorPosition));\r\n\r\n    const windowEvents = {\r\n      keydown: this.handleKeyDown,\r\n      keyup: this.handleKeyUp\r\n    };\r\n    Object.keys(windowEvents)\r\n      .forEach(k => window.addEventListener(k, windowEvents[k].bind(this)));\r\n  }\r\n\r\n  setPointer(active, position) {\r\n    this.pointer.active = active;\r\n    this.pointer.x = position.x;\r\n    this.pointer.y = position.y;\r\n  }\r\n\r\n  update(timeDelta) {\r\n    this.updateGamepads(timeDelta);\r\n    this.updateKeyboard(timeDelta);\r\n    super.update(timeDelta);\r\n  }\r\n\r\n  updateComponent(timeDelta, entityId, steering) {\r\n    const thruster = this.world.get('Thruster', entityId);\r\n    const motion = this.world.get('Motion', entityId);\r\n\r\n    thruster.active = true;\r\n    thruster.stop = false;\r\n\r\n    if (this.keys.active) {\r\n      return this.updateComponentFromKeyboard(timeDelta, entityId, steering);\r\n    }\r\n\r\n    if (this.pointer.active) {\r\n      return this.updateComponentFromPointer(timeDelta, entityId, steering);\r\n    }\r\n\r\n    if (this.gamepad.active) {\r\n      return this.updateComponentFromGamepad(timeDelta, entityId, steering);\r\n    }\r\n\r\n    thruster.stop = true;\r\n    motion.drotation = 0;\r\n  }\r\n\r\n  updateComponentFromPointer(timeDelta, entityId, steering) {\r\n    const position = this.world.get('Position', entityId);\r\n    this.updateMotionFromTargetAngle(timeDelta, entityId, steering,\r\n      Math.atan2(this.pointer.y - position.y, this.pointer.x - position.x));\r\n  }\r\n\r\n  updateComponentFromGamepad(timeDelta, entityId, steering) {\r\n    this.updateMotionFromTargetAngle(timeDelta, entityId, steering,\r\n      Math.atan2(this.gamepad.axis1, this.gamepad.axis0));\r\n  }\r\n\r\n  updateComponentFromKeyboard(timeDelta, entityId, steering) {\r\n    const thruster = this.world.get('Thruster', entityId);\r\n    const motion = this.world.get('Motion', entityId);\r\n\r\n    const dleft  = (this.keys[65] || this.keys[37] || this.gamepad.button13);\r\n    const dright = (this.keys[68] || this.keys[39] || this.gamepad.button14);\r\n    const dup    = (this.keys[87] || this.keys[38] || this.gamepad.button11);\r\n    // const ddown  = (this.keys[83] || this.keys[40] || this.gamepad.button12);\n\r\n    if (dup) {\r\n      thruster.active = true;\r\n    } else {\r\n      thruster.stop = true;\r\n    }\r\n\r\n    const direction = dleft ? -1 : (dright ? 1 : 0);\r\n    const targetDr = direction * steering.radPerSec;\r\n    motion.drotation = targetDr;\r\n  }\r\n\r\n  updateGamepads() {\r\n    const gamepads = navigator.getGamepads ? navigator.getGamepads() : [];\r\n\r\n    // TODO: specify which gamepad, i.e. for multiplayer\r\n    for (let i = 0; i < gamepads.length; i++) {\r\n      const gp = gamepads[i];\r\n      if (!gp || !gp.connected) continue;\r\n      gp.buttons.forEach((val, idx) => this.gamepad[`button${idx}`] = val.pressed);\r\n      gp.axes.forEach((val, idx) => this.gamepad[`axis${idx}`] = val);\r\n      break; // stop after the first gamepad\r\n    }\r\n\r\n    Object.keys(this.gamepad).forEach(k => {\r\n      if (!this.gamepad[k]) { delete this.gamepad[k]; }\r\n    });\r\n\r\n    const axisX = this.gamepad.axis0;\r\n    const axisY = this.gamepad.axis1;\r\n    this.gamepad.active =\r\n      (Math.abs(axisX) > 0 || Math.abs(axisY) > 0) &&\r\n      (Math.sqrt(axisX * axisX + axisY * axisY) > this.options.gamepadDeadzone);\r\n  }\r\n\r\n  updateKeyboard() {\r\n    const dleft  = (this.keys[65] || this.keys[37] || this.gamepad.button13);\r\n    const dright = (this.keys[68] || this.keys[39] || this.gamepad.button14);\r\n    const dup    = (this.keys[87] || this.keys[38] || this.gamepad.button11);\r\n    const ddown  = (this.keys[83] || this.keys[40] || this.gamepad.button12);\r\n\r\n    this.keys.active = (dleft || dright || dup || ddown);\r\n  }\r\n\r\n  handleKeyDown(ev) {\r\n    this.keys[ev.keyCode] = true;\r\n    ev.preventDefault();\r\n  }\r\n\r\n  handleKeyUp(ev) {\r\n    delete this.keys[ev.keyCode];\r\n    ev.preventDefault();\r\n  }\r\n\r\n  updateMotionFromTargetAngle(timeDelta, entityId, steering, targetAngleRaw) {\r\n    const position = this.world.get('Position', entityId);\r\n    const motion = this.world.get('Motion', entityId);\r\n\r\n    const targetAngle = (targetAngleRaw < 0) ?\r\n      targetAngleRaw + PI2 : targetAngleRaw;\r\n\r\n    // Pick the direction from current to target angle\r\n    let direction = (targetAngle < position.rotation) ? -1 : 1;\r\n\r\n    // If the offset between the angles is more than half a circle, go\r\n    // the other way because it'll be shorter.\r\n    const offset = Math.abs(targetAngle - position.rotation);\r\n    if (offset > Math.PI) {\r\n      direction = 0 - direction;\r\n    }\r\n\r\n    // Work out the desired delta-rotation to steer toward target\r\n    const targetDr = direction * Math.min(steering.radPerSec, offset / timeDelta);\r\n\r\n    // Calculate the delta-rotation impulse required to meet the goal,\r\n    // but constrain to the capability of the steering thrusters\r\n    let impulseDr = (targetDr - motion.drotation);\r\n    if (Math.abs(impulseDr) > steering.radPerSec) {\r\n      if (impulseDr > 0) {\r\n        impulseDr = steering.radPerSec;\r\n      } else if (impulseDr < 0) {\r\n        impulseDr = 0 - steering.radPerSec;\r\n      }\r\n    }\r\n\r\n    motion.drotation += impulseDr;\r\n  }\r\n\r\n}\r\n\r\nregisterSystem('PlayerInputSteering', PlayerInputSteeringSystem);\r\n"],"names":["registerComponent","componentName","componentManager","getComponent","componentRegistry","registerSystem","systemName","system","getSystem","systemRegistry","Vector2D","x","y","MemoryStats","msMin","msMax","container","document","createElement","id","style","cssText","msDiv","appendChild","msText","innerHTML","msGraph","children","length","bar","updateGraph","dom","height","color","child","firstChild","backgroundColor","window","performance","memory","usedJSHeapSize","totalJSHeapSize","console","warn","lastTime","Date","now","lastUsedHeap","domElement","update","bytesToSize","bytes","nFractDigit","sizes","undefined","precision","Math","pow","i","floor","log","round","delta","ms","min","max","textContent","normValue","registerSprite","name","sprite","getSprite","spriteRegistry","QuadTree","left","top","width","maxObjects","maxLevels","level","root","bounds","objects","nodes","_empty","this","entityMap","reset","spawnAsteroid","dx","dy","dr","mass","health","insert","size","drotation","deltaV","random","maxV","targetName","radPerSec","spawnField","centerX","centerY","radius","MAX_ASTEROIDS","MAX_TRIES","MIN_SIZE","MAX_SIZE","MAX_GRAV","vCenter","vSpawn","vGrav","inField","idx","c","rot","PI","setValues","rotateAround","isClear","fldIdx","item","abs","push","rotate","TARGET_FPS","TARGET_DURATION","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","fn","entityId","systemAttrs","systemCls","timeNow","timeDelta","componentAttrs","matches","handler","Messages","World","options","isRunning","isPaused","debug","systems","addSystems","store","subscribers","tickDuration","maxTickDelta","tickAccumulator","lastTickTime","lastDrawTime","boundTickLoop","_this","tickLoop","boundDrawLoop","timestamp","drawLoop","initialize","lastEntityId","msg","data","systemsData","setWorld","timeDeltaMS","updateStart","updateEnd","tick","drawStart","draw","drawEnd","out","items","generateEntityId","addComponent","world","publish","ENTITY_INSERT","ENTITY_DESTROY","removeComponent","component","create","Component","attrs","defaults","System","defaultOptions","get","matchComponent","getMatchingComponents","updateComponent","viewportSystem","viewportSystemName","gDebug","PIXI","Graphics","stage","addChild","position","clear","visible","cloneFrom","object","fromArray","array","zero","prototype","add","vector","addScalar","val","eq","subtract","clone","set","_at_x","_at_y","dist","sqrt","normalise","normalize","isZero","m","magnitude","reverse","toArray","angle","atan2","cos","sin","angleTo","point","multiplyScalar","multiply","divide","divideScalar","dot","Stats","l","g","n","Infinity","o","h","p","q","r","s","f","addEventListener","b","preventDefault","t","a","j","d","k","e","display","REVISION","setMode","begin","end","module","DrawStats","drawStats","body","tickStats","Core","MemoryStatsSystem","stats","dat","gui","utils","controllers","css","load","url","doc","link","type","rel","href","getElementsByTagName","inject","injected","common","ARR_EACH","Array","forEach","ARR_SLICE","slice","BREAK","extend","target","each","call","arguments","obj","key","isUndefined","compose","toCall","args","apply","itr","scope","defer","fnc","setTimeout","isNull","isNaN","isArray","constructor","isObject","Object","isNumber","isString","isBoolean","isFunction","toString","Controller","property","initialValue","__onChange","__onFinishChange","onChange","onFinishChange","setValue","newValue","updateDisplay","getValue","isModified","cssValueToPixels","match","CSS_VALUE_PIXELS","parseFloat","EVENT_MAP","HTMLEvents","MouseEvents","KeyboardEvents","EVENT_MAP_INV","v","makeSelectable","elem","selectable","onselectstart","MozUserSelect","KhtmlUserSelect","unselectable","makeFullscreen","horizontal","vertical","right","bottom","fakeEvent","eventType","params","aux","className","Error","evt","createEvent","clientX","clientY","initMouseEvent","bubbles","cancelable","clickCount","init","initKeyboardEvent","initKeyEvent","ctrlKey","altKey","shiftKey","metaKey","keyCode","charCode","initEvent","dispatchEvent","bind","event","func","bool","attachEvent","unbind","removeEventListener","detachEvent","addClass","classes","split","indexOf","join","replace","removeClass","removeAttribute","index","splice","hasClass","RegExp","test","getWidth","getComputedStyle","getHeight","getOffset","offset","offsetParent","offsetLeft","offsetTop","isActive","activeElement","OptionController","superclass","__select","map","element","value","opt","setAttribute","desiredValue","selectedIndex","toReturn","NumberController","numDecimals","__min","__max","__step","step","__impliedStep","LN10","__precision","NumberControllerBox","roundToDecimal","decimals","tenTo","attempted","__input","onBlur","onMouseDown","onMouseDrag","onMouseUp","prev_y","diff","__truncationSuspended","blur","NumberControllerSlider","styleSheet","i1","i2","o1","o2","__background","__foreground","useDefaultStyles","pct","FunctionController","text","__button","fire","BooleanController","__prev","__checkbox","checked","hex","interpret","result","original","INTERPRETATIONS","family","litmus","conversions","conversion","conversionName","read","THREE_CHAR_HEX","space","parseInt","write","SIX_CHAR_HEX","CSS_RGB","CSS_RGBA","HEX","RGB_ARRAY","RGBA_ARRAY","RGBA_OBJ","RGB_OBJ","HSVA_OBJ","HSV_OBJ","GUI","saveDialogueContents","controllerFactory","ColorController","CenteredDiv","controller","factoryArgs","concat","before","__li","recallSavedValue","li","addRow","CLASS_CONTROLLER_ROW","augmentController","__controllers","liBefore","__ul","insertBefore","onResize","__gui","remove","nextElementSibling","firstElementChild","listen","box","method","pc","pb","returned","stopPropagation","borderLeftColor","__color","getRoot","__preset_select","markPresetModified","matched_index","__rememberedObjects","controller_map","__rememberedObjectIndecesToControllers","remembered","preset","preset_map","DEFAULT_DEFAULT_PRESET_NAME","getLocalStorageHash","location","addSaveMenu","showHideExplain","explain","useLocalStorage","div","__save_row","gears","button","button2","button3","select","addPresetOption","SUPPORTS_LOCAL_STORAGE","saveLocally","getElementById","localStorageCheckBox","localStorage","getItem","newConstructorTextArea","which","SAVE_DIALOGUE","hide","JSON","stringify","getSaveObject","show","focus","save","presetName","prompt","saveAs","revert","addResizeHandle","dragStart","pmouseX","__closeButton","CLASS_DRAG","drag","dragStop","__resize_handle","marginLeft","cursor","setWidth","w","autoPlace","getCurrentPreset","useInitialValues","saved_values","setSelected","setPresetSelectIndex","modified","updateDisplays","controllerArray","auto_place_container","CSS_NAMESPACE","HIDE_KEY_CODE","CLOSE_BUTTON_HEIGHT","auto_place_virgin","hideable_guis","saveToLocalStorage","setItem","resetWidth","__folders","__listening","DEFAULT_WIDTH","resizable","hideable","parent","scrollable","use_local_storage","defineProperties","title_row_name","closed","CLASS_CLOSED","TEXT_OPEN","TEXT_CLOSED","CLASS_MAIN","saved_gui","parse","CLASS_CLOSE_BUTTON","createTextNode","title_row","on_click_title","CLASS_AUTO_PLACE_CONTAINER","CLASS_AUTO_PLACE","toggleHide","zIndex","opacity","CLASS_TOO_TALL","addColor","removeChild","destroy","addFolder","new_gui_params","folders","open","close","childNodes","node","innerHeight","offsetHeight","remember","folder","factory","StringController","Color","linearGradient","background","vendors","vendor","hueGradient","fieldDown","setSV","unbindSV","__state","toOriginal","unbindH","setH","__saturation_field","scrollLeft","scrollTop","__hue_field","__temp","__selector","__field_knob","__field_knob_border","__hue_knob","__input_textShadow","value_field","padding","boxShadow","border","borderRadius","borderRight","marginRight","outline","textAlign","fontWeight","textShadow","mismatch","COMPONENTS","flip","_flip","marginTop","math","defineRGBComponent","componentHexIndex","defineProperty","recalculateRGB","defineHSVComponent","recalculateHSV","component_from_hex","hsv_to_rgb","rgb_to_hsv","rgb_to_hex","tmpComponent","hi","NaN","hex_with_component","componentIndex","callback","backgroundElement","WebkitTransition","webkitTransform","layout","innerWidth","require$$1","require$$0","DatGui","PI2","wheelDistance","wheelDelta","detail","ViewportPixi","querySelector","renderer","autoDetectRenderer","offsetWidth","antialias","autoResize","canvas","view","Container","backdrop","graphics","events","ev","updateMetrics","onMouseMove","boundOnMouseWheel","_this2","onMouseWheel","followEnabled","zoom","followEntityId","gridEnabled","lineWidth","cursorRawX","cursorRawY","cursorChanged","cursorPosition","cameraX","cameraY","debugDummySprite","zoomWheelFactor","zoomMin","zoomMax","setCursor","newX","newY","visibleWidth","visibleHeight","visibleLeft","visibleTop","visibleRight","visibleBottom","sprites","toRemove","keys","filter","_this3","toAdd","followEntity","drawBackdrop","drawSprite","setTransform","resize","render","ctx","spriteFn","rotation","scale","lineStyle","drawn","followName","findEntityByName","gridSize","gridOffsetX","gridOffsetY","gridColor","moveTo","lineTo","CanvasSprite","arc","lineColor","NUM_POINTS","MAX_RADIUS","MIN_RADIUS","ROTATION","points","drawPolygon","legs","even","shakeDist","Name","names","nid","nameComponent","Health","current","show_bar","subWidth","subHeight","getIndex","oldNode","objectIndex","rect","midX","midY","source","iteratorFn","optionalParam","iterate","Position","positions","PositionSystem","quadtree","quadtreeObjectsPerNode","quadtreeMaxLevels","updateBounds","resetQuadtree","halfWidth","halfHeight","getDebugGraphics","drawCircle","drawDebugQuadtreeNode","drawRect","Motion","MotionSystem","motion","pos","Thruster","ThrusterSystem","vInertia","vThrust","vBrakes","thruster","active","tickDeltaV","stop","useBrakes","currV","overV","brakingDv","Seeker","SeekerSystem","vSeeker","vTarget","seeker","targetEntityId","acquisitionDelay","targetPosition","targetAngle","direction","targetDr","impulseDr","Collidable","entityId2","aCollidable","bCollidable","radii","CollisionSystem","positionSystem","positionSystemName","retrieveBounds","checkCollisionBound","neighbor","checkCollision","inCollision","inCollisionWith","bPosition","aPosition","collidables","collidable","BounceComponent","BounceSystem","dn","dt","mt","v1","v2","v1n","v1t","v2n","v2t","entities","pairs","aEntityId","bEntityId","pair","sort","aBouncer","bBouncer","resolveElasticCollision","aSprite","aMotion","bSprite","bMotion","m1","m2","M","aFactor","bFactor","PlayerInputSteering","PlayerInputSteeringSystem","gamepad","pointer","touch","subscribe","setPointer","windowEvents","handleKeyDown","handleKeyUp","updateGamepads","updateKeyboard","steering","updateComponentFromKeyboard","updateComponentFromPointer","updateComponentFromGamepad","updateMotionFromTargetAngle","axis1","axis0","dleft","button13","dright","button14","dup","button11","gamepads","navigator","getGamepads","gp","connected","buttons","_this4","pressed","axes","axisX","axisY","gamepadDeadzone","ddown","button12","targetAngleRaw","num","start","vpSystem","guiSystem","cp"],"mappings":"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"}