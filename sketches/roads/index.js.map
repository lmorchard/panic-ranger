{"version":3,"sources":["webpack:///./src/sketches/roads.js"],"names":["debug","world","window","systems","ViewportWebGL","container","zoom","gridEnabled","lineWidth","DebugCanvas","viewportSystemName","DrawStats","DatGui","PlayerInputSteering","Health","Motion","Position","Thruster","Seeker","Repulsor","Collision","Bounce","Spawn","RoadRunner","astarCacheTTL","destinations","placeRepulsor","x","y","horiz","markDestination","id","insert","Name","name","Sprite","color","size","Math","random","range","force","Road","type","push","spacing","num","spawnSelfDrivingBus","spawnPoint","floor","length","get","destination","distance","tombstone","spawn","entityId","drotation","PI","ttl","Collidable","rotation","deltaV","maxV","thrusterTurnCutoff","thrusterTurnThrottle","radPerSec","active","Runner","i","setTimeout","subscribe","msg","publish","start","vpSystem","getSystem","roadRunnerSystem","guiSystem","gui","generalf","addFolder","add","open","vpf","names","forEach","listen","options","zoomMin","zoomMax","step","rrf"],"mappings":"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","file":"sketches/roads/index.js","sourcesContent":["import * as Core from '../lib/core';\nimport { distance } from '../lib/utils';\n\nimport '../plugins/drawStats';\nimport '../plugins/memoryStats';\nimport '../plugins/datGui';\nimport '../plugins/debugCanvas';\nimport '../plugins/viewportWebGL';\nimport '../plugins/name';\nimport '../plugins/health';\nimport '../plugins/position';\nimport '../plugins/motion';\nimport '../plugins/thruster';\nimport '../plugins/seeker';\nimport '../plugins/collision';\nimport '../plugins/bounce';\nimport '../plugins/repulsor';\nimport '../plugins/playerInputSteering';\nimport '../plugins/hordeSpawn';\nimport { MSG_DESTROY } from '../plugins/spawn';\nimport { MSG_DESTINATION_REACHED } from '../plugins/roadRunner';\n\nconst debug = false;\n\nconst world = window.world = new Core.World({\n  systems: {\n    ViewportWebGL: {\n      debug: debug,\n      container: '#game',\n      zoom: 0.125,\n      gridEnabled: false,\n      lineWidth: 2.0\n    },\n    DebugCanvas: {\n      container: '#game',\n      viewportSystemName: 'ViewportWebGL',\n    },\n    DrawStats: {},\n    DatGui: {},\n    PlayerInputSteering: {},\n    Health: {},\n    Motion: {},\n    Position: {},\n    Thruster: {},\n    Seeker: {},\n    Repulsor: {},\n    Collision: {},\n    Bounce: {},\n    Spawn: {},\n    RoadRunner: {\n      astarCacheTTL: 2.0\n    },\n  }\n});\n\nconst destinations = [];\n\nconst placeRepulsor = (x, y, horiz, markDestination) => {\n  const id = world.insert({\n    Name: { name: `repulsor${y}` },\n    Sprite: { name: 'repulsor', color: 0x114411, size: 100 },\n    Position: {\n      x: x + (horiz ? 0 : Math.random() * 200 - 100),\n      y: y + (!horiz ? 0 : Math.random() * 200 - 100)\n    },\n    Motion: { },\n    Repulsor: { range: 600, force: 300 },\n    Road: { type: 'repulsor', range: 800 }\n  });\n  if (markDestination) { destinations.push(id); }\n};\n\nlet x = 0;\nlet y = 0;\nconst spacing = 600;\nconst num = 4;\nfor (x = -num * spacing; x <= num * spacing; x += spacing) {\n  placeRepulsor(x, -(spacing * num), true, true);\n  placeRepulsor(x, 0, true, true);\n  placeRepulsor(x, (spacing * num), true, true);\n}\nfor (y = -(num-1) * spacing; y <= num * spacing; y += spacing) {\n  //placeRepulsor(-(spacing * num), y, false);\n  placeRepulsor(0, y, true, false);\n  //placeRepulsor((spacing * num), y, false);\n}\n\nfunction spawnSelfDrivingBus() {\n  const color = 0xffffff * Math.random();\n  const spawnPoint = destinations[Math.floor(Math.random() * destinations.length)];\n\n  const {x, y} = world.get('Position', spawnPoint);\n\n  let destination;\n  do {\n    destination = destinations[Math.floor(Math.random() * destinations.length)];\n  } while (distance({x, y}, world.get('Position', destination)) < 3000);\n\n  return world.insert({\n    Name: { name: `bus${Math.random()}` },\n    Sprite: { name: 'hero', size: 150, color },\n    Spawn: {\n      tombstone: (spawn, entityId) => ({\n        Name: world.get('Name', entityId),\n        Sprite: { name: 'hero', size: 150, color },\n        Position: world.get('Position', entityId),\n        Motion: { drotation: Math.PI * 8 },\n        Spawn: { ttl: 0.5 }\n      })\n    },\n    Collidable: {},\n    // Bounce: { mass: 7000 },\n    Position: {\n      x, y,\n      rotation: Math.PI * 2 * Math.random()\n    },\n    Motion: {},\n    Thruster: { deltaV: 5000, maxV: 1250 },\n    Seeker: {\n      thrusterTurnCutoff: Math.PI * 0.01,\n      thrusterTurnThrottle: 0.01,\n      radPerSec: Math.PI * 4,\n      active: false\n    },\n    Runner: { destination: '' + destination },\n  });\n}\n\n// Spawn some initial entities\nfor (let i = 0; i < 50; i++) {\n  setTimeout(spawnSelfDrivingBus, 5000 * Math.random());\n}\n\n// Spawn new entities when old ones reach their destinations\nworld.subscribe(MSG_DESTINATION_REACHED, (msg, entityId) => {\n  world.publish(MSG_DESTROY, entityId);\n  setTimeout(spawnSelfDrivingBus, 1000 * Math.random());\n});\n\nworld.debug = debug;\n\nworld.start();\n\nconst vpSystem = world.getSystem('ViewportWebGL');\nconst roadRunnerSystem = world.getSystem('RoadRunner');\nconst guiSystem = world.getSystem('DatGui');\nconst gui = guiSystem.gui;\n\nconst generalf = gui.addFolder('General');\ngeneralf.add(world, 'isPaused');\ngeneralf.add(world, 'debug');\ngeneralf.open();\n\nconst vpf = gui.addFolder('Viewport');\nconst names = [ 'gridEnabled', 'followEnabled', 'cameraX', 'cameraY' ];\nnames.forEach(name => vpf.add(vpSystem, name).listen());\nvpf.add(vpSystem, 'zoom',\n  vpSystem.options.zoomMin, vpSystem.options.zoomMax).listen();\nvpf.add(vpSystem, 'lineWidth', 1.0, 4.0).step(0.5).listen();\nvpf.add(vpSystem, 'spriteCount').listen();\nvpf.add(vpSystem, 'lastVertexCount').listen();\nvpf.add(vpSystem, 'actualBufferSize').listen();\nvpf.add(vpSystem, 'calculatedBufferSize').listen();\n\nconst rrf = gui.addFolder('RoadRunner');\n['debug', 'debugRange', 'debugRoads', 'debugPath']\n  .forEach(name => rrf.add(roadRunnerSystem.options, name));\nrrf.open();\n\n\n\n// WEBPACK FOOTER //\n// ./src/sketches/roads.js"],"sourceRoot":""}