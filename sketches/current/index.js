!function(){"use strict";function t(t,e){L[t]=e}function e(t){return L[t]}function i(t,e){j[t]=e}function n(t){return j[t]}function o(t,e){this.x=t||0,this.y=e||0}function s(t,e){return e={exports:{}},t(e,e.exports),e.exports}function r(){var t=100,e=0,i=document.createElement("div");i.id="stats",i.style.cssText="width:80px;opacity:0.9;cursor:pointer";var n=document.createElement("div");n.id="ms",n.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;",i.appendChild(n);var o=document.createElement("div");o.id="msText",o.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",o.innerHTML="Memory",n.appendChild(o);var s=document.createElement("div");for(s.id="msGraph",s.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",n.appendChild(s);s.children.length<74;){var r=document.createElement("span");r.style.cssText="width:1px;height:30px;float:left;background-color:#131",s.appendChild(r)}var a=function(t,e,i){var n=t.appendChild(t.firstChild);n.style.height=e+"px",i&&(n.style.backgroundColor=i)};window.performance&&!performance.memory&&(performance.memory={usedJSHeapSize:0}),0===performance.memory.totalJSHeapSize&&console.warn("totalJSHeapSize === 0... performance.memory is only available in Chrome .");var l=Date.now(),u=performance.memory.usedJSHeapSize;return{domElement:i,update:function(){function i(t,e){var i=["Bytes","KB","MB","GB","TB"];if(0==t)return"n/a";e=void 0!==e?e:0;var n=Math.pow(10,e),o=Math.floor(Math.log(t)/Math.log(1024));return Math.round(t*n/Math.pow(1024,o))/n+" "+i[o]}if(!(Date.now()-l<1e3/30)){l=Date.now();var n=performance.memory.usedJSHeapSize-u;u=performance.memory.usedJSHeapSize;var r=n<0?"#830":"#131",h=performance.memory.usedJSHeapSize;t=Math.min(t,h),e=Math.max(e,h),o.textContent="Mem: "+i(h,2);var d=h/31457280,c=30*(1-d%1);a(s,c,r)}}}}function a(t,e){$[t]=e}function l(t){return $[t]}function u(t,e,i,n,o,s,r,a){this.maxObjects=10,this.maxLevels=4,this.level=0,this.bounds={},this.objects=[],this.nodes=[],this._empty=[],this.root=a||this,this.entityMap={},this.reset(t,e,i,n,o,s,r)}function h(t,e,i,n,o,s,r,a,l){qt.insert({Sprite:{name:"mine",size:i},Health:{max:l},Collidable:{},Bounce:{mass:a},Position:{x:t,y:e},Motion:{dx:o,dy:s,drotation:r},Thruster:{deltaV:600+100*Math.random(),maxV:300+200*Math.random()},Seeker:{targetName:"hero1",radPerSec:.5+.2*Math.random()}})}function d(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:150,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:100,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:300,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:10,u=new o(e,t),d=new o(0,0),c=new o(0,0),p=[],f=0;f<n;f++)for(var m=0;m<s;m++){var _=(a-r)*Math.random()+r,g=4*Math.PI*Math.random();d.setValues(u.x,u.y-((i-1)*Math.random()+1)),d.rotateAround(u,g);for(var v=!0,b=0;b<p.length;b++){var y=p[b];if(!(2*Math.abs(d.x-y.x)>=1.025*(_+y.width)||2*Math.abs(d.y-y.y)>=1.025*(_+y.height))){v=!1;break}}v&&(p.push({x:d.x,y:d.y,width:_,height:_}),c.setValues(0,Math.random()*l),c.rotate(g),h(d.x,d.y,_,_,c.x,c.y,2*Math.PI*Math.random(),4*_*_,4*_*_))}}var c=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},p=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),f=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},m=function t(e,i,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);if(void 0===o){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},_=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},g=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},v=60,b=1e3/v,y=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},w=void 0,x=void 0,k=void 0,C=void 0,E=void 0,S=void 0,A=void 0,T=void 0,M=void 0,O=void 0,P=void 0,N=void 0,R=void 0,I={ENTITY_INSERT:"entity_insert",ENTITY_DESTROY:"entity_destroy"},D=function(){function t(e){var i=this;c(this,t),e=e||{},this.isRunning=!1,this.isPaused=!1,this.debug=!1,this.systems={},e.systems&&this.addSystems(e.systems),this.store={},this.subscribers={},this.tickDuration=b,this.maxTickDelta=5*b,this.tickAccumulator=0,this.lastTickTime=0,this.lastDrawTime=0,this.boundTickLoop=function(){return i.tickLoop()},this.boundDrawLoop=function(t){return i.drawLoop(t)},this.reset()}return p(t,[{key:"start",value:function(){if(!this.isRunning){this.isRunning=!0;for(var t in this.systems)this.systems[t].initialize();return this.lastTickTime=Date.now(),this.lastDrawTime=0,setTimeout(this.boundTickLoop,this.tickDuration),y(this.boundDrawLoop),this}}},{key:"stop",value:function(){return this.isRunning=!1,this}},{key:"pause",value:function(){return this.isPaused=!0,this}},{key:"resume",value:function(){return this.isPaused=!1,this}},{key:"reset",value:function(){this.store={},this.lastEntityId=0}},{key:"subscribe",value:function(t,e){return this.subscribers[t]||(this.subscribers[t]=[]),this.subscribers[t].push(e),this}},{key:"unsubscribe",value:function(){return this}},{key:"publish",value:function(t,e){if(this.subscribers[t]){for(P=0,R;R=this.subscribers[t][P];P++)R(t,e);return this}}},{key:"addSystems",value:function(t){for(k in t)C=t[k],E=n(k),x=new E(C),x.setWorld(this),this.systems[k]=x}},{key:"getSystem",value:function(t){return this.systems[t]}},{key:"tick",value:function(t){T=t/1e3;for(k in this.systems)this.systems[k].updateStart(T);for(k in this.systems)this.systems[k].update(T);for(k in this.systems)this.systems[k].updateEnd(T)}},{key:"tickLoop",value:function(){if(A=Date.now(),T=Math.min(A-this.lastTickTime,this.maxTickDelta),this.lastTickTime=A,!this.isPaused)for(this.tickAccumulator+=T;this.tickAccumulator>this.tickDuration;)this.tick(this.tickDuration),this.tickAccumulator-=this.tickDuration;this.isRunning&&setTimeout(this.boundTickLoop,this.tickDuration)}},{key:"draw",value:function(t){T=t/1e3;for(k in this.systems)this.systems[k].drawStart(T);for(k in this.systems)this.systems[k].draw(T);for(k in this.systems)this.systems[k].drawEnd(T)}},{key:"drawLoop",value:function(t){this.lastDrawTime||(this.lastDrawTime=t),T=t-this.lastDrawTime,this.lastDrawTime=t,this.isPaused||this.draw(T),this.isRunning&&y(this.boundDrawLoop)}},{key:"generateEntityId",value:function(){return++this.lastEntityId}},{key:"insert",value:function(){for(var t=[],e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];for(P=0;N=i[P];P++){w=this.generateEntityId();for(S in N)M=N[S],this.addComponent(w,S,M);this.world&&this.world.publish(I.ENTITY_INSERT,w),t.push(w)}return t.length>1?t:t[0]}},{key:"destroy",value:function(t){this.world&&this.world.publish(I.ENTITY_DESTROY,t);for(S in this.store)this.removeComponent(t,S)}},{key:"addComponent",value:function(t,i,n){var o=e(i),s=o.create(n);this.store[i]||(this.store[i]={}),this.store[i][t]=s}},{key:"removeComponent",value:function(t,e){t in this.store[e]&&delete this.store[e][t]}},{key:"hasComponent",value:function(t,e){return e in this.store&&t in this.store[e]}},{key:"get",value:function(t,e){return this.store[t]?e?this.store[t][e]:this.store[t]:null}}]),t}(),B=function(){function t(){c(this,t)}return p(t,null,[{key:"defaults",value:function(){return{}}},{key:"create",value:function(t){return f({},this.defaults(),t||{})}}]),t}(),z=function(){function t(e){c(this,t),this.options=f({},this.defaultOptions(),e||{}),this.debug=this.options.debug||!1}return p(t,[{key:"defaultOptions",value:function(){return{}}},{key:"setWorld",value:function(t){this.world=t}},{key:"matchComponent",value:function(){return""}},{key:"initialize",value:function(){}},{key:"getMatchingComponents",value:function(){return this.world.get(this.matchComponent())}},{key:"updateStart",value:function(){}},{key:"update",value:function(t){O=this.getMatchingComponents();for(w in O)this.updateComponent(t,w,O[w])}},{key:"updateComponent",value:function(){}},{key:"updateEnd",value:function(){}},{key:"drawStart",value:function(){}},{key:"draw",value:function(){}},{key:"getDebugGraphics",value:function(){return this.world.debug?(this.viewportSystem||(this.viewportSystem=this.world.getSystem(this.options.viewportSystemName||"ViewportPixi"),this.gDebug=new PIXI.Graphics,this.viewportSystem.stage.addChild(this.gDebug),this.gDebug.position.x=0,this.gDebug.position.y=0),this.gDebug.clear(),this.gDebug.visible=!0,this.gDebug):void(this.gDebug&&(this.gDebug.visible=!1))}},{key:"drawEnd",value:function(){}}]),t}(),L={},j={};o.cloneFrom=function(t){return new o(t.x,t.y)},o.fromArray=function(t){return new o(t[0],t[1])},o.zero=new o(0,0),o.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},o.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},o.prototype.eq=function(t){return t.x===this.x&&t.y===this.y},o.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},o.prototype.clone=function(){return new o(this.x,this.y)},o.prototype.set=function(t){return this.x=t.x,this.y=t.y,this},o.prototype.setValues=function(t,e){return this.x=t,this.y=e,this},o.prototype.dist=function(t){return Math.sqrt((t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y))},o.prototype.normalise=function(){return this.normalize()},o.prototype.normalize=function(){if(!this.isZero()){var t=this.magnitude();this.x/=t,this.y/=t}return this},o.prototype.isZero=function(){return 0===this.x&&0===this.y},o.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},o.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},o.prototype.toArray=function(){return[this.x,this.y]},o.prototype.angle=function(){return Math.atan2(this.y,this.x)},o.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t);return this.setValues(this.x*e-this.y*i,this.x*i+this.y*e)},o.prototype.angleTo=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},o.prototype.rotateAround=function(t,e){return this.subtract(t).rotate(e).add(t)},o.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},o.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},o.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},o.prototype.divideScalar=function(t){return this.x/=t,this.y/=t,this},o.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},o.prototype.dot=function(t){return this.x*t.x+this.y*t.y};var H=s(function(t){var e=function(){var t=Date.now(),e=t,i=0,n=1/0,o=0,s=0,r=1/0,a=0,l=0,u=0,h=document.createElement("div");h.id="stats",h.addEventListener("mousedown",function(t){t.preventDefault(),v(++u%2)},!1),h.style.cssText="width:80px;opacity:0.9;cursor:pointer";var d=document.createElement("div");d.id="fps",d.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",h.appendChild(d);var c=document.createElement("div");c.id="fpsText",c.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",c.innerHTML="FPS",d.appendChild(c);var p=document.createElement("div");for(p.id="fpsGraph",p.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",d.appendChild(p);74>p.children.length;){var f=document.createElement("span");f.style.cssText="width:1px;height:30px;float:left;background-color:#113",p.appendChild(f)}var m=document.createElement("div");m.id="ms",m.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",h.appendChild(m);var _=document.createElement("div");_.id="msText",_.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",_.innerHTML="MS",m.appendChild(_);var g=document.createElement("div");for(g.id="msGraph",g.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",m.appendChild(g);74>g.children.length;)f=document.createElement("span"),f.style.cssText="width:1px;height:30px;float:left;background-color:#131",g.appendChild(f);var v=function(t){switch(u=t){case 0:d.style.display="block",m.style.display="none";break;case 1:d.style.display="none",m.style.display="block"}};return{REVISION:12,domElement:h,setMode:v,begin:function(){t=Date.now()},end:function(){var u=Date.now();i=u-t,n=Math.min(n,i),o=Math.max(o,i),_.textContent=i+" MS ("+n+"-"+o+")";var h=Math.min(30,30-30*(i/200));return g.appendChild(g.firstChild).style.height=h+"px",l++,u>e+1e3&&(s=Math.round(1e3*l/(u-e)),r=Math.min(r,s),a=Math.max(a,s),c.textContent=s+" FPS ("+r+"-"+a+")",h=Math.min(30,30-30*(s/100)),p.appendChild(p.firstChild).style.height=h+"px",e=u,l=0),u},update:function(){t=this.end()}}};"object"==typeof t&&(t.exports=e)}),V=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,[{key:"initialize",value:function(){this.drawStats=new H,this.drawStats.setMode(0),this.drawStats.domElement.style.position="absolute",this.drawStats.domElement.style.left="0px",this.drawStats.domElement.style.top="0px",document.body.appendChild(this.drawStats.domElement),this.tickStats=new H,this.tickStats.setMode(0),this.tickStats.domElement.style.position="absolute",this.tickStats.domElement.style.left="0px",this.tickStats.domElement.style.top="55px",document.body.appendChild(this.tickStats.domElement)}},{key:"updateStart",value:function(){this.tickStats.begin()}},{key:"updateEnd",value:function(){this.tickStats.end()}},{key:"drawStart",value:function(){this.drawStats.begin()}},{key:"drawEnd",value:function(){this.drawStats.end()}}]),e}(z);i("DrawStats",V);var F=r,G=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,[{key:"initialize",value:function(){this.stats=new F,this.stats.domElement.style.position="fixed",this.stats.domElement.style.left="85px",this.stats.domElement.style.top="0px",document.body.appendChild(this.stats.domElement)}},{key:"draw",value:function(){this.stats.update()}}]),e}(z);i("MemoryStats",G);var X=s(function(t){var e=t.exports=e||{};e.gui=e.gui||{},e.utils=e.utils||{},e.controllers=e.controllers||{},e.dom=e.dom||{},e.color=e.color||{},e.utils.css=function(){return{load:function(t,e){e=e||document;var i=e.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=t,e.getElementsByTagName("head")[0].appendChild(i)},inject:function(t,e){e=e||document;var i=document.createElement("style");i.type="text/css",i.innerHTML=t,e.getElementsByTagName("head")[0].appendChild(i)}}}(),e.utils.common=function(){var t=Array.prototype.forEach,e=Array.prototype.slice;return{BREAK:{},extend:function(t){return this.each(e.call(arguments,1),function(e){for(var i in e)this.isUndefined(e[i])||(t[i]=e[i])},this),t},defaults:function(t){return this.each(e.call(arguments,1),function(e){for(var i in e)this.isUndefined(t[i])&&(t[i]=e[i])},this),t},compose:function(){var t=e.call(arguments);return function(){for(var i=e.call(arguments),n=t.length-1;n>=0;n--)i=[t[n].apply(this,i)];return i[0]}},each:function(e,i,n){if(t&&e.forEach===t)e.forEach(i,n);else if(e.length===e.length+0){for(var o=0,s=e.length;o<s;o++)if(o in e&&i.call(n,e[o],o)===this.BREAK)return}else for(var o in e)if(i.call(n,e[o],o)===this.BREAK)return},defer:function(t){setTimeout(t,0)},toArray:function(t){return t.toArray?t.toArray():e.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){return t!==t},isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return t===!1||t===!0},isFunction:function(t){return"[object Function]"===Object.prototype.toString.call(t)}}}(),e.controllers.Controller=function(t){var e=function(t,e){this.initialValue=t[e],this.domElement=document.createElement("div"),this.object=t,this.property=e,this.__onChange=void 0,this.__onFinishChange=void 0};return t.extend(e.prototype,{onChange:function(t){return this.__onChange=t,this},onFinishChange:function(t){return this.__onFinishChange=t,this},setValue:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}}),e}(e.utils.common),e.dom.dom=function(t){function e(e){if("0"===e||t.isUndefined(e))return 0;var i=e.match(o);return t.isNull(i)?0:parseFloat(i[1])}var i={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},n={};t.each(i,function(e,i){t.each(e,function(t){n[t]=i})});var o=/(\d+(\.\d+)?)px/,s={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(e,i,n){t.isUndefined(i)&&(i=!0),t.isUndefined(n)&&(n=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),n&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,i,o,s){o=o||{};var r=n[i];if(!r)throw new Error("Event type "+i+" not supported.");var a=document.createEvent(r);switch(r){case"MouseEvents":var l=o.x||o.clientX||0,u=o.y||o.clientY||0;a.initMouseEvent(i,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,l,u,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var h=a.initKeyboardEvent||a.initKeyEvent;t.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),h(i,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break;default:a.initEvent(i,o.bubbles||!1,o.cancelable||!0)}t.defaults(a,s),e.dispatchEvent(a)},bind:function(t,e,i,n){return n=n||!1,t.addEventListener?t.addEventListener(e,i,n):t.attachEvent&&t.attachEvent("on"+e,i),s},unbind:function(t,e,i,n){return n=n||!1,t.removeEventListener?t.removeEventListener(e,i,n):t.detachEvent&&t.detachEvent("on"+e,i),s},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var i=t.className.split(/ +/);i.indexOf(e)==-1&&(i.push(e),t.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return s},removeClass:function(t,e){if(e)if(void 0===t.className);else if(t.className===e)t.removeAttribute("class");else{var i=t.className.split(/ +/),n=i.indexOf(e);n!=-1&&(i.splice(n,1),t.className=i.join(" "))}else t.className=void 0;return s},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var i=getComputedStyle(t);return e(i["border-left-width"])+e(i["border-right-width"])+e(i["padding-left"])+e(i["padding-right"])+e(i.width)},getHeight:function(t){var i=getComputedStyle(t);return e(i["border-top-width"])+e(i["border-bottom-width"])+e(i["padding-top"])+e(i["padding-bottom"])+e(i.height)},getOffset:function(t){var e={left:0,top:0};if(t.offsetParent)do e.left+=t.offsetLeft,e.top+=t.offsetTop;while(t=t.offsetParent);return e},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}};return s}(e.utils.common),e.controllers.OptionController=function(t,e,i){var n=function(t,o,s){n.superclass.call(this,t,o);var r=this;if(this.__select=document.createElement("select"),i.isArray(s)){var a={};i.each(s,function(t){a[t]=t}),s=a}i.each(s,function(t,e){var i=document.createElement("option");i.innerHTML=e,i.setAttribute("value",t),r.__select.appendChild(i)}),this.updateDisplay(),e.bind(this.__select,"change",function(){var t=this.options[this.selectedIndex].value;r.setValue(t)}),this.domElement.appendChild(this.__select)};return n.superclass=t,i.extend(n.prototype,t.prototype,{setValue:function(t){var e=n.superclass.prototype.setValue.call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e},updateDisplay:function(){return this.__select.value=this.getValue(),n.superclass.prototype.updateDisplay.call(this)}}),n}(e.controllers.Controller,e.dom.dom,e.utils.common),e.controllers.NumberController=function(t,e){function i(t){return t=t.toString(),t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var n=function(t,o,s){n.superclass.call(this,t,o),s=s||{},this.__min=s.min,this.__max=s.max,this.__step=s.step,e.isUndefined(this.__step)?0==this.initialValue?this.__impliedStep=1:this.__impliedStep=Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__impliedStep=this.__step,this.__precision=i(this.__impliedStep)};return n.superclass=t,e.extend(n.prototype,t.prototype,{setValue:function(t){return void 0!==this.__min&&t<this.__min?t=this.__min:void 0!==this.__max&&t>this.__max&&(t=this.__max),void 0!==this.__step&&t%this.__step!=0&&(t=Math.round(t/this.__step)*this.__step),n.superclass.prototype.setValue.call(this,t)},min:function(t){return this.__min=t,this},max:function(t){return this.__max=t,this},step:function(t){return this.__step=t,this}}),n}(e.controllers.Controller,e.utils.common),e.controllers.NumberControllerBox=function(t,e,i){function n(t,e){var i=Math.pow(10,e);return Math.round(t*i)/i}var o=function(t,n,s){function r(){var t=parseFloat(c.__input.value);i.isNaN(t)||c.setValue(t)}function a(){r(),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}function l(t){e.bind(window,"mousemove",u),e.bind(window,"mouseup",h),d=t.clientY}function u(t){var e=d-t.clientY;c.setValue(c.getValue()+e*c.__impliedStep),d=t.clientY}function h(){e.unbind(window,"mousemove",u),e.unbind(window,"mouseup",h)}this.__truncationSuspended=!1,o.superclass.call(this,t,n,s);var d,c=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),e.bind(this.__input,"change",r),e.bind(this.__input,"blur",a),e.bind(this.__input,"mousedown",l),e.bind(this.__input,"keydown",function(t){13===t.keyCode&&(c.__truncationSuspended=!0,this.blur(),c.__truncationSuspended=!1)}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return o.superclass=t,i.extend(o.prototype,t.prototype,{updateDisplay:function(){return this.__input.value=this.__truncationSuspended?this.getValue():n(this.getValue(),this.__precision),o.superclass.prototype.updateDisplay.call(this)}}),o}(e.controllers.NumberController,e.dom.dom,e.utils.common),e.controllers.NumberControllerSlider=function(t,e,i,n,o){function s(t,e,i,n,o){return n+(o-n)*((t-e)/(i-e))}var r=function(t,i,n,o,a){function l(t){e.bind(window,"mousemove",u),e.bind(window,"mouseup",h),u(t)}function u(t){t.preventDefault();var i=e.getOffset(d.__background),n=e.getWidth(d.__background);return d.setValue(s(t.clientX,i.left,i.left+n,d.__min,d.__max)),!1}function h(){e.unbind(window,"mousemove",u),e.unbind(window,"mouseup",h),d.__onFinishChange&&d.__onFinishChange.call(d,d.getValue())}r.superclass.call(this,t,i,{min:n,max:o,step:a});var d=this;this.__background=document.createElement("div"),this.__foreground=document.createElement("div"),e.bind(this.__background,"mousedown",l),e.addClass(this.__background,"slider"),e.addClass(this.__foreground,"slider-fg"),this.updateDisplay(),this.__background.appendChild(this.__foreground),this.domElement.appendChild(this.__background)};return r.superclass=t,r.useDefaultStyles=function(){i.inject(o)},n.extend(r.prototype,t.prototype,{updateDisplay:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",r.superclass.prototype.updateDisplay.call(this)}}),r}(e.controllers.NumberController,e.dom.dom,e.utils.css,e.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}"),e.controllers.FunctionController=function(t,e,i){var n=function(t,i,o){n.superclass.call(this,t,i);var s=this;this.__button=document.createElement("div"),this.__button.innerHTML=void 0===o?"Fire":o,e.bind(this.__button,"click",function(t){return t.preventDefault(),s.fire(),!1}),e.addClass(this.__button,"button"),this.domElement.appendChild(this.__button)};return n.superclass=t,i.extend(n.prototype,t.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.getValue().call(this.object)}}),n}(e.controllers.Controller,e.dom.dom,e.utils.common),e.controllers.BooleanController=function(t,e,i){var n=function(t,i){function o(){s.setValue(!s.__prev)}n.superclass.call(this,t,i);var s=this;this.__prev=this.getValue(),this.__checkbox=document.createElement("input"),this.__checkbox.setAttribute("type","checkbox"),e.bind(this.__checkbox,"change",o,!1),this.domElement.appendChild(this.__checkbox),this.updateDisplay()};return n.superclass=t,i.extend(n.prototype,t.prototype,{setValue:function(t){var e=n.superclass.prototype.setValue.call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e},updateDisplay:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,n.superclass.prototype.updateDisplay.call(this)}}),n}(e.controllers.Controller,e.dom.dom,e.utils.common),e.color.toString=function(t){return function(e){if(1==e.a||t.isUndefined(e.a)){for(var i=e.hex.toString(16);i.length<6;)i="0"+i;return"#"+i}return"rgba("+Math.round(e.r)+","+Math.round(e.g)+","+Math.round(e.b)+","+e.a+")"}}(e.utils.common),e.color.interpret=function(t,e){var i,n,o=function(){n=!1;var t=arguments.length>1?e.toArray(arguments):arguments[0];return e.each(s,function(o){if(o.litmus(t))return e.each(o.conversions,function(o,s){if(i=o.read(t),n===!1&&i!==!1)return n=i,i.conversionName=s,i.conversion=o,e.BREAK}),e.BREAK}),n},s=[{litmus:e.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString())}},write:t},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString())}},write:t},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:t},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:t}}},{litmus:e.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:e.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3==t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4==t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:e.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(e.isNumber(t.r)&&e.isNumber(t.g)&&e.isNumber(t.b)&&e.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(e.isNumber(t.r)&&e.isNumber(t.g)&&e.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(e.isNumber(t.h)&&e.isNumber(t.s)&&e.isNumber(t.v)&&e.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(e.isNumber(t.h)&&e.isNumber(t.s)&&e.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}];return o}(e.color.toString,e.utils.common),e.GUI=e.gui.GUI=function(t,e,i,n,o,s,r,a,l,u,h,d,c,p,f){function m(t,e,i,s){if(void 0===e[i])throw new Error("Object "+e+' has no property "'+i+'"');var r;if(s.color)r=new h(e,i);else{var a=[e,i].concat(s.factoryArgs);r=n.apply(t,a)}s.before instanceof o&&(s.before=s.before.__li),v(t,r),p.addClass(r.domElement,"c");var l=document.createElement("span");p.addClass(l,"property-name"),l.innerHTML=r.property;var u=document.createElement("div");u.appendChild(l),u.appendChild(r.domElement);var d=_(t,u,s.before);return p.addClass(d,L.CLASS_CONTROLLER_ROW),p.addClass(d,typeof r.getValue()),g(t,d,r),t.__controllers.push(r),r}function _(t,e,i){var n=document.createElement("li");return e&&n.appendChild(e),i?t.__ul.insertBefore(n,params.before):t.__ul.appendChild(n),t.onResize(),n}function g(t,e,i){if(i.__li=e,i.__gui=t,f.extend(i,{options:function(e){return arguments.length>1?(i.remove(),m(t,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[f.toArray(arguments)]})):f.isArray(e)||f.isObject(e)?(i.remove(),m(t,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[e]})):void 0},name:function(t){return i.__li.firstElementChild.firstElementChild.innerHTML=t,i},listen:function(){return i.__gui.listen(i),i},remove:function(){return i.__gui.remove(i),i}}),i instanceof l){var n=new a(i.object,i.property,{min:i.__min,max:i.__max,step:i.__step});f.each(["updateDisplay","onChange","onFinishChange"],function(t){var e=i[t],o=n[t];i[t]=n[t]=function(){var t=Array.prototype.slice.call(arguments);return e.apply(i,t),o.apply(n,t)}}),p.addClass(e,"has-slider"),i.domElement.insertBefore(n.domElement,i.domElement.firstElementChild)}else if(i instanceof a){var o=function(e){return f.isNumber(i.__min)&&f.isNumber(i.__max)?(i.remove(),m(t,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[i.__min,i.__max,i.__step]})):e};i.min=f.compose(o,i.min),i.max=f.compose(o,i.max)}else i instanceof s?(p.bind(e,"click",function(){p.fakeEvent(i.__checkbox,"click")}),p.bind(i.__checkbox,"click",function(t){t.stopPropagation()})):i instanceof r?(p.bind(e,"click",function(){p.fakeEvent(i.__button,"click")}),p.bind(e,"mouseover",function(){p.addClass(i.__button,"hover")}),p.bind(e,"mouseout",function(){p.removeClass(i.__button,"hover")})):i instanceof h&&(p.addClass(e,"color"),i.updateDisplay=f.compose(function(t){return e.style.borderLeftColor=i.__color.toString(),t},i.updateDisplay),i.updateDisplay());i.setValue=f.compose(function(e){return t.getRoot().__preset_select&&i.isModified()&&S(t.getRoot(),!0),e},i.setValue)}function v(t,e){var i=t.getRoot(),n=i.__rememberedObjects.indexOf(e.object);if(n!=-1){var o=i.__rememberedObjectIndecesToControllers[n];if(void 0===o&&(o={},i.__rememberedObjectIndecesToControllers[n]=o),o[e.property]=e,i.load&&i.load.remembered){var s,r=i.load.remembered;if(r[t.preset])s=r[t.preset];else{
if(!r[R])return;s=r[R]}if(s[n]&&void 0!==s[n][e.property]){var a=s[n][e.property];e.initialValue=a,e.setValue(a)}}}}function b(t,e){return document.location.href+"."+e}function y(t){function e(){u.style.display=t.useLocalStorage?"block":"none"}var i=t.__save_row=document.createElement("li");p.addClass(t.domElement,"has-save"),t.__ul.insertBefore(i,t.__ul.firstChild),p.addClass(i,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",p.addClass(n,"button gears");var o=document.createElement("span");o.innerHTML="Save",p.addClass(o,"button"),p.addClass(o,"save");var s=document.createElement("span");s.innerHTML="New",p.addClass(s,"button"),p.addClass(s,"save-as");var r=document.createElement("span");r.innerHTML="Revert",p.addClass(r,"button"),p.addClass(r,"revert");var a=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?f.each(t.load.remembered,function(e,i){C(t,i,i==t.preset)}):C(t,R,!1),p.bind(a,"change",function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value}),i.appendChild(a),i.appendChild(n),i.appendChild(o),i.appendChild(s),i.appendChild(r),I){var l=document.getElementById("dg-save-locally"),u=document.getElementById("dg-local-explain");l.style.display="block";var h=document.getElementById("dg-local-storage");"true"===localStorage.getItem(b(t,"isLocal"))&&h.setAttribute("checked","checked"),e(),p.bind(h,"change",function(){t.useLocalStorage=!t.useLocalStorage,e()})}var d=document.getElementById("dg-new-constructor");p.bind(d,"keydown",function(t){!t.metaKey||67!==t.which&&67!=t.keyCode||T.hide()}),p.bind(n,"click",function(){d.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),T.show(),d.focus(),d.select()}),p.bind(o,"click",function(){t.save()}),p.bind(s,"click",function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)}),p.bind(r,"click",function(){t.revert()})}function w(t){function e(e){return e.preventDefault(),o=e.clientX,p.addClass(t.__closeButton,L.CLASS_DRAG),p.bind(window,"mousemove",i),p.bind(window,"mouseup",n),!1}function i(e){return e.preventDefault(),t.width+=o-e.clientX,t.onResize(),o=e.clientX,!1}function n(){p.removeClass(t.__closeButton,L.CLASS_DRAG),p.unbind(window,"mousemove",i),p.unbind(window,"mouseup",n)}t.__resize_handle=document.createElement("div"),f.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var o;p.bind(t.__resize_handle,"mousedown",e),p.bind(t.__closeButton,"mousedown",e),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function x(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function k(t,e){var i={};return f.each(t.__rememberedObjects,function(n,o){var s={},r=t.__rememberedObjectIndecesToControllers[o];f.each(r,function(t,i){s[i]=e?t.initialValue:t.getValue()}),i[o]=s}),i}function C(t,e,i){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.__preset_select.appendChild(n),i&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function E(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value==t.preset&&(t.__preset_select.selectedIndex=e)}function S(t,e){var i=t.__preset_select[t.__preset_select.selectedIndex];e?i.innerHTML=i.value+"*":i.innerHTML=i.value}function A(t){0!=t.length&&d(function(){A(t)}),f.each(t,function(t){t.updateDisplay()})}t.inject(i);var T,M,O="dg",P=72,N=20,R="Default",I=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}}(),D=!0,B=!1,z=[],L=function(t){function e(){localStorage.setItem(b(n,"gui"),JSON.stringify(n.getSaveObject()))}function i(){var t=n.getRoot();t.width+=1,f.defer(function(){t.width-=1})}var n=this;this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),p.addClass(this.domElement,O),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],t=t||{},t=f.defaults(t,{autoPlace:!0,width:L.DEFAULT_WIDTH}),t=f.defaults(t,{resizable:t.autoPlace,hideable:t.autoPlace}),f.isUndefined(t.load)?t.load={preset:R}:t.preset&&(t.load.preset=t.preset),f.isUndefined(t.parent)&&t.hideable&&z.push(this),t.resizable=f.isUndefined(t.parent)&&t.resizable,t.autoPlace&&f.isUndefined(t.scrollable)&&(t.scrollable=!0);var o=I&&"true"===localStorage.getItem(b(this,"isLocal"));if(Object.defineProperties(this,{parent:{get:function(){return t.parent}},scrollable:{get:function(){return t.scrollable}},autoPlace:{get:function(){return t.autoPlace}},preset:{get:function(){return n.parent?n.getRoot().preset:t.load.preset},set:function(e){n.parent?n.getRoot().preset=e:t.load.preset=e,E(this),n.revert()}},width:{get:function(){return t.width},set:function(e){t.width=e,x(n,e)}},name:{get:function(){return t.name},set:function(e){t.name=e,r&&(r.innerHTML=t.name)}},closed:{get:function(){return t.closed},set:function(e){t.closed=e,t.closed?p.addClass(n.__ul,L.CLASS_CLOSED):p.removeClass(n.__ul,L.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?L.TEXT_OPEN:L.TEXT_CLOSED)}},load:{get:function(){return t.load}},useLocalStorage:{get:function(){return o},set:function(t){I&&(o=t,t?p.bind(window,"unload",e):p.unbind(window,"unload",e),localStorage.setItem(b(n,"isLocal"),t))}}}),f.isUndefined(t.parent)){if(t.closed=!1,p.addClass(this.domElement,L.CLASS_MAIN),p.makeSelectable(this.domElement,!1),I&&o){n.useLocalStorage=!0;var s=localStorage.getItem(b(this,"gui"));s&&(t.load=JSON.parse(s))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=L.TEXT_CLOSED,p.addClass(this.__closeButton,L.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),p.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{void 0===t.closed&&(t.closed=!0);var r=document.createTextNode(t.name);p.addClass(r,"controller-name");var a=_(n,r),l=function(t){return t.preventDefault(),n.closed=!n.closed,!1};p.addClass(this.__ul,L.CLASS_CLOSED),p.addClass(a,"title"),p.bind(a,"click",l),t.closed||(this.closed=!1)}t.autoPlace&&(f.isUndefined(t.parent)&&(D&&(M=document.createElement("div"),p.addClass(M,O),p.addClass(M,L.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(M),D=!1),M.appendChild(this.domElement),p.addClass(this.domElement,L.CLASS_AUTO_PLACE)),this.parent||x(n,t.width)),p.bind(window,"resize",function(){n.onResize()}),p.bind(this.__ul,"webkitTransitionEnd",function(){n.onResize()}),p.bind(this.__ul,"transitionend",function(){n.onResize()}),p.bind(this.__ul,"oTransitionEnd",function(){n.onResize()}),this.onResize(),t.resizable&&w(this);n.getRoot();t.parent||i()};return L.toggleHide=function(){B=!B,f.each(z,function(t){t.domElement.style.zIndex=B?-999:999,t.domElement.style.opacity=B?0:1})},L.CLASS_AUTO_PLACE="a",L.CLASS_AUTO_PLACE_CONTAINER="ac",L.CLASS_MAIN="main",L.CLASS_CONTROLLER_ROW="cr",L.CLASS_TOO_TALL="taller-than-window",L.CLASS_CLOSED="closed",L.CLASS_CLOSE_BUTTON="close-button",L.CLASS_DRAG="drag",L.DEFAULT_WIDTH=245,L.TEXT_CLOSED="Close Controls",L.TEXT_OPEN="Open Controls",p.bind(window,"keydown",function(t){"text"===document.activeElement.type||t.which!==P&&t.keyCode!=P||L.toggleHide()},!1),f.extend(L.prototype,{add:function(t,e){return m(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return m(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.slice(this.__controllers.indexOf(t),1);var e=this;f.defer(function(){e.onResize()})},destroy:function(){this.autoPlace&&M.removeChild(this.domElement)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var i=new L(e);this.__folders[t]=i;var n=_(this,i.domElement);return p.addClass(n,"folder"),i},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=p.getOffset(t.__ul).top,i=0;f.each(t.__ul.childNodes,function(e){t.autoPlace&&e===t.__save_row||(i+=p.getHeight(e))}),window.innerHeight-e-N<i?(p.addClass(t.domElement,L.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-N+"px"):(p.removeClass(t.domElement,L.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&f.defer(function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"}),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},remember:function(){if(f.isUndefined(T)&&(T=new c,T.domElement.innerHTML=e),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;f.each(Array.prototype.slice.call(arguments),function(e){0==t.__rememberedObjects.length&&y(t),t.__rememberedObjects.indexOf(e)==-1&&t.__rememberedObjects.push(e)}),this.autoPlace&&x(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=k(this)),t.folders={},f.each(this.__folders,function(e,i){t.folders[i]=e.getSaveObject()}),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=k(this),S(this,!1)},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[R]=k(this,!0)),this.load.remembered[t]=k(this),this.preset=t,C(this,t,!0)},revert:function(t){f.each(this.__controllers,function(e){this.getRoot().load.remembered?v(t||this.getRoot(),e):e.setValue(e.initialValue)},this),f.each(this.__folders,function(t){t.revert(t)}),t||S(this.getRoot(),!1)},listen:function(t){var e=0==this.__listening.length;this.__listening.push(t),e&&A(this.__listening)}}),L}(e.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",e.controllers.factory=function(t,e,i,n,o,s,r){return function(a,l){var u=a[l];return r.isArray(arguments[2])||r.isObject(arguments[2])?new t(a,l,arguments[2]):r.isNumber(u)?r.isNumber(arguments[2])&&r.isNumber(arguments[3])?new i(a,l,arguments[2],arguments[3]):new e(a,l,{min:arguments[2],max:arguments[3]}):r.isString(u)?new n(a,l):r.isFunction(u)?new o(a,l,""):r.isBoolean(u)?new s(a,l):void 0}}(e.controllers.OptionController,e.controllers.NumberControllerBox,e.controllers.NumberControllerSlider,e.controllers.StringController=function(t,e,i){var n=function(t,i){function o(){r.setValue(r.__input.value)}function s(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}n.superclass.call(this,t,i);var r=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),e.bind(this.__input,"keyup",o),e.bind(this.__input,"change",o),e.bind(this.__input,"blur",s),e.bind(this.__input,"keydown",function(t){13===t.keyCode&&this.blur()}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return n.superclass=t,i.extend(n.prototype,t.prototype,{updateDisplay:function(){return e.isActive(this.__input)||(this.__input.value=this.getValue()),n.superclass.prototype.updateDisplay.call(this)}}),n}(e.controllers.Controller,e.dom.dom,e.utils.common),e.controllers.FunctionController,e.controllers.BooleanController,e.utils.common),e.controllers.Controller,e.controllers.BooleanController,e.controllers.FunctionController,e.controllers.NumberControllerBox,e.controllers.NumberControllerSlider,e.controllers.OptionController,e.controllers.ColorController=function(t,e,i,n,o){function s(t,e,i,n){t.style.background="",o.each(l,function(o){t.style.cssText+="background: "+o+"linear-gradient("+e+", "+i+" 0%, "+n+" 100%); "})}function r(t){t.style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var a=function(t,l){function u(t){p(t),e.bind(window,"mousemove",p),e.bind(window,"mouseup",h)}function h(){e.unbind(window,"mousemove",p),e.unbind(window,"mouseup",h)}function d(){var t=n(this.value);t!==!1?(m.__color.__state=t,m.setValue(m.__color.toOriginal())):this.value=m.__color.toString()}function c(){e.unbind(window,"mousemove",f),e.unbind(window,"mouseup",c)}function p(t){t.preventDefault();var i=e.getWidth(m.__saturation_field),n=e.getOffset(m.__saturation_field),o=(t.clientX-n.left+document.body.scrollLeft)/i,s=1-(t.clientY-n.top+document.body.scrollTop)/i;return s>1?s=1:s<0&&(s=0),o>1?o=1:o<0&&(o=0),m.__color.v=s,m.__color.s=o,m.setValue(m.__color.toOriginal()),!1}function f(t){t.preventDefault();var i=e.getHeight(m.__hue_field),n=e.getOffset(m.__hue_field),o=1-(t.clientY-n.top+document.body.scrollTop)/i;return o>1?o=1:o<0&&(o=0),m.__color.h=360*o,m.setValue(m.__color.toOriginal()),!1}a.superclass.call(this,t,l),this.__color=new i(this.getValue()),this.__temp=new i(0);var m=this;this.domElement=document.createElement("div"),e.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",e.bind(this.__input,"keydown",function(t){13===t.keyCode&&d.call(this)}),e.bind(this.__input,"blur",d),e.bind(this.__selector,"mousedown",function(t){e.addClass(this,"drag").bind(window,"mouseup",function(t){e.removeClass(m.__selector,"drag")})});var _=document.createElement("div");o.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),o.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),o.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),o.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),o.extend(_.style,{width:"100%",height:"100%",background:"none"}),s(_,"top","rgba(0,0,0,0)","#000"),o.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),r(this.__hue_field),o.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),e.bind(this.__saturation_field,"mousedown",u),e.bind(this.__field_knob,"mousedown",u),e.bind(this.__hue_field,"mousedown",function(t){f(t),e.bind(window,"mousemove",f),e.bind(window,"mouseup",c)}),this.__saturation_field.appendChild(_),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay()};a.superclass=t,o.extend(a.prototype,t.prototype,{updateDisplay:function(){var t=n(this.getValue());if(t!==!1){var e=!1;o.each(i.COMPONENTS,function(i){if(!o.isUndefined(t[i])&&!o.isUndefined(this.__color.__state[i])&&t[i]!==this.__color.__state[i])return e=!0,{}},this),e&&o.extend(this.__color.__state,t)}o.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var r=this.__color.v<.5||this.__color.s>.5?255:0,a=255-r;o.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+r+","+r+","+r+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,s(this.__saturation_field,"left","#fff",this.__temp.toString()),o.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+r+","+r+","+r+")",textShadow:this.__input_textShadow+"rgba("+a+","+a+","+a+",.7)"})}});var l=["-moz-","-o-","-webkit-","-ms-",""];return a}(e.controllers.Controller,e.dom.dom,e.color.Color=function(t,e,i,n){function o(t,e,i){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space?this.__state[e]:(r(this,e,i),this.__state[e])},set:function(t){"RGB"!==this.__state.space&&(r(this,e,i),this.__state.space="RGB"),this.__state[e]=t}})}function s(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space?this.__state[e]:(a(this),this.__state[e])},set:function(t){"HSV"!==this.__state.space&&(a(this),this.__state.space="HSV"),this.__state[e]=t}})}function r(t,i,o){if("HEX"===t.__state.space)t.__state[i]=e.component_from_hex(t.__state.hex,o);else{if("HSV"!==t.__state.space)throw"Corrupted color state";n.extend(t.__state,e.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}}function a(t){var i=e.rgb_to_hsv(t.r,t.g,t.b);n.extend(t.__state,{s:i.s,v:i.v}),n.isNaN(i.h)?n.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=i.h}var l=function(){if(this.__state=t.apply(this,arguments),this.__state===!1)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};return l.COMPONENTS=["r","g","b","h","s","v","hex","a"],n.extend(l.prototype,{toString:function(){return i(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),o(l.prototype,"r",2),o(l.prototype,"g",1),o(l.prototype,"b",0),s(l.prototype,"h"),s(l.prototype,"s"),s(l.prototype,"v"),Object.defineProperty(l.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(l.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=e.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}}),l}(e.color.interpret,e.color.math=function(){var t;return{hsv_to_rgb:function(t,e,i){var n=Math.floor(t/60)%6,o=t/60-Math.floor(t/60),s=i*(1-e),r=i*(1-o*e),a=i*(1-(1-o)*e),l=[[i,a,s],[r,i,s],[s,i,a],[s,r,i],[a,s,i],[i,s,r]][n];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(t,e,i){var n,o,s=Math.min(t,e,i),r=Math.max(t,e,i),a=r-s;return 0==r?{h:NaN,s:0,v:0}:(o=a/r,n=t==r?(e-i)/a:e==r?2+(i-t)/a:4+(t-e)/a,n/=6,n<0&&(n+=1),{h:360*n,s:o,v:r/255})},rgb_to_hex:function(t,e,i){var n=this.hex_with_component(0,2,t);return n=this.hex_with_component(n,1,e),n=this.hex_with_component(n,0,i)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(e,i,n){return n<<(t=8*i)|e&~(255<<t)}}}(),e.color.toString,e.utils.common),e.color.interpret,e.utils.common),e.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}(),e.dom.CenteredDiv=function(t,e){var i=function(){this.backgroundElement=document.createElement("div"),e.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"}),t.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),e.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var i=this;t.bind(this.backgroundElement,"click",function(){i.hide()})};return i.prototype.show=function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),e.defer(function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"})},i.prototype.hide=function(){var e=this,i=function(){e.domElement.style.display="none",e.backgroundElement.style.display="none",t.unbind(e.domElement,"webkitTransitionEnd",i),t.unbind(e.domElement,"transitionend",i),t.unbind(e.domElement,"oTransitionEnd",i)};t.bind(this.domElement,"webkitTransitionEnd",i),t.bind(this.domElement,"transitionend",i),t.bind(this.domElement,"oTransitionEnd",i),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},i.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-t.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-t.getHeight(this.domElement)/2+"px"},i}(e.dom.dom,e.utils.common),e.dom.dom,e.utils.common)}),W=s(function(t){var e=t.exports=e||{};e.color=e.color||{},e.utils=e.utils||{},e.utils.common=function(){var t=Array.prototype.forEach,e=Array.prototype.slice;return{BREAK:{},extend:function(t){return this.each(e.call(arguments,1),function(e){for(var i in e)this.isUndefined(e[i])||(t[i]=e[i])},this),t},defaults:function(t){return this.each(e.call(arguments,1),function(e){for(var i in e)this.isUndefined(t[i])&&(t[i]=e[i])},this),t},compose:function(){var t=e.call(arguments);return function(){for(var i=e.call(arguments),n=t.length-1;n>=0;n--)i=[t[n].apply(this,i)];return i[0]}},each:function(e,i,n){if(t&&e.forEach===t)e.forEach(i,n);else if(e.length===e.length+0){for(var o=0,s=e.length;o<s;o++)if(o in e&&i.call(n,e[o],o)===this.BREAK)return}else for(var o in e)if(i.call(n,e[o],o)===this.BREAK)return},defer:function(t){setTimeout(t,0)},toArray:function(t){return t.toArray?t.toArray():e.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){return t!==t},isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return t===!1||t===!0},isFunction:function(t){return"[object Function]"===Object.prototype.toString.call(t)}}}(),e.color.toString=function(t){return function(e){if(1==e.a||t.isUndefined(e.a)){for(var i=e.hex.toString(16);i.length<6;)i="0"+i;return"#"+i}return"rgba("+Math.round(e.r)+","+Math.round(e.g)+","+Math.round(e.b)+","+e.a+")"}}(e.utils.common),e.Color=e.color.Color=function(t,e,i,n){function o(t,e,i){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space?this.__state[e]:(r(this,e,i),this.__state[e])},set:function(t){"RGB"!==this.__state.space&&(r(this,e,i),this.__state.space="RGB"),this.__state[e]=t}})}function s(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space?this.__state[e]:(a(this),this.__state[e])},set:function(t){"HSV"!==this.__state.space&&(a(this),this.__state.space="HSV"),this.__state[e]=t}})}function r(t,i,o){if("HEX"===t.__state.space)t.__state[i]=e.component_from_hex(t.__state.hex,o);else{if("HSV"!==t.__state.space)throw"Corrupted color state";n.extend(t.__state,e.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}}function a(t){var i=e.rgb_to_hsv(t.r,t.g,t.b);n.extend(t.__state,{s:i.s,v:i.v}),n.isNaN(i.h)?n.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=i.h}var l=function(){if(this.__state=t.apply(this,arguments),this.__state===!1)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};return l.COMPONENTS=["r","g","b","h","s","v","hex","a"],n.extend(l.prototype,{toString:function(){return i(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),o(l.prototype,"r",2),o(l.prototype,"g",1),o(l.prototype,"b",0),s(l.prototype,"h"),s(l.prototype,"s"),s(l.prototype,"v"),Object.defineProperty(l.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(l.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=e.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}}),l}(e.color.interpret=function(t,e){var i,n,o=function(){n=!1;var t=arguments.length>1?e.toArray(arguments):arguments[0];return e.each(s,function(o){if(o.litmus(t))return e.each(o.conversions,function(o,s){if(i=o.read(t),n===!1&&i!==!1)return n=i,i.conversionName=s,i.conversion=o,e.BREAK}),e.BREAK}),n},s=[{litmus:e.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString())}},write:t},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString())}},write:t},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:t},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);
return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:t}}},{litmus:e.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:e.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3==t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4==t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:e.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(e.isNumber(t.r)&&e.isNumber(t.g)&&e.isNumber(t.b)&&e.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(e.isNumber(t.r)&&e.isNumber(t.g)&&e.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(e.isNumber(t.h)&&e.isNumber(t.s)&&e.isNumber(t.v)&&e.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(e.isNumber(t.h)&&e.isNumber(t.s)&&e.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}];return o}(e.color.toString,e.utils.common),e.color.math=function(){var t;return{hsv_to_rgb:function(t,e,i){var n=Math.floor(t/60)%6,o=t/60-Math.floor(t/60),s=i*(1-e),r=i*(1-o*e),a=i*(1-(1-o)*e),l=[[i,a,s],[r,i,s],[s,i,a],[s,r,i],[a,s,i],[i,s,r]][n];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(t,e,i){var n,o,s=Math.min(t,e,i),r=Math.max(t,e,i),a=r-s;return 0==r?{h:NaN,s:0,v:0}:(o=a/r,n=t==r?(e-i)/a:e==r?2+(i-t)/a:4+(t-e)/a,n/=6,n<0&&(n+=1),{h:360*n,s:o,v:r/255})},rgb_to_hex:function(t,e,i){var n=this.hex_with_component(0,2,t);return n=this.hex_with_component(n,1,e),n=this.hex_with_component(n,0,i)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(e,i,n){return n<<(t=8*i)|e&~(255<<t)}}}(),e.color.toString,e.utils.common)}),U=X,Y=W;U.color=Y;var K=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,[{key:"initialize",value:function(){this.gui=new U.GUI}}]),e}(z);i("DatGui",K);var q=2*Math.PI,J=function(t){t||(t=event);var e=t.wheelDelta,i=t.detail;return i?e?e/i/40*i>0?1:-1:-i/3:e/120},Q=function(t){function i(){return c(this,i),g(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return _(i,t),p(i,[{key:"defaultOptions",value:function(){return{lineWidth:2.5,zoom:1,zoomMin:.1,zoomMax:10,zoomWheelFactor:.05,gridEnabled:!0,gridSize:250,gridColor:2236962,followEnabled:!0,followName:null,followEntityId:null}}},{key:"initialize",value:function(){var t=this;this.container=document.querySelector(this.options.container),this.renderer=PIXI.autoDetectRenderer(this.container.offsetWidth,this.container.offsetHeight,{antialias:!0}),this.renderer.autoResize=!0,this.canvas=this.renderer.view,this.container.appendChild(this.canvas),this.stage=new PIXI.Container,this.backdrop=new PIXI.Graphics,this.stage.addChild(this.backdrop),this.graphics={};var e={resize:function(e){t.updateMetrics(e)},orientationchange:function(e){t.updateMetrics(e)},mousedown:function(e){t.onMouseDown(e)},mousemove:function(e){t.onMouseMove(e)},mouseup:function(e){t.onMouseUp(e)}};for(var i in e)this.canvas.addEventListener(i,e[i],!1);var n=function(e){return t.onMouseWheel(e)};window.addEventListener?(window.addEventListener("mousewheel",n,!1),window.addEventListener("DOMMouseScroll",n,!1)):window.attachEvent&&window.attachEvent("onmousewheel",n),this.followEnabled=this.options.followEnabled,this.zoom=this.options.zoom,this.followEntityId=this.options.followEntityId,this.gridEnabled=this.options.gridEnabled,this.lineWidth=this.options.lineWidth,this.cursorRawX=0,this.cursorRawY=0,this.cursorChanged=!1,this.cursorPosition={x:0,y:0},this.cameraX=0,this.cameraY=0,this.debugDummySprite={size:100},this.updateMetrics()}},{key:"onMouseWheel",value:function(t){this.zoom+=J(t)*this.options.zoomWheelFactor,this.zoom<this.options.zoomMin&&(this.zoom=this.options.zoomMin),this.zoom>this.options.zoomMax&&(this.zoom=this.options.zoomMax)}},{key:"onMouseDown",value:function(t){this.setCursor(t.clientX,t.clientY),this.world.publish("mouseDown",this.cursorPosition)}},{key:"onMouseMove",value:function(t){this.setCursor(t.clientX,t.clientY),this.world.publish("mouseMove",this.cursorPosition)}},{key:"onMouseUp",value:function(t){this.setCursor(t.clientX,t.clientY),this.world.publish("mouseUp",this.cursorPosition)}},{key:"setCursor",value:function(t,e){var i=this.container.offsetWidth,n=this.container.offsetHeight;this.cursorRawX=t,this.cursorRawY=e;var o=(t-i/2)/this.zoom+this.cameraX,s=(e-n/2)/this.zoom+this.cameraY;return this.cursorChanged=!1,o===this.cursorPosition.x&&s===this.cursorPosition.y||(this.cursorChanged=!0,this.cursorPosition.x=o,this.cursorPosition.y=s),this.cursorPosition}},{key:"updateMetrics",value:function(){var t=this.container.offsetWidth,e=this.container.offsetHeight;this.visibleWidth=t/this.zoom,this.visibleHeight=e/this.zoom,this.visibleLeft=0-this.visibleWidth/2+this.cameraX,this.visibleTop=0-this.visibleHeight/2+this.cameraY,this.visibleRight=this.visibleLeft+this.visibleWidth,this.visibleBottom=this.visibleTop+this.visibleHeight}},{key:"update",value:function(){var t=this;this.updateMetrics(),this.setCursor(this.cursorRawX,this.cursorRawY),this.world.publish("mouseMove",this.cursorPosition);var e=this.world.get("Sprite"),i=Object.keys(this.graphics).filter(function(t){return!(t in e)});i.forEach(function(e){t.stage.removeChild(t.graphics[e]),delete t.graphics[e]});var n=Object.keys(e).filter(function(e){return!(e in t.graphics)});n.forEach(function(e){t.stage.addChild(t.graphics[e]=new PIXI.Graphics)})}},{key:"draw",value:function(t){this.followEntity(),this.drawBackdrop(t);for(var e in this.graphics)this.drawSprite(this.graphics[e],e,t);this.stage.setTransform(this.container.offsetWidth/2-this.cameraX*this.zoom,this.container.offsetHeight/2-this.cameraY*this.zoom,this.zoom,this.zoom),this.renderer.resize(this.container.offsetWidth,this.container.offsetHeight),this.renderer.render(this.stage)}},{key:"drawSprite",value:function(t,e,i){var n=this.world.get("Sprite",e),o=this.world.get("Position",e),s=l(n.name);return s||(s=l("default")),t.position.x=Math.floor(o.x),t.position.y=Math.floor(o.y),t.rotation=o.rotation+Math.PI/2,t.scale.x=t.scale.y=n.size/100,t.lineStyle(this.lineWidth/(n.size/100),16777215),s(t,n,e,i),n.drawn=!0,t}},{key:"followEntity",value:function(){if(!this.followEnabled)return void(this.cameraX=this.cameraY=0);if(this.options.followName&&!this.followEntityId&&(this.followEntityId=e("Name").findEntityByName(this.world,this.options.followName)),this.followEntityId){var t=this.world.get("Position",this.followEntityId);t&&(this.cameraX=t.x,this.cameraY=t.y,this.setCursor(this.cursorRawX,this.cursorRawY))}}},{key:"drawBackdrop",value:function(){var t=this.backdrop;if(!this.gridEnabled)return void(t.visible=!1);var e=this.options.gridSize,i=this.visibleLeft%e,n=this.visibleTop%e;t.visible=!0,t.clear(),t.lineStyle(1,this.options.gridColor),t.position.x=this.visibleLeft,t.position.y=this.visibleTop;for(var o=-i;o<this.visibleWidth;o+=e)t.moveTo(o,0),t.lineTo(o,this.visibleHeight+e);for(var s=-n;s<this.visibleHeight;s+=e)t.moveTo(0,s),t.lineTo(this.visibleWidth+e,s)}}]),i}(z);i("ViewportPixi",Q);var Z=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,null,[{key:"defaults",value:function(){return{name:null,color:"#fff",size:100,width:null,height:null,drawn:!1}}},{key:"create",value:function(t){var i=m(e.__proto__||Object.getPrototypeOf(e),"create",this).call(this,t);return i.width||(i.width=i.size),i.height||(i.height=i.size),i}}]),e}(B);t("Sprite",Z);var $={};a("default",function(t,e){e.drawn||(t.arc(0,0,50,0,q),t.moveTo(0,0),t.lineTo(0,-50),t.moveTo(0,0))}),a("sun",function(t,e){e.drawn||t.arc(0,0,50,0,q,!0)}),a("enemyscout",function(t,e){e.drawn||(t.moveTo(0,-50),t.lineTo(-45,50),t.lineTo(-12.5,12.5),t.lineTo(0,25),t.lineTo(12.5,12.5),t.lineTo(45,50),t.lineTo(0,-50),t.moveTo(0,-50))}),a("enemywing",function(t,e){e.drawn||(t.lineColor=2263074,t.moveTo(-50,0),t.lineTo(-37.5,-37.5),t.lineTo(0,50),t.lineTo(37.5,-37.5),t.lineTo(50,0),t.lineTo(37.5,50),t.lineTo(25,50),t.lineTo(0,0),t.lineTo(-25,50),t.lineTo(-37.5,50),t.lineTo(-50,0))}),a("hero",function(t,e){e.drawn||(t.moveTo(-50,0),t.lineTo(-37.5,-37.5),t.lineTo(0,-50),t.lineTo(37.5,-37.5),t.lineTo(50,0),t.lineTo(37.5,50),t.lineTo(25,50),t.lineTo(12.5,12.5),t.lineTo(5,25),t.lineTo(-5,25),t.lineTo(-12.5,12.5),t.lineTo(-25,50),t.lineTo(-37.5,50),t.lineTo(-50,0))}),a("asteroid",function(t,e){if(!e.drawn){var i=10+Math.floor(8*Math.random()),n=50,o=35,s=q/i,r=void 0,a=[];for(r=0;r<i;r++){var l=r*s,u=Math.random()*(n-o)+o;a.push(u*Math.cos(l)),a.push(u*Math.sin(l))}a.push(a[0]),a.push(a[1]),t.drawPolygon(a)}}),a("mine",function(t,e){if(!(e.drawn&&Math.random()>.1)){if(!e.drawn){var i=10+Math.floor(10*Math.random());i%2!==0&&i++;var n=60,o=10;e.legs=[];for(var s=!1,r=0;r<i;r++){var a=s?10:Math.random()*(n-o)+o;e.legs.push(a),s=!s}}var l=[],u=q/e.legs.length;e.legs.forEach(function(t,e){var i=t*(.9+.5*Math.random()),n=e*u;l.push(i*Math.cos(n)),l.push(i*Math.sin(n))}),l.push(l[0]),l.push(l[1]),t.clear(),t.lineStyle(2.5/(e.size/100),16720418),t.drawPolygon(l)}});var tt=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,null,[{key:"defaults",value:function(){return{name:"unnamed"}}},{key:"findEntityByName",value:function(t,e){var i=t.get("Name");for(var n in i){var o=i[n];if(o.name===e)return n}}}]),e}(B);t("Name",tt);var et=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,null,[{key:"defaults",value:function(){return{max:1e3,current:null,show_bar:!0}}},{key:"create",value:function(t){var i=m(e.__proto__||Object.getPrototypeOf(e),"create",this).call(this,t);return i.current=i.max,i}}]),e}(B);t("Health",et),u.prototype={reset:function(t,e,i,n,o,s,r){this.maxObjects=o||10,this.maxLevels=s||4,this.level=r||0,this.bounds={width:i,height:n,subWidth:Math.floor(i/2),subHeight:Math.floor(n/2),left:Math.round(t),top:Math.round(e),midX:Math.round(t+i/2),midY:Math.round(e+n/2),right:Math.round(t+i),bottom:Math.round(e+n)},this.objects.length=0,this.nodes.length=0},split:function(){this.nodes[0]=new u(this.bounds.left+this.bounds.subWidth,this.bounds.top,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1,this.root),this.nodes[1]=new u(this.bounds.left,this.bounds.top,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1,this.root),this.nodes[2]=new u(this.bounds.left,this.bounds.top+this.bounds.subHeight,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1,this.root),this.nodes[3]=new u(this.bounds.left+this.bounds.subWidth,this.bounds.top+this.bounds.subHeight,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1,this.root)},insert:function(t){var e,i=0;if(null!=this.nodes[0]&&(e=this.getIndex(t),e!==-1))return void this.nodes[e].insert(t);var n=this.root.entityMap[t.entityId];if(n!==this){if(n){var o=n.objects.indexOf(t);o!==-1&&n.objects.splice(o,1)}if(this.objects.push(t),this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(null==this.nodes[0]&&this.split();i<this.objects.length;)e=this.getIndex(this.objects[i]),e!==-1?this.nodes[e].insert(this.objects.splice(i,1)[0]):i++}},getIndex:function(t){if(t.left<this.bounds.midX&&t.right<this.bounds.midX){if(t.top<this.bounds.midY&&t.bottom<this.bounds.midY)return 1;if(t.top>this.bounds.midY)return 2}else if(t.left>this.bounds.midX){if(t.top<this.bounds.midY&&t.bottom<this.bounds.midY)return 0;if(t.top>this.bounds.midY)return 3}return-1},iterate:function(t,e,i){for(var n=this.getIndex(t),o=0;o<this.objects.length;o++)e(this.objects[o],i);this.nodes[0]&&(n!==-1?this.nodes[n].iterate(t,e,i):(this.nodes[0].iterate(t,e,i),this.nodes[1].iterate(t,e,i),this.nodes[2].iterate(t,e,i),this.nodes[3].iterate(t,e,i)))},clear:function(){this.objects.length=0;for(var t=this.nodes.length;t--;)this.nodes[t].clear(),this.nodes.splice(t,1);this.nodes.length=0}};var it=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,null,[{key:"defaults",value:function(){return{x:0,y:0,rotation:0}}}]),e}(B);t("Position",it);var nt=void 0,ot=void 0,st=void 0,rt=void 0,at=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,[{key:"defaultOptions",value:function(){return{quadtreeMaxAge:2,quadtreeObjectsPerNode:5,quadtreeMaxLevels:5}}},{key:"matchComponent",value:function(){return"Position"}},{key:"initialize",value:function(){this.bounds={left:0,top:0,right:0,bottom:0,width:0,height:0},this.quadtree=new u(-1e3,-1e3,2e3,2e3,this.options.quadtreeObjectsPerNode,this.options.quadtreeMaxLevels)}},{key:"update",value:function(t){this.updateBounds(),this.resetQuadtree(t),m(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this,t)}},{key:"resetQuadtree",value:function(){this.quadtree.reset(this.bounds.left,this.bounds.top,this.bounds.width,this.bounds.height,this.options.quadtreeObjectsPerNode,this.options.quadtreeMaxLevels)}},{key:"updateBounds",value:function(){this.bounds.left=this.bounds.top=this.bounds.right=this.bounds.bottom=null,rt=this.getMatchingComponents();for(nt in rt)st=rt[nt],(null===this.bounds.left||st.left<this.bounds.left)&&(this.bounds.left=st.left),(null===this.bounds.top||st.top<this.bounds.top)&&(this.bounds.top=st.top),(null===this.bounds.right||st.right>this.bounds.right)&&(this.bounds.right=st.right),(null===this.bounds.bottom||st.bottom>this.bounds.bottom)&&(this.bounds.bottom=st.bottom);this.bounds.width=this.bounds.right-this.bounds.left,this.bounds.height=this.bounds.bottom-this.bounds.top}},{key:"updateComponent",value:function(t,e,i){if(ot=this.world.get("Sprite",e)){var n=ot.width/2,o=ot.height/2;i.entityId=e,i.width=ot.width,i.height=ot.height,i.left=i.x-n,i.top=i.y-o,i.right=i.x+n,i.bottom=i.y+o,this.quadtree.insert(i)}}},{key:"draw",value:function(){var t=this.getDebugGraphics();if(t){t.lineStyle(4,8921634),rt=this.getMatchingComponents();for(nt in rt)st=rt[nt],ot=this.world.get("Sprite",nt),t.drawCircle(st.x,st.y,ot.width/2),t.moveTo(st.x-20,st.y),t.lineTo(st.x+20,st.y),t.moveTo(st.x,st.y-20),t.lineTo(st.x,st.y+20);t.lineStyle(4,2263074),this.drawDebugQuadtreeNode(t,this.quadtree),t.lineStyle(4,16777011),t.moveTo(-20,0),t.lineTo(20,0),t.moveTo(0,-20),t.lineTo(0,20),t.moveTo(0,0),t.drawRect(this.bounds.left,this.bounds.top,this.bounds.width,this.bounds.height)}}},{key:"drawDebugQuadtreeNode",value:function(t,e){e&&(t.lineStyle(4,8926088),t.drawRect(e.bounds.left,e.bounds.top,e.bounds.width,e.bounds.height),t.lineStyle(4,1122850),e.objects.forEach(function(e){return t.drawRect(e.left,e.top,e.width,e.height)}),this.drawDebugQuadtreeNode(t,e.nodes[0]),this.drawDebugQuadtreeNode(t,e.nodes[1]),this.drawDebugQuadtreeNode(t,e.nodes[2]),this.drawDebugQuadtreeNode(t,e.nodes[3]))}}]),e}(z);i("Position",at);var lt=2*Math.PI,ut=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,null,[{key:"defaults",value:function(){return{dx:0,dy:0,drotation:0}}}]),e}(B);t("Motion",ut);var ht=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,[{key:"matchComponent",value:function(){return"Motion"}},{key:"updateComponent",value:function(t,e,i){var n=this.world.get("Position",e);n.x+=i.dx*t,n.y+=i.dy*t,n.rotation=(n.rotation+i.drotation*t)%lt,n.rotation<0&&(n.rotation+=lt)}}]),e}(z);i("Motion",ht);var dt=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,null,[{key:"defaults",value:function(){return{active:!0,stop:!1,useBrakes:!0,deltaV:0,maxV:0}}}]),e}(B);t("Thruster",dt);var ct=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,[{key:"matchComponent",value:function(){return"Thruster"}},{key:"initialize",value:function(){this.vInertia=new o,this.vThrust=new o,this.vBrakes=new o}},{key:"updateComponent",value:function(t,e,i){if(i.active){var n=this.world.get("Position",e),o=this.world.get("Motion",e);if(n&&o){this.vInertia.setValues(o.dx,o.dy);var s=t*i.deltaV;if(i.stop||(this.vThrust.setValues(s,0),this.vThrust.rotate(n.rotation),this.vInertia.add(this.vThrust)),i.useBrakes){var r=i.stop?0:i.maxV,a=this.vInertia.magnitude(),l=a-r;if(l>0){var u=Math.min(s,l);this.vBrakes.setValues(this.vInertia.x,this.vInertia.y),this.vBrakes.normalize(),this.vBrakes.multiplyScalar(0-u),this.vInertia.add(this.vBrakes)}i.stop&&0===a&&(i.active=!1)}o.dx=this.vInertia.x,o.dy=this.vInertia.y}}}}]),e}(z);i("Thruster",ct);var pt=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,null,[{key:"defaults",value:function(){return{active:!0,targetName:null,targetEntityId:null,targetPosition:null,acquisitionDelay:0,radPerSec:Math.PI}}}]),e}(B);t("Seeker",pt);var ft=function(t){function i(){return c(this,i),g(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return _(i,t),p(i,[{key:"matchComponent",value:function(){return"Seeker"}},{key:"initialize",value:function(){this.vSeeker=new o,this.vTarget=new o}},{key:"updateComponent",value:function(t,i,n){if(n.active){if(n.targetName&&!n.targetEntityId&&(n.targetEntityId=e("Name").findEntityByName(this.world,n.targetName)),n.acquisitionDelay>0)return void(n.acquisitionDelay-=t);var o=this.world.get("Position",i),s=this.world.get("Motion",i);if(o&&s){var r=n.targetPosition;if(r||(r=this.world.get("Position",n.targetEntityId)),r){this.vSeeker.setValues(o.x,o.y),this.vTarget.setValues(r.x,r.y);var a=this.vSeeker.angleTo(this.vTarget);a<0&&(a+=2*Math.PI);var l=a<o.rotation?-1:1,u=Math.abs(a-o.rotation);u>Math.PI&&(l=0-l);var h=l*Math.min(n.radPerSec,u/t),d=h-s.drotation;Math.abs(d)>n.radPerSec&&(d>0?d=n.radPerSec:d<0&&(d=0-n.radPerSec)),s.drotation+=d}}}}}]),i}(z);i("Seeker",ft);var mt=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,null,[{key:"defaults",value:function(){return{inCollision:!1,inCollisionWith:{}}}}]),e}(B);t("Collidable",mt);var _t=void 0,gt=void 0,vt=void 0,bt=void 0,yt=void 0,wt=void 0,xt=void 0,kt=void 0,Ct=void 0,Et=void 0,St=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,[{key:"defaultOptions",value:function(){return{positionSystemName:"Position"}}},{key:"matchComponent",value:function(){return"Collidable"}},{key:"initialize",value:function(){var t=this;this.positionSystem=this.world.getSystem(this.options.positionSystemName),this.width=this.options.width,this.height=this.options.height,this.retrieveBounds={},this.checkCollisionBound=function(e,i){return t.checkCollision(e,i)}}},{key:"update",value:function(){gt=this.getMatchingComponents();for(vt in gt){_t=gt[vt],_t.inCollision=!1;for(bt in _t.inCollisionWith)delete _t.inCollisionWith[bt]}for(vt in gt)yt=this.world.get("Position",vt),yt&&this.positionSystem.quadtree.iterate(yt,this.checkCollisionBound,yt)}},{key:"checkCollision",value:function(t,e){e.entityId!==t.entityId&&(wt=this.world.get("Collidable",e.entityId),xt=this.world.get("Collidable",t.entityId),wt&&xt&&(kt=e.x-t.x,Ct=e.y-t.y,Et=(e.width+t.width)/2,kt*kt+Ct*Ct>Et*Et||(wt.inCollision=!0,wt.inCollisionWith[t.entityId]=1,xt.inCollision=!0,xt.inCollisionWith[e.entityId]=1)))}},{key:"draw",value:function(){var t=this.getDebugGraphics();if(t){t.lineStyle(4,10066329);var e=this.world.get("Collidable");for(var i in e){var n=e[i],o=this.world.get("Position",i);n.inCollision&&t.drawCircle(o.x,o.y,40)}}}}]),e}(z);i("Collision",St);var At=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,null,[{key:"defaults",value:function(){return{mass:1e3}}}]),e}(B);t("Bounce",At);var Tt=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,[{key:"matchComponent",value:function(){return"Bounce"}},{key:"initialize",value:function(){this.dn=new o,this.dt=new o,this.mt=new o,this.v1=new o,this.v2=new o,this.v1n=new o,this.v1t=new o,this.v2n=new o,this.v2t=new o}},{key:"update",value:function(t){var e=this.world,i=this.getMatchingComponents(),n={};for(var o in i){var s=e.get("Collidable",o);for(var r in s.inCollisionWith){var a=[o,r];a.sort(),n[a.join(":")]=a}}for(var l in n){var u=n[l][0],h=e.get("Bounce",u);if(h){var d=n[l][1],c=e.get("Bounce",d);c&&this.resolveElasticCollision(t,u,h,d,c)}}}},{key:"resolveElasticCollision",value:function(t,e,i,n,o){var s=this.world,r=s.get("Position",e),a=s.get("Sprite",e),l=s.get("Motion",e),u=s.get("Position",n),h=s.get("Sprite",n),d=s.get("Motion",n);this.dn.setValues(r.x-u.x,r.y-u.y);var c=this.dn.magnitude();this.dn.normalize(),this.dt.setValues(this.dn.y,-this.dn.x),0===c&&(u.x+=.01);var p=i.mass,f=o.mass,m=p+f;if(this.mt.setValues(this.dn.x*(a.width+h.width-c)*1.1,this.dn.y*(a.height+h.height-c)*1.1),this.v1.setValues(l?l.dx:0,l?l.dy:0),this.v2.setValues(d?d.dx:0,d?d.dy:0),this.v1n.setValues(this.dn.x*this.v1.dot(this.dn),this.dn.y*this.v1.dot(this.dn)),this.v1t.setValues(this.dt.x*this.v1.dot(this.dt),this.dt.y*this.v1.dot(this.dt)),this.v2n.setValues(this.dn.x*this.v2.dot(this.dn),this.dn.y*this.v2.dot(this.dn)),this.v2t.setValues(this.dt.x*this.v2.dot(this.dt),this.dt.y*this.v2.dot(this.dt)),l){var _=(p-f)/m*this.v1n.magnitude()+2*f/m*this.v2n.magnitude();l.dx=this.v1t.x+this.dn.x*_,l.dy=this.v1t.y+this.dn.y*_}if(d){var g=(f-p)/m*this.v2n.magnitude()+2*p/m*this.v1n.magnitude();d.dx=this.v2t.x-this.dn.x*g,d.dy=this.v2t.y-this.dn.y*g}}}]),e}(z);i("Bounce",Tt);var Mt=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,null,[{key:"defaults",value:function(){return{range:500,force:200}}}]),e}(B);t("Repulsor",Mt);var Ot=void 0,Pt=void 0,Nt=void 0,Rt=void 0,It=void 0,Dt=void 0,Bt=void 0,zt=void 0,Lt=void 0,jt=void 0,Ht=void 0,Vt=void 0,Ft=void 0,Gt={},Xt=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,[{key:"defaultOptions",value:function(){return{positionSystemName:"Position"}}},{key:"matchComponent",value:function(){return"Repulsor"}},{key:"initialize",value:function(){var t=this;this.positionSystem=this.world.getSystem(this.options.positionSystemName),this.applyRepulsionBound=function(e,i){return t.applyRepulsion(e,i)}}},{key:"updateComponent",value:function(t,e,i){It=this.world.get("Position",e),Gt.left=It.left-i.range,Gt.right=It.right-i.range,Gt.top=It.top-i.range,Gt.bottom=It.bottom-i.range,Ot=this.world.get("Position");for(Rt in Ot)i=Ot[Rt],this.applyRepulsion(i,e)}},{key:"applyRepulsion",value:function(t,e){zt=this.world.get("Sprite",t.entityId),"mine"===zt.name&&(Dt=this.world.get("Repulsor",e),Bt=this.world.get("Position",e),Lt=this.world.get("Position",t.entityId),jt=this.world.get("Motion",t.entityId),Ft=(Lt.x-Bt.x)*(Lt.x-Bt.x)+(Lt.y-Bt.y)*(Lt.y-Bt.y),Ft>Dt.range*Dt.range||(Ht=Math.atan2(Bt.y-Lt.y,Bt.x-Lt.x),Vt=-Dt.force,jt.dx+=Vt*Math.cos(Ht),jt.dy+=Vt*Math.sin(Ht)))}},{key:"draw",value:function(){var t=this.getDebugGraphics();if(t){t.lineStyle(4,8921634),Ot=this.getMatchingComponents();for(Nt in Ot)Pt=Ot[Nt],It=this.world.get("Position",Nt),t.drawCircle(It.x,It.y,Pt.range)}}}]),e}(z);i("Repulsor",Xt);var Wt=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,null,[{key:"defaults",value:function(){return{active:!0,radPerSec:2*Math.PI}}}]),e}(B);t("PlayerInputSteering",Wt);var Ut=2*Math.PI,Yt=function(t){function e(){return c(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _(e,t),p(e,[{key:"defaultOptions",value:function(){return{gamepadDeadzone:.2}}},{key:"matchComponent",value:function(){return"PlayerInputSteering"}},{key:"initialize",value:function(){var t=this;this.gamepad={active:!1},this.pointer={active:!1,x:0,y:0},this.keys={active:!1},this.touch={active:!1,x:0,y:0},this.world.subscribe("mouseDown",function(e,i){return t.setPointer(!0,i)}).subscribe("mouseUp",function(e,i){return t.setPointer(!1,i)}).subscribe("mouseMove",function(e,i){return t.setPointer(t.pointer.active,i)});var e={keydown:this.handleKeyDown,keyup:this.handleKeyUp};Object.keys(e).forEach(function(i){return window.addEventListener(i,e[i].bind(t))})}},{key:"setPointer",value:function(t,e){this.pointer.active=t,this.pointer.x=e.x,this.pointer.y=e.y}},{key:"update",value:function(t){this.updateGamepads(t),this.updateKeyboard(t),m(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this,t)}},{key:"updateComponent",value:function(t,e,i){var n=this.world.get("Thruster",e),o=this.world.get("Motion",e);return n.active=!0,n.stop=!1,this.keys.active?this.updateComponentFromKeyboard(t,e,i):this.pointer.active?this.updateComponentFromPointer(t,e,i):this.gamepad.active?this.updateComponentFromGamepad(t,e,i):(n.stop=!0,void(o.drotation=0))}},{key:"updateComponentFromPointer",value:function(t,e,i){var n=this.world.get("Position",e);this.updateMotionFromTargetAngle(t,e,i,Math.atan2(this.pointer.y-n.y,this.pointer.x-n.x))}},{key:"updateComponentFromGamepad",value:function(t,e,i){this.updateMotionFromTargetAngle(t,e,i,Math.atan2(this.gamepad.axis1,this.gamepad.axis0))}},{key:"updateComponentFromKeyboard",value:function(t,e,i){var n=this.world.get("Thruster",e),o=this.world.get("Motion",e),s=this.keys[65]||this.keys[37]||this.gamepad.button13,r=this.keys[68]||this.keys[39]||this.gamepad.button14,a=this.keys[87]||this.keys[38]||this.gamepad.button11;a?n.active=!0:n.stop=!0;var l=s?-1:r?1:0,u=l*i.radPerSec;o.drotation=u}},{key:"updateGamepads",value:function(){for(var t=this,e=navigator.getGamepads?navigator.getGamepads():[],i=0;i<e.length;i++){var n=e[i];if(n&&n.connected){n.buttons.forEach(function(e,i){return t.gamepad["button"+i]=e.pressed}),n.axes.forEach(function(e,i){return t.gamepad["axis"+i]=e});break}}Object.keys(this.gamepad).forEach(function(e){t.gamepad[e]||delete t.gamepad[e]});var o=this.gamepad.axis0,s=this.gamepad.axis1;this.gamepad.active=(Math.abs(o)>0||Math.abs(s)>0)&&Math.sqrt(o*o+s*s)>this.options.gamepadDeadzone}},{key:"updateKeyboard",value:function(){var t=this.keys[65]||this.keys[37]||this.gamepad.button13,e=this.keys[68]||this.keys[39]||this.gamepad.button14,i=this.keys[87]||this.keys[38]||this.gamepad.button11,n=this.keys[83]||this.keys[40]||this.gamepad.button12;this.keys.active=t||e||i||n}},{key:"handleKeyDown",value:function(t){this.keys[t.keyCode]=!0,t.preventDefault()}},{key:"handleKeyUp",value:function(t){delete this.keys[t.keyCode],t.preventDefault()}},{key:"updateMotionFromTargetAngle",value:function(t,e,i,n){var o=this.world.get("Position",e),s=this.world.get("Motion",e),r=n<0?n+Ut:n,a=r<o.rotation?-1:1,l=Math.abs(r-o.rotation);l>Math.PI&&(a=0-a);var u=a*Math.min(i.radPerSec,l/t),h=u-s.drotation;Math.abs(h)>i.radPerSec&&(h>0?h=i.radPerSec:h<0&&(h=0-i.radPerSec)),s.drotation+=h}}]),e}(z);i("PlayerInputSteering",Yt);var Kt=!0,qt=window.world=new D({systems:{ViewportPixi:{debug:Kt,container:"#game",canvas:"#viewport",followName:"hero1",zoom:.5},DrawStats:{},MemoryStats:{},DatGui:{},PlayerInputSteering:{},Motion:{},Position:{},Thruster:{},Seeker:{},Repulsor:{},Collision:{},Bounce:{}}});qt.insert({Name:{name:"hero1"},Sprite:{name:"hero",color:255},Collidable:{},Bounce:{mass:7e3},Position:{x:0,y:0,rotation:-(Math.PI/2)},Motion:{},Thruster:{deltaV:1200,maxV:650,active:!1},PlayerInputSteering:{radPerSec:Math.PI}}),qt.insert({Name:{name:"repulsor1"},Sprite:{name:"enemywing",color:16724787},Position:{x:0,y:0,rotation:-(Math.PI/2)},Motion:{},Repulsor:{}}),qt.insert({Name:{name:"repulsor2"},Sprite:{name:"enemywing",color:16724787},Position:{x:0,y:-600,rotation:-(Math.PI/2)},Motion:{},Repulsor:{}}),qt.insert({Name:{name:"repulsor3"},Sprite:{name:"enemywing",color:16724787},Position:{x:0,y:-1200,rotation:-(Math.PI/2)},Motion:{},Repulsor:{}}),qt.insert({Name:{name:"repulsor4"},Sprite:{name:"enemywing",color:16724787},Position:{x:0,y:-1800,rotation:-(Math.PI/2)},Motion:{},Repulsor:{}}),qt.insert({Name:{name:"repulsor4"},Sprite:{name:"enemywing",color:16724787},Position:{x:0,y:-2400,rotation:-(Math.PI/2)},Motion:{},Repulsor:{}});var Jt=1e3,Qt=600,Zt=200;d(-Jt,-Jt,Qt,Zt),d(Jt,Jt,Qt,Zt),d(Jt,-Jt,Qt,Zt),d(-Jt,Jt,Qt,Zt),qt.start();var $t=qt.getSystem("ViewportPixi"),te=qt.getSystem("DatGui"),ee=te.gui;ee.add(qt,"isPaused"),ee.add(qt,"debug"),ee.add($t,"zoom",$t.options.zoomMin,$t.options.zoomMax).listen(),ee.add($t,"lineWidth",1,4).step(.5).listen();var ie=["gridEnabled","followEnabled","cameraX","cameraY"];ie.forEach(function(t){ee.add($t,t).listen()});var ne=$t.cursorPosition;ee.add(ne,"x").listen(),ee.add(ne,"y").listen()}();
